import{u as R,a as q,f as D,bk as ne,j as e,l as c,bl as G,bm as h,i as u,bn as le,bo as X,Z as J,w as te,I as oe,J as de,K as ae,a7 as ie,Y as ce,bp as me,g as ue,p as I,bq as xe,d as he,br as pe,b as U,bs as be,bt as je,bu as m,az as P,aN as fe,bv as ge,bw as _e,bd as Ce,aZ as $e,bx as ye,a$ as Ne,b0 as ke,R as we,N as Te,D as Se,h as ee,by as Ee,aG as Pe,bz as Re,bA as Be,bh as ze,bB as Ae,r as H,e as L,H as B,bC as Fe}from"./bundle.D3-hVUGj.js";import{u as Ie}from"./Actions-OZ_Df7fS.js";import{P as He}from"./PaymentStatus-Ba2_Ejbd.js";import{I as Le}from"./InvoiceStatus-CQhnxHGD.js";import{E as qe}from"./EmailRecord-zCEqxR7S.js";import{C as De}from"./CloudPlay-Dnx8RJ-8.js";import{H as Ge}from"./History-BTuPZ_tO.js";function Oe(d){const{expenseId:l}=d,[s]=R(),i=q(),{dateFormat:t}=D(),{data:r}=ne({id:l});return e.jsx(e.Fragment,{children:r&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs("span",{className:"text-sm",style:{color:i.$3},children:[c(r.date,t)," -"]}),e.jsx("span",{className:"text-sm",style:{color:i.$3},children:s("expense")}),e.jsx("div",{children:e.jsx(G,{color:i.$17,size:"1.1rem"})}),e.jsxs(h,{to:u("/expenses/:id/edit",{id:l}),children:["# ",r.number]})]})})}function Ve(d){const{taskId:l}=d,[s]=R(),i=q(),{dateFormat:t}=D(),{data:r}=le({id:l});return e.jsx(e.Fragment,{children:r&&e.jsxs("div",{className:"flex items-center space-x-1",children:[r.date&&e.jsxs("span",{className:"text-sm",style:{color:i.$3},children:[c(r.date,t)," -"]}),e.jsx("span",{className:"text-sm",style:{color:i.$3},children:s("task")}),e.jsx("div",{children:e.jsx(G,{color:i.$17,size:"1.1rem"})}),e.jsxs(h,{to:u("/tasks/:id/edit",{id:l}),children:["# ",r.number]})]})})}const ve=X(null),Me=X(!1);ee.extend(Fe);const Y=B.div`
  background-color: ${({theme:d})=>d.backgroundColor};

  &:hover {
    background-color: ${({theme:d})=>d.hoverBackgroundColor};
  }
`,Qe=B.div`
  background-color: ${({theme:d})=>d.backgroundColor};

  &:hover {
    background-color: ${({theme:d})=>d.hoverBackgroundColor};
  }
`,We=B.div`
  background-color: ${({theme:d})=>d.backgroundColor};

  &:hover {
    background-color: ${({theme:d})=>d.hoverBackgroundColor};
  }
`,Ke=B.div`
  background-color: ${({theme:d})=>d.backgroundColor};

  &:hover {
    background-color: ${({theme:d})=>d.hoverBackgroundColor};
  }
`;function Ze(){const[d]=R();return l=>{var t,r,p,$,y,N,j,k,w,f,T,b,S,g;let s=ze(`activity_${l.activity_type_id}`,{});const i={client:e.jsx(h,{to:u("/clients/:id",{id:(t=l.client)==null?void 0:t.hashed_id}),children:(r=l.client)==null?void 0:r.label}),user:((p=l.user)==null?void 0:p.label)??d("system"),invoice:e.jsx(h,{to:u("/invoices/:id/edit",{id:($=l.invoice)==null?void 0:$.hashed_id}),children:(y=l==null?void 0:l.invoice)==null?void 0:y.label}),recurring_invoice:e.jsx(h,{to:u("/recurring_invoices/:id/edit",{id:(N=l==null?void 0:l.recurring_invoice)==null?void 0:N.hashed_id}),children:(j=l==null?void 0:l.recurring_invoice)==null?void 0:j.label}),contact:e.jsx(h,{to:u("/clients/:id/edit",{id:(k=l==null?void 0:l.contact)==null?void 0:k.hashed_id}),children:(w=l==null?void 0:l.contact)==null?void 0:w.label}),notes:(l==null?void 0:l.notes)&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"'",l==null?void 0:l.notes,"'"]}),payment_amount:(f=l==null?void 0:l.payment_amount)==null?void 0:f.label,payment:e.jsx(h,{to:u("/payments/:id/edit",{id:(T=l==null?void 0:l.payment)==null?void 0:T.hashed_id}),children:(b=l==null?void 0:l.payment)==null?void 0:b.label}),credit:e.jsx(h,{to:u("/credits/:id/edit",{id:(S=l==null?void 0:l.credit)==null?void 0:S.hashed_id}),children:(g=l==null?void 0:l.credit)==null?void 0:g.label})};for(const[z,A]of Object.entries(i))s=Ae(s,`:${z}`,()=>A);return s}}function ns(){var V,v,M,Q,W,K,Z;const[d,l]=J(Me),[s,i]=J(ve),[t]=R(),r=q(),p=te(),$=oe(),y=de(),N=ae({withTimezone:!0,formatOnlyDate:!0}),j=ie(),k=ce(),w=me(),f=ue(),T=Ze(),[b,S]=I.useState(!1),[g,z]=I.useState([]),A=xe(),E=he(),se=Ie({showCommonBulkAction:!0,showEditAction:!0}),{timeFormat:O}=pe(),{dateFormat:x}=D(),{data:o}=U({queryKey:["/api/v1/invoices",s==null?void 0:s.id,"payments"],queryFn:()=>H("GET",L(`/api/v1/invoices/${s==null?void 0:s.id}?include=payments,activities.history&reminder_schedule=true`)).then(n=>n.data.data),enabled:s!==null&&d,staleTime:1/0}),re=async()=>{const n=await A.fetchQuery(["/api/v1/invoices",s==null?void 0:s.id,"emailHistory"],()=>H("POST",L("/api/v1/emails/entityHistory"),{entity:"invoice",entity_id:s==null?void 0:s.id}),{staleTime:1/0}).then(a=>a.data);z(n)},{data:F}=U({queryKey:["/api/v1/activities/entity",s==null?void 0:s.id],queryFn:()=>H("POST",L("/api/v1/activities/entity"),{entity:"invoice",entity_id:s==null?void 0:s.id}).then(n=>n.data.data),enabled:s!==null&&d,staleTime:1/0});return I.useEffect(()=>{s&&re()},[s]),e.jsx(be,{visible:d,onClose:()=>{l(!1),i(null)},size:"regular",title:`${t("invoice")} ${s==null?void 0:s.number}`,topRight:s&&(k("edit_invoice")||w(s))?e.jsx(Be,{label:t("actions"),resource:s,actions:se}):null,withoutActionContainer:!0,withoutHeaderBorder:!0,children:e.jsxs(je,{tabs:[t("overview"),t("history"),t("activity"),t("email_history")],width:"full",withHorizontalPadding:!0,horizontalPaddingWidth:"1.5rem",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-6",children:[e.jsx(m,{className:"border-b border-dashed",leftSide:t("invoice_amount"),pushContentToRight:!0,withoutWrappingLeftSide:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?E(s==null?void 0:s.amount,(V=s.client)==null?void 0:V.country_id,(v=s.client)==null?void 0:v.settings.currency_id):null}),e.jsx(m,{className:"border-b border-dashed",leftSide:t("balance_due"),pushContentToRight:!0,withoutWrappingLeftSide:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?E(s.balance,(M=s.client)==null?void 0:M.country_id,(Q=s.client)==null?void 0:Q.settings.currency_id):null}),e.jsx(m,{className:"border-b border-dashed",leftSide:t("date"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?c(s==null?void 0:s.date,x):null}),e.jsx(m,{className:"border-b border-dashed",leftSide:t("due_date"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?c(s.due_date,x):null}),e.jsx(m,{leftSide:t("status"),pushContentToRight:!0,noExternalPadding:!0,children:s?e.jsx(Le,{entity:s}):null})]}),e.jsx(P,{withoutPadding:!0,borderColor:r.$20}),e.jsxs("div",{className:"flex space-x-4 items-center justify-center px-6 py-5",children:[e.jsxs(Y,{className:"flex flex-col items-center justify-center space-y-2 shadow-sm border px-14 py-5 cursor-pointer rounded-md",onClick:()=>s?fe(s):null,style:{borderColor:r.$20},theme:{backgroundColor:r.$1,hoverBackgroundColor:r.$4},children:[e.jsx(De,{color:r.$17,filledColor:r.$17,size:"1.3rem"}),e.jsx("span",{className:"font-medium whitespace-nowrap",style:{color:r.$3},children:t("view_portal")})]}),s?e.jsxs(Y,{className:"flex flex-col items-center justify-center space-y-2 shadow-sm border px-14 py-5 cursor-pointer rounded-md",onClick:()=>{navigator.clipboard.writeText(_e(s)??""),Ce.success("copied_to_clipboard",{value:""})},style:{borderColor:r.$20},theme:{backgroundColor:r.$1,hoverBackgroundColor:r.$4},children:[e.jsx(ge,{color:r.$17,filledColor:r.$17,size:"1.3rem"}),e.jsx("span",{className:"font-medium whitespace-nowrap",style:{color:r.$3},children:t("copy_link")})]}):null]}),e.jsx(P,{withoutPadding:!0,borderColor:r.$20}),s&&s.next_send_date?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 whitespace-nowrap px-6",children:[e.jsx($e,{size:"regular",width:"auto",tooltipElement:e.jsx("article",{className:ke("prose prose-sm",{"prose-invert":!(p!=null&&p.dark_mode)}),dangerouslySetInnerHTML:{__html:Ne((o==null?void 0:o.reminder_schedule)??"")}}),children:e.jsxs("h3",{className:"flex mt-2 italic",children:[t("reminders")," ",e.jsx(ye,{className:"mt-1 ml-1"})]})}),e.jsx(m,{className:"border-b border-dashed",leftSide:t("next_send_date"),pushContentToRight:!0,noExternalPadding:!0,withoutWrappingLeftSide:!0,style:{borderColor:r.$20},children:s?N(s.next_send_date,"","",y($(s.client,"timezone_id")).timeZone):null}),e.jsx(m,{className:"border-b border-dashed",leftSide:t("reminder_last_sent"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?c(s.reminder_last_sent,x):null}),s.reminder1_sent?e.jsx(m,{className:"border-b border-dashed",leftSide:t("first_reminder"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?c(s.reminder1_sent,x):null}):null,s.reminder2_sent?e.jsx(m,{className:"border-b border-dashed",leftSide:t("second_reminder"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:r.$20},children:s?c(s.reminder2_sent,x):null}):null,s.reminder3_sent?e.jsx(m,{leftSide:t("third_reminder"),pushContentToRight:!0,noExternalPadding:!0,children:s?c(s.reminder3_sent,x):null}):null]}),e.jsx(P,{withoutPadding:!0,borderColor:r.$20})]}):null,!!((W=o==null?void 0:o.payments)!=null&&W.length)&&e.jsx("div",{className:"flex flex-col space-y-4 px-6 py-5",children:(o==null?void 0:o.payments)&&o.payments.map(n=>n.paymentables.filter(a=>a.invoice_id===(s==null?void 0:s.id)&&a.archived_at===0).map(a=>{var _,C;return e.jsxs(Ke,{className:"flex flex-col items-start justify-center space-y-2 shadow-sm text-sm border p-5 w-full cursor-pointer rounded-md",onClick:()=>{!f("payment",n)&&j(u("/payments/:id/edit",{id:n.id}))},style:{borderColor:r.$20},theme:{backgroundColor:r.$1,hoverBackgroundColor:r.$4},children:[e.jsxs("span",{className:"font-medium",style:{color:r.$3},children:[t("payment")," ",n.number]}),e.jsxs("div",{className:"inline-flex items-center space-x-1",style:{color:r.$17},children:[e.jsx("span",{children:E(a.amount,(_=n.client)==null?void 0:_.country_id,(C=n.client)==null?void 0:C.settings.currency_id)}),e.jsx("span",{children:"-"}),e.jsx("span",{children:c(a.created_at,x)})]}),e.jsx("div",{children:e.jsx(He,{entity:n})})]},n.id)}))}),!!((K=s==null?void 0:s.line_items)!=null&&K.some(n=>n.expense_id||n.task_id))&&e.jsx(P,{withoutPadding:!0,borderColor:r.$20}),s&&e.jsx("div",{className:"flex flex-col px-6 py-5",children:s.line_items.map((n,a)=>(n.expense_id||n.task_id)&&e.jsxs(we.Fragment,{children:[n.expense_id&&e.jsx(Oe,{expenseId:n.expense_id}),n.task_id&&e.jsx(Ve,{taskId:n.task_id})]},a))})]}),e.jsxs("div",{children:[(o==null?void 0:o.activities)&&o.activities.filter(({history:n})=>n==null?void 0:n.id).length===0&&e.jsx(Te,{children:t("api_404")}),!!((Z=o==null?void 0:o.activities)!=null&&Z.length)&&e.jsx("div",{className:"flex flex-col px-3",children:(o==null?void 0:o.activities)&&o.activities.filter(({history:n})=>n==null?void 0:n.id).map(n=>{var a,_,C;return e.jsxs(Qe,{className:"flex items-center justify-start p-4 space-x-3 rounded-md cursor-pointer",onClick:()=>j(u("/activities/:id",{id:n.id})),theme:{backgroundColor:r.$1,hoverBackgroundColor:r.$25},children:[e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:r.$20},children:e.jsx(Ge,{size:"1.3rem",color:r.$16,filledColor:r.$16})}),e.jsxs("div",{className:"flex flex-col items-start space-y-0.5 justify-center",children:[e.jsxs("div",{className:"flex space-x-1 text-sm",children:[e.jsx("span",{style:{color:r.$3},children:s!=null&&s.client?E(n.history.amount,(a=s==null?void 0:s.client)==null?void 0:a.country_id,(_=s==null?void 0:s.client)==null?void 0:_.settings.currency_id):null}),e.jsx("div",{children:e.jsx(G,{color:r.$17,size:"1.1rem"})}),e.jsx(Se,{to:`/clients/${n.client_id}`,renderSpan:f("client",s==null?void 0:s.client),children:(C=s==null?void 0:s.client)==null?void 0:C.display_name})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs",style:{color:r.$17},children:[e.jsx("span",{children:c(n.created_at,`${x} ${O}`)}),e.jsx("span",{children:ee.unix(n.created_at).fromNow()})]})]})]},n.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center border-b px-6 pb-4 justify-between",style:{borderColor:r.$20},children:[e.jsx(Ee,{label:t("comments_only"),checked:b,onValueChange:n=>S(n)}),e.jsx(Pe,{entity:"invoice",entityId:o==null?void 0:o.id,label:(o==null?void 0:o.number)||""})]}),e.jsx("div",{className:"flex flex-col pt-3 px-3",children:F==null?void 0:F.filter(n=>b&&n.activity_type_id===141||!b).map(n=>e.jsxs(We,{className:"flex space-x-3 p-4 rounded-md flex-1 min-w-0",theme:{backgroundColor:r.$1,hoverBackgroundColor:r.$25},children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:r.$20},children:e.jsx(Re,{size:"1.3rem",color:r.$16,filledColor:r.$16})})}),e.jsxs("div",{className:"flex flex-col space-y-0.5 flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm",style:{color:r.$3},children:T(n)}),e.jsxs("div",{className:"flex w-full items-center space-x-1 text-xs truncate",style:{color:r.$17},children:[e.jsx("span",{className:"whitespace-nowrap",children:c(n.created_at,`${x} ${O}`)}),e.jsx("span",{children:"-"}),e.jsx("span",{children:n.ip})]})]})]},n.id))})]}),e.jsxs("div",{className:"flex flex-col space-y-2 px-6",children:[!g.length&&e.jsx("span",{className:"text-sm px-4",style:{color:r.$3},children:t("email_history_empty")}),g.map((n,a)=>e.jsx(qe,{className:"py-4",emailRecord:n,index:a,withAllBorders:!0},a))]})]})})}export{ns as I,Me as a,ve as i,Ze as u};
