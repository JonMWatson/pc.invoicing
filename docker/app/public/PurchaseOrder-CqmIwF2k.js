import{bM as k,ac as L,bN as M,bd as v,r as Q,e as H,$,u as P,Y as D,bp as E,bO as C,i as u,j as s,bP as q,L as K,bK as W,fH as Y,p as c,bQ as z,af as G,bV as J,a1 as X,bc as Z,bi as ee,Q as se,bR as te,bS as re,S as ae,a5 as oe,a6 as ie,bA as ne}from"./bundle.D3-hVUGj.js";import{u as ce}from"./useCalculateInvoiceSum-C_K56SBB.js";import{C as ue}from"./CommonActions-DKlnNCPW.js";import{P as de}from"./PreviousNextNavigation-BpWEW6Fs.js";import"./Actions-OZ_Df7fS.js";import"./invoice-status-We6cAxTk.js";import"./hooks-DdpVpzmL.js";import"./CreditStatus-DFPZx7rF.js";import"./useInvoiceColumns-YKQxY9Gc.js";import"./InvoiceStatus-CQhnxHGD.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function me(m){const{setErrors:t,isDefaultFooter:o,isDefaultTerms:i,isFormBusy:r,setIsFormBusy:a}=m,l=k(),f=L(M);return n=>{if(r)return;a(!0),t(void 0),v.processing();let d="/api/v1/purchase_orders/:id?";i?(d+="save_default_terms=true",o&&(d+="&save_default_footer=true")):o&&(d+="save_default_footer=true"),Q("PUT",H(d,{id:n.id}),n).then(async()=>{(i||o)&&await l(),v.success("updated_purchase_order")}).catch(h=>{var _;if(((_=h.response)==null?void 0:_.status)===422){const p=h.response.data;p.errors.amount?v.error(p.errors.amount[0]):v.dismiss(),t(p)}}).finally(()=>{f(void 0),$(["purchase_orders"]),a(!1)})}}function le(m){const[t]=P(),o=D(),i=E(),{id:r}=C(),{purchaseOrder:a}=m,l=o("view_purchase_order")||o("edit_purchase_order")||i(a);return[{name:t("edit"),href:u("/purchase_orders/:id/edit",{id:r})},{name:t("documents"),href:u("/purchase_orders/:id/documents",{id:r}),enabled:l,formatName:()=>{var n;return s.jsx(q,{numberOfDocuments:(n=a==null?void 0:a.documents)==null?void 0:n.length})}},{name:t("settings"),href:u("/purchase_orders/:id/settings",{id:r})},{name:t("activity"),href:u("/purchase_orders/:id/activity",{id:r})},{name:t("history"),href:u("/purchase_orders/:id/history",{id:r})},{name:t("email_history"),href:u("/purchase_orders/:id/email_history",{id:r})}]}function Se(){const{documentTitle:m}=K("edit_purchase_order"),[t]=P(),[o]=W(),{id:i}=C(),{data:r}=Y({id:i}),a=D(),l=E(),f=[{name:t("purchase_orders"),href:"/purchase_orders"},{name:t("edit_purchase_order"),href:u("/purchase_orders/:id/edit",{id:i})}],[n,d]=c.useState(),[h,_]=c.useState(!1),[p,x]=c.useState(),[g,I]=c.useState(!1),[A,F]=c.useState(!1),[e,S]=z(G),N=J(),O=le({purchaseOrder:e}),R=ce(x),B=me({setErrors:d,isDefaultTerms:g,isDefaultFooter:A,isFormBusy:h,setIsFormBusy:_}),{changeTemplateVisible:V,setChangeTemplateVisible:w,changeTemplateResources:U}=X();return c.useEffect(()=>{const T=o.get("action")&&e?e:r;if(T){const y=Z.cloneDeep(T);y.line_items.forEach(b=>b._id=ee()),y.invitations.forEach(b=>b.client_contact_id=b.client_contact_id||""),S(y)}},[r]),c.useEffect(()=>{e&&R(e)},[e]),s.jsxs(se,{title:m,breadcrumbs:f,...(a("edit_purchase_order")||l(e))&&e&&{navigationTopRight:s.jsx(ne,{resource:e,onSaveClick:()=>B(e),actions:N,cypressRef:"purchaseOrderActionDropdown",disableSaveButton:!e||h})},afterBreadcrumbs:s.jsx(de,{entity:"purchase_order"}),children:[(e==null?void 0:e.id)===i?s.jsxs("div",{className:"space-y-4",children:[s.jsx(te,{tabs:O,rightSide:e&&s.jsx("div",{className:"flex items-center",children:s.jsx(ue,{resource:e,entity:"purchase_order"})})}),s.jsx(re,{context:{purchaseOrder:e,setPurchaseOrder:S,errors:n,isDefaultTerms:g,setIsDefaultTerms:I,isDefaultFooter:A,setIsDefaultFooter:F,invoiceSum:p,setInvoiceSum:x}})]}):s.jsx("div",{className:"flex justify-center items-center",children:s.jsx(ae,{})}),s.jsx(oe,{entity:"purchase_order",entities:U,visible:V,setVisible:w,labelFn:j=>s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx(ie,{children:t("number")}),s.jsx("span",{children:j.number})]}),bulkUrl:"/api/v1/purchase_orders/bulk"})]})}export{Se as default};
