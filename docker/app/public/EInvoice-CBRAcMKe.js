import{u as V,cK as K,a as Q,cm as Y,b as z,p as W,j as s,C as m,bm as d,i as r,ax as G,cL as H,ab as C,$ as E,bu as T,ct as w,bc as o,bd as P,r as k,e as D,bh as J,bB as h}from"./bundle.D3-hVUGj.js";import{I as $}from"./invoice-status-We6cAxTk.js";const R=["invoice","client","company"],U=[145,146,147];function ee(){var _,v,y,I,g,N;const[a]=V(),B=K(),x=Q(),F=Y(),{invoice:e,eInvoiceValidationEntityResponse:l,setTriggerValidationQuery:O,setInvoice:q,errors:c}=F,{data:p}=z({queryKey:["/api/v1/activities/entity",e==null?void 0:e.id],queryFn:()=>k("POST",D("/api/v1/activities/entity"),{entity:"invoice",entity_id:e==null?void 0:e.id}).then(t=>t.data.data),enabled:e!==null&&B.pathname.includes("e_invoice")&&!!((e==null?void 0:e.status_id)===$.Sent&&((_=e==null?void 0:e.backup)!=null&&_.guid)),staleTime:1/0}),[j,f]=W.useState(!1),A=()=>{j||(P.processing(),f(!0),k("POST",D("/api/v1/einvoice/peppol/send"),{entity:"invoice",entity_id:e==null?void 0:e.id}).then(()=>{E(["invoices"]),P.success("success")}).finally(()=>f(!1)))},L=t=>{var S;let i=J(`activity_${t}`,{});const n=s.jsx(d,{to:r("/invoices/:id/edit",{id:e==null?void 0:e.id}),children:e==null?void 0:e.number}),u=s.jsx(d,{to:r("/clients/:id",{id:e==null?void 0:e.client_id}),children:(S=e==null?void 0:e.client)==null?void 0:S.display_name}),M="";return i=h(i,":invoice",()=>n),i=h(i,":client",()=>u),i=h(i,":notes",()=>M),i},b=(t,i)=>{const n=o.cloneDeep(e);o.set(n,t,i),q(n)};return s.jsxs(s.Fragment,{children:[s.jsx(m,{title:a("e_invoice"),topRight:s.jsx(C,{behavior:"button",onClick:()=>{E(["entity_validations"]),O(!0)},children:a("validate")}),className:"shadow-sm",style:{borderColor:x.$24},headerStyle:{borderColor:x.$20},children:!!(l&&e)&&s.jsx("div",{className:"flex px-6",children:s.jsx("div",{className:"flex flex-1 flex-col space-y-4 text-sm",children:R.map((t,i)=>(l==null?void 0:l[t]).length?s.jsxs("div",{className:"flex items-center space-x-4 border-l-2 border-red-500 pl-4 py-4",children:[s.jsxs("div",{className:"whitespace-nowrap font-medium w-24",children:[a(t),":"]}),s.jsxs("div",{className:"flex flex-1 items-center justify-between pr-4",children:[s.jsx("div",{className:"flex flex-col space-y-2.5",children:(l==null?void 0:l[t]).map((n,u)=>s.jsx("span",{children:t==="invoice"?n:n.label?`${n.label} (${a("required")})`:n.field},u))}),t==="invoice"&&s.jsx(d,{to:r("/invoices/:id/edit",{id:e==null?void 0:e.id}),children:a("edit_invoice")}),t==="client"&&s.jsx(d,{to:r("/clients/:id/edit",{id:e==null?void 0:e.client_id}),children:a("edit_client")}),t==="company"&&s.jsx(d,{to:"/settings/company_details",children:a("settings")})]})]},i):s.jsxs("div",{className:"flex items-center space-x-4 border-l-2 border-green-600 pl-4 py-4",children:[s.jsxs("div",{className:"whitespace-nowrap font-medium w-24",children:[a(t),":"]}),s.jsx("div",{children:s.jsx(G,{element:H,size:33,color:"green"})})]},i))})})}),(e==null?void 0:e.status_id)===$.Sent&&s.jsx(m,{title:a("status"),children:s.jsx("div",{className:"flex px-6 text-sm",children:s.jsxs("div",{className:"flex items-center space-x-4 border-l-2 pl-4 py-4",style:{borderColor:x.$5},children:[((v=e==null?void 0:e.backup)==null?void 0:v.guid)&&s.jsxs("span",{className:"whitespace-nowrap font-medium",children:[a("reference"),":"]}),(y=e==null?void 0:e.backup)!=null&&y.guid?s.jsxs("div",{className:"flex flex-col space-y-2.5",children:[s.jsx("span",{children:(I=e==null?void 0:e.backup)==null?void 0:I.guid}),p==null?void 0:p.filter(t=>U.includes(t.activity_type_id)).map(t=>s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("span",{className:"font-medium",children:[a("message"),":"]}),s.jsx("div",{children:L(t.activity_type_id)})]},t.id))]}):s.jsx(C,{behavior:"button",onClick:A,disabled:j,disableWithoutIcon:!0,children:a("send")})]})})}),s.jsxs(m,{title:a("date_range"),children:[s.jsx(T,{leftSide:a("start_date"),children:s.jsx(w,{type:"date",value:o.get(e,"e_invoice.Invoice.InvoicePeriod.0.StartDate")||"",onValueChange:t=>b("e_invoice.Invoice.InvoicePeriod.0.StartDate",t),errorMessage:(g=c==null?void 0:c.errors)==null?void 0:g["e_invoice.InvoicePeriod.0.StartDate"]})}),s.jsx(T,{leftSide:a("end_date"),children:s.jsx(w,{type:"date",value:o.get(e,"e_invoice.Invoice.InvoicePeriod.0.EndDate")||"",onValueChange:t=>b("e_invoice.Invoice.InvoicePeriod.0.EndDate",t),errorMessage:(N=c==null?void 0:c.errors)==null?void 0:N["e_invoice.InvoicePeriod.0.EndDate"]})})]})]})}export{ee as default};
