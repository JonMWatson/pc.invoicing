import{u as y,bO as T,i as o,j as s,bP as w,L as I,a7 as M,Y as V,bp as H,p as i,cR as Q,d9 as U,bc as j,bL as $,a1 as q,Q as Y,S as z,bR as G,bS as J,a5 as K,a6 as v,bA as W,bd as p,r as X,e as Z,$ as ss}from"./bundle.D3-hVUGj.js";import{P as es}from"./PreviousNextNavigation-BpWEW6Fs.js";function ts({client:e}){const[c]=y(),{id:n}=T();return[{name:c("edit"),href:o("/clients/:id/edit",{id:n})},{name:c("settings"),href:o("/clients/:id/settings",{id:n})},{name:c("documents"),href:o("/clients/:id/documents",{id:n}),formatName:()=>s.jsx(w,{numberOfDocuments:e==null?void 0:e.documents.length})},{name:c("locations"),href:o("/clients/:id/locations",{id:n}),formatName:()=>s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("span",{children:c("locations")}),!!(e!=null&&e.locations.length)&&s.jsxs("span",{className:"font-bold",children:["(",e==null?void 0:e.locations.length,")"]})]})}]}function is(){const{documentTitle:e,setDocumentTitle:c}=I("edit_client"),[n]=y(),{id:l}=T(),C=M(),S=V(),N=H(),[P,f]=i.useState(!1),A=Q({setIsPurgeOrMergeActionCalled:f}),{data:r,isLoading:E}=U({id:l,enabled:!P}),[t,d]=i.useState(),[R,b]=i.useState(),[h,x]=i.useState(!1),[m,g]=i.useState([]),D=ts({client:t});i.useEffect(()=>{if(r){d({...r});const a=j.cloneDeep(r.contacts);a.map(u=>u.password=""),g(a)}return()=>{f(!1)}},[r]),i.useEffect(()=>{c((t==null?void 0:t.display_name)||"edit_client")},[t]),i.useEffect(()=>{d(a=>j.set(a,"contacts",m))},[m]);const L=[{name:n("clients"),href:"/clients"},{name:e,href:o("/clients/:id",{id:l})},{name:n("edit"),href:o("/clients/:id",{id:l})}],B=$(),O=async()=>{h||(p.processing(),x(!0),await B({excludeToasters:!0}),X("PUT",Z("/api/v1/clients/:id",{id:l}),{...t,documents:[]}).then(()=>{p.success("updated_client"),ss(["clients"]),C(o("/clients/:id",{id:l}))}).catch(a=>{var u;((u=a.response)==null?void 0:u.status)===422&&(p.dismiss(),b(a.response.data))}).finally(()=>x(!1)))},{changeTemplateVisible:_,setChangeTemplateVisible:k,changeTemplateResources:F}=q();return s.jsxs(Y,{title:e,breadcrumbs:L,...(S("edit_client")||N(t))&&t&&{navigationTopRight:s.jsx(W,{resource:t,actions:A,onSaveClick:O,disableSaveButton:!t||h,cypressRef:"clientActionDropdown"})},afterBreadcrumbs:s.jsx(es,{entity:"client"}),children:[E&&s.jsx(z,{}),t&&s.jsxs("div",{className:"space-y-4",children:[s.jsx(G,{tabs:D}),s.jsx(J,{context:{errors:R,setErrors:b,client:t,setClient:d,contacts:m,setContacts:g}}),s.jsx(K,{entity:"client",entities:F,visible:_,setVisible:k,labelFn:a=>s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx(v,{children:n("number")}),s.jsx("span",{children:a.number})]}),bulkLabelFn:a=>s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(v,{children:[n("number"),":"]}),s.jsx("span",{children:a.number})]}),bulkUrl:"/api/v1/clients/bulk"})]})]})}export{is as default};
