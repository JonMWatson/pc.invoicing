import{L as T,u as C,a7 as E,t as N,bK as D,Z as k,dz as B,p as l,ft as I,j as s,ax as A,aL as P,bc as Y,h as $,Q as O,fu as w,bd as _,r as F,e as L,$ as M,i as Q}from"./bundle.D3-hVUGj.js";import{D as q,N as z,A as H,T as K}from"./Taxes-BLwDL1KQ.js";import"./ProjectSelector-DIb_VaTZ.js";import"./ClientActionButtons-YTWpr-RA.js";import"./PaymentTypeSelector-B5RlAkj_.js";import"./useResolveCurrencySeparator-ygcSKMxa.js";function W(){const{documentTitle:b}=T("new_expense"),[c]=C(),g=E(),e=N(),[n]=D(),j=[{name:c("expenses"),href:"/expenses"},{name:c("new_expense"),href:"/expenses/create"}],[t,d]=k(B),[p,u]=l.useState(),[x,y]=l.useState(e!=null&&e.calculate_expense_tax_by_amount?"by_amount":"by_rate"),[m,v]=l.useState(!1),{data:o}=I({enabled:typeof t>"u"}),r=w({setExpense:d,setErrors:u}),h=f=>{m||(_.processing(),u(void 0),v(!0),F("POST",L("/api/v1/expenses"),t).then(a=>{_.success("created_expense"),M(["expenses"]),f==="save"?g(Q("/expenses/:id/edit",{id:a.data.data.id})):o&&d(o)}).catch(a=>{var i;((i=a.response)==null?void 0:i.status)===422&&(u(a.response.data),_.dismiss())}).finally(()=>v(!1)))},S=[{onClick:()=>h("create"),label:`${c("save")} / ${c("create")}`,icon:s.jsx(A,{element:P})}];return l.useEffect(()=>{d(f=>{let a=f;if(n.get("action")!=="clone"&&(a=void 0),typeof o<"u"&&typeof a>"u"&&n.get("action")!=="clone"){const i=Y.cloneDeep(o);n.has("vendor")&&(i.vendor_id=n.get("vendor")),n.has("client")&&(i.client_id=n.get("client")),a={...i,payment_date:e!=null&&e.mark_expenses_paid?$().format("YYYY-MM-DD"):"",should_be_invoiced:e==null?void 0:e.mark_expenses_invoiceable,invoice_documents:e==null?void 0:e.invoice_expense_documents,calculate_tax_by_amount:x==="by_amount",uses_inclusive_taxes:e.expense_inclusive_taxes}}return a})},[o]),s.jsx(O,{title:b,breadcrumbs:j,onSaveClick:()=>t&&h("save"),additionalSaveOptions:S,disableSaveButton:m,children:s.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[s.jsx("div",{className:"col-span-12 xl:col-span-4",children:s.jsx(q,{expense:t,handleChange:r,taxInputType:x,pageType:"create",errors:p})}),s.jsx("div",{className:"col-span-12 xl:col-span-4",children:s.jsx(z,{expense:t,handleChange:r,errors:p})}),s.jsxs("div",{className:"col-span-12 xl:col-span-4 space-y-4",children:[s.jsx(H,{expense:t,handleChange:r,errors:p}),s.jsx(K,{expense:t,handleChange:r,taxInputType:x,setTaxInputType:y})]})]})})}export{W as default};
