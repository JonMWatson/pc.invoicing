import{bL as k,bd as b,r as C,e as w,$ as N,u as x,ao as O,Y as g,bp as P,bO as j,i as u,j as t,bP as R,p as y,a1 as V,O as U,bT as D,Q as L,dW as I,bR as F,bS as H,a5 as M,a6 as Q,bA as W}from"./bundle.D3-hVUGj.js";import{b as $}from"./payments-w44xId2A.js";import{u as q}from"./useActions-DERWog92.js";import{B as Y}from"./Banner-C9ETM0xV.js";import{P as z}from"./PreviousNextNavigation-BpWEW6Fs.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function G({setErrors:a,isFormBusy:s,setIsFormBusy:l}){const c=k();return async i=>{if(s)return;b.processing(),l(!0),a(void 0),await c({excludeToasters:!0});const d={...i};delete d.invoices,delete d.credits,await c({excludeToasters:!0}),C("PUT",w("/api/v1/payments/:id",{id:i.id}),d).then(()=>{b.success("updated_payment")}).catch(n=>{var e;((e=n.response)==null?void 0:e.status)===422&&(b.dismiss(),a(n.response.data))}).finally(()=>{N(["payments"]),l(!1)})}}function J(a){const[s]=x(),{isAdmin:l,isOwner:c}=O(),i=g(),d=P(),{id:n}=j(),{payment:e}=a,p=i("edit_payment")||d(e),o=i("view_payment")||i("edit_payment")||d(e);let r=[{name:s("edit"),href:u("/payments/:id/edit",{id:n})},{name:s("apply"),href:u("/payments/:id/apply",{id:n}),enabled:p},{name:s("refund"),href:u("/payments/:id/refund",{id:n}),enabled:p},{name:s("documents"),href:u("/payments/:id/documents",{id:n}),enabled:o,formatName:()=>{var m;return t.jsx(R,{numberOfDocuments:(m=e==null?void 0:e.documents)==null?void 0:m.length})}},{name:s("activity"),href:u("/payments/:id/activity",{id:n})},{name:s("custom_fields"),href:u("/payments/:id/payment_fields",{id:n}),enabled:l||c}];return e&&(e.amount-e.applied>0&&!e.is_deleted||(r=r.filter(({name:m})=>m!==s("apply"))),e.amount!==e.refunded&&!e.is_deleted||(r=r.filter(({name:m})=>m!==s("refund")))),r}function te(){const[a]=x(),s=g(),l=P(),{id:c}=j(),{data:i}=$({id:c,include:"credits"}),[d,n]=y.useState(),[e,p]=y.useState(!1),[o,r]=y.useState(),m=[{name:a("payments"),href:"/payments"},{name:a("edit_payment"),href:u("/payments/:id/edit",{id:c})}],T=J({payment:o}),_=G({setErrors:n,isFormBusy:e,setIsFormBusy:p}),A=q();y.useEffect(()=>{i&&r(i)},[i]);const{changeTemplateVisible:S,setChangeTemplateVisible:B,changeTemplateResources:E}=V();return U({on:["App\\Events\\Payment\\PaymentWasUpdated"],callback:({data:f})=>{var h,v;((h=D())==null?void 0:h.toString())!==f["x-socket-id"]&&((v=document.getElementById("paymentUpdateBanner"))==null||v.classList.remove("hidden"))}}),t.jsxs(L,{title:a("payment"),breadcrumbs:m,...(s("edit_payment")||l(o))&&o&&{onSaveClick:()=>_(o),navigationTopRight:t.jsx(W,{label:a("more_actions"),resource:o,actions:A,cypressRef:"paymentActionDropdown"}),disableSaveButton:!o||e},aboveMainContainer:t.jsx(Y,{id:"paymentUpdateBanner",className:"hidden",variant:"orange",children:a("payment_status_changed")}),afterBreadcrumbs:t.jsx(z,{entity:"payment"}),children:[t.jsxs(I,{breadcrumbs:[],children:[t.jsx(F,{tabs:T,disableBackupNavigation:!0}),t.jsx(H,{context:{errors:d,payment:o,setPayment:r}})]}),t.jsx(M,{entity:"payment",entities:E,visible:S,setVisible:B,labelFn:f=>t.jsxs("div",{className:"flex flex-col space-y-1",children:[t.jsx(Q,{children:a("number")}),t.jsx("span",{children:f.number})]}),bulkUrl:"/api/v1/payments/bulk"})]})}export{te as default};
