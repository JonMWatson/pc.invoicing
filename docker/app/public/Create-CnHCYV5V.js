import{L as w,u as L,t as K,bK as O,bQ as U,ae as W,Z,cf as q,p as o,cl as z,bc as C,j as u,Q as G,bR as H,bS as J,S as M}from"./bundle.D3-hVUGj.js";import{b as V}from"./blank-invitation-DyrJ7EfP.js";import{e as X,f as Y}from"./hooks-DdpVpzmL.js";import{u as N}from"./queries-Br35MC_k.js";import"./CreditStatus-DFPZx7rF.js";import"./useInvoiceColumns-YKQxY9Gc.js";import"./InvoiceStatus-CQhnxHGD.js";import"./invoice-status-We6cAxTk.js";function ce(){const{documentTitle:b}=w("new_credit"),[f]=L(),a=K(),j=[{name:f("credits"),href:"/credits"},{name:f("new_credit"),href:"/credits/create"}],$=[{name:f("create"),href:"/credits/create"},{name:f("documents"),href:"/credits/create/documents"},{name:f("settings"),href:"/credits/create/settings"}],[r]=O(),[n,d]=U(W),[D,E]=Z(q),[l,I]=o.useState(),[T,y]=o.useState(),[g,R]=o.useState(!1),[x,A]=o.useState(!1),[v,B]=o.useState(!1),F=z(),{data:m,isLoading:k}=N({enabled:typeof n>"u"}),{handleChange:c,calculateInvoiceSum:P}=X({client:l}),Q=Y({setErrors:y,isDefaultFooter:v,isDefaultTerms:x,isFormBusy:g,setIsFormBusy:R}),_=(e,s)=>{var i,t,p,h,S;return(i=e==null?void 0:e.settings)!=null&&i[`tax_name${s}`]?{name:e.settings[`tax_name${s}`],rate:e.settings[`tax_rate${s}`]}:(p=(t=e==null?void 0:e.group_settings)==null?void 0:t.settings)!=null&&p[`tax_name${s}`]?{name:(h=e==null?void 0:e.group_settings)==null?void 0:h.settings[`tax_name${s}`],rate:(S=e==null?void 0:e.group_settings)==null?void 0:S.settings[`tax_rate${s}`]}:{name:a==null?void 0:a.settings[`tax_name${s}`],rate:a==null?void 0:a.settings[`tax_rate${s}`]}};return o.useEffect(()=>(E(void 0),d(e=>{var i;let s=e;if(r.get("action")!=="clone"&&r.get("action")!=="reverse"&&(s=void 0),typeof m<"u"&&typeof s>"u"&&r.get("action")!=="clone"&&r.get("action")!=="reverse"){const t=C.cloneDeep(m);typeof t.line_items=="string"&&(t.line_items=[]),r.get("client")&&(t.client_id=r.get("client")),t.uses_inclusive_taxes=((i=a==null?void 0:a.settings)==null?void 0:i.inclusive_taxes)??!1,s=t}return s}),()=>{d(void 0)}),[m]),o.useEffect(()=>{n&&n.client_id.length>1&&F.find(n.client_id).then(e=>{I(e);const s=[];if(e.contacts.map(i=>{if(i.send_email){const t=C.cloneDeep(V);t.client_contact_id=i.id,s.push(t)}}),c("invitations",s),!e.is_tax_exempt){if(a&&a.enabled_tax_rates>0&&r.get("action")!=="clone"){const{name:i,rate:t}=_(e,"1");c("tax_name1",i),c("tax_rate1",t)}if(a&&a.enabled_tax_rates>1&&r.get("action")!=="clone"){const{name:i,rate:t}=_(e,"2");c("tax_name2",i),c("tax_rate2",t)}if(a&&a.enabled_tax_rates>2&&r.get("action")!=="clone"){const{name:i,rate:t}=_(e,"3");c("tax_name3",i),c("tax_rate3",t)}}})},[n==null?void 0:n.client_id]),o.useEffect(()=>{n&&P(n)},[n]),u.jsx(G,{title:b,breadcrumbs:j,onSaveClick:()=>Q(n),disableSaveButton:(n==null?void 0:n.client_id.length)===0||g,children:k?u.jsx("div",{className:"flex justify-center items-center",children:u.jsx(M,{})}):u.jsxs("div",{className:"space-y-4",children:[u.jsx(H,{tabs:$}),u.jsx(J,{context:{credit:n,setCredit:d,errors:T,isDefaultTerms:x,setIsDefaultTerms:A,isDefaultFooter:v,setIsDefaultFooter:B,client:l,invoiceSum:D}})]})})}export{ce as default};
