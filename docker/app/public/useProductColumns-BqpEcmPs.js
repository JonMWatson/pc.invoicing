import{u as F,y as k,ao as A,cx as O,cy as q,j as s,bm as B,i as D,bh as M,p as f,cz as V,cA as z,cB as H,a as y,t as C,bu as m,cv as S,bc as R,cu as U,ct as G,w as J,C as K,ax as Q,cC as X,bB as Y,b0 as Z,cD as P,cE as b}from"./bundle.D3-hVUGj.js";import{I as E}from"./InvoiceViewer-CknzAqf8.js";function W(){var n,u;const[e]=F(),t=k(),{isOwner:i}=A();return!O()&&!q()&&i?s.jsxs("div",{className:"flex text-base space-x-1",children:[s.jsx(B,{className:"capitalize",to:((n=t==null?void 0:t.company_user)==null?void 0:n.ninja_portal_url)||D("/settings/account_management"),setBaseFont:!0,external:!!((u=t==null?void 0:t.company_user)!=null&&u.ninja_portal_url),children:e("click_here")}),s.jsxs("span",{children:[M("pro_plan_remove_logo",{link:""}),"."]})]}):null}function ue(e){var r,d,h,o,a,g,_;const[t,i]=f.useState(!1),n=e.endpoint||"/api/v1/live_preview?entity=:entity",u=f.useRef(null);return f.useEffect(()=>{if(!e.observable)return;const x=new IntersectionObserver(l=>{l.forEach(j=>{j.isIntersecting?i(!0):i(!1)},{threshold:.1})});return u.current&&x.observe(u.current),()=>{x.disconnect()}},[u.current]),f.useEffect(()=>{e.observable},[e.resource]),(r=e.resource)!=null&&r[e.relationType]&&e.for==="create"?s.jsx("div",{ref:u,children:s.jsx(E,{link:V(n,{entity:e.entity}),resource:e.resource,method:"POST"})}):(d=e.resource)!=null&&d.id&&((h=e.resource)!=null&&h[e.relationType])&&e.entity==="purchase_order"?s.jsxs("div",{className:"flex flex-col space-y-3",children:[s.jsx(E,{link:V("/api/v1/live_preview/purchase_order?entity=:entity&entity_id=:id",{entity:e.entity,id:(o=e.resource)==null?void 0:o.id}),resource:e.resource,method:"POST"}),e.withRemoveLogoCTA&&s.jsx(W,{})]}):(a=e.resource)!=null&&a.id&&((g=e.resource)!=null&&g[e.relationType])&&e.for==="invoice"?s.jsxs("div",{className:"flex flex-col space-y-3",children:[s.jsx("div",{ref:u,children:s.jsx(E,{link:V("/api/v1/live_preview?entity=:entity&entity_id=:id",{entity:e.entity,id:(_=e.resource)==null?void 0:_.id}),method:"POST",resource:e.resource,enabled:e.observable?t:!0})}),e.withRemoveLogoCTA&&s.jsx(W,{})]}):s.jsx(s.Fragment,{})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://opensource.org/licenses/AAL
 */function ee(e){const[t,i]=e.split("$");return{dollar:t,property:i}}function te(e){const t=e.resource,i=e.invoiceSum,n=z(),u=H({resource:e.resource,relationType:e.relationType});y();const r=C(),d=(o,a)=>{e.onChange(o,a)},h={total:"amount",outstanding:"balance"};return o=>{let a=0;const{property:g}=ee(o),_=h[g]||g;return o=="$net_subtotal"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.subTotal)})}):o=="$discount"&&i?i.totalDiscount!=0?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.totalDiscount)})}):"":o=="$subtotal"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.subTotal)})}):o=="$total_taxes"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.totalTaxes)})}):o=="$line_taxes"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.invoiceItems.totalTaxes)})}):o=="$total"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.total)})}):o=="$paid_to_date"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.invoice.paid_to_date)})}):o=="$balance_due"&&i?s.jsx(m,{leftSide:n(o,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(i.getBalanceDue())})}):o=="$taxes"&&i?i.getTaxMap().count()>0?s.jsx(s.Fragment,{children:i.getTaxMap().map((x,l)=>s.jsx(m,{leftSide:x.name,className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(x.total)})},l))}):null:o==="$custom_surcharge1"?s.jsx(S,{field:"surcharge1",defaultValue:(t==null?void 0:t.custom_surcharge1)||"",value:(r==null?void 0:r.custom_fields.surcharge1)||"",onValueChange:x=>d("custom_surcharge1",x)}):o==="$custom_surcharge2"?s.jsx(S,{field:"surcharge2",defaultValue:(t==null?void 0:t.custom_surcharge2)||"",value:(r==null?void 0:r.custom_fields.surcharge2)||"",onValueChange:x=>d("custom_surcharge2",x)}):o==="$custom_surcharge3"?s.jsx(S,{field:"surcharge3",defaultValue:(t==null?void 0:t.custom_surcharge3)||"",value:(r==null?void 0:r.custom_fields.surcharge3)||"",onValueChange:x=>d("custom_surcharge3",x)}):o==="$custom_surcharge4"?s.jsx(S,{field:"surcharge4",defaultValue:(t==null?void 0:t.custom_surcharge4)||"",value:(r==null?void 0:r.custom_fields.surcharge4)||"",onValueChange:x=>d("custom_surcharge4",x)}):(t&&(a=t[_]??0),s.jsx(m,{leftSide:n(_,"$"),className:"py-5",noVerticalPadding:!0,noExternalPadding:!0,pushContentToRight:!0,withoutWrappingLeftSide:!0,children:s.jsx("span",{className:"text-sm font-medium font-mono",children:u(a)})}))}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function ne(){const e=C(),[t,i]=f.useState([]);return f.useEffect(()=>{var u,r,d,h;if((e==null?void 0:e.settings.pdf_variables.total_columns.length)>0){const o=R.cloneDeep(e==null?void 0:e.settings.pdf_variables.total_columns);(e==null?void 0:e.enabled_tax_rates)>0&&o.push("$tax1"),(e==null?void 0:e.enabled_tax_rates)>1&&o.push("$tax2"),(e==null?void 0:e.enabled_tax_rates)>2&&o.push("$tax3"),i(o);return}let n=["$subtotal"];n.push("$total"),(u=e==null?void 0:e.custom_fields)!=null&&u.surcharge1||(n=n.filter(o=>o!=="$custom_surcharge1")),(r=e==null?void 0:e.custom_fields)!=null&&r.surcharge2||(n=n.filter(o=>o!=="$custom_surcharge2")),(d=e==null?void 0:e.custom_fields)!=null&&d.surcharge3||(n=n.filter(o=>o!=="$custom_surcharge3")),(h=e==null?void 0:e.custom_fields)!=null&&h.surcharge4||(n=n.filter(o=>o!=="$custom_surcharge4")),n.push("$discount"),n.push("$paid_to_date"),n.push("$balance_due"),n.push("$taxes"),(e==null?void 0:e.enabled_tax_rates)>0&&n.push("$tax1"),(e==null?void 0:e.enabled_tax_rates)>1&&n.push("$tax2"),(e==null?void 0:e.enabled_tax_rates)>2&&n.push("$tax3"),i(n)},[e]),t}function N(e){const[t,i]=f.useState(""),n=C();return f.useEffect(()=>{const[u]=[n.custom_fields[e.field],""];i(u||"")},[]),s.jsx(m,{leftSide:t,className:e.elementClassName,style:e.elementStyle,noExternalPadding:e.elementNoExternalPadding,withoutWrappingLeftSide:e.elementWithoutWrappingLeftSide,children:e.type==="number"?s.jsx(U,{...e}):s.jsx(G,{...e})})}function ie(e){const t=e.resource,[i]=F(),n=f.useRef(null),u=y(),r=C(),d=ne(),h=J(),o=te({resource:t,onChange:e.onChange,invoiceSum:e.invoiceSum,relationType:e.relationType}),a=(l,j)=>e.onChange(l,j),g=()=>!!(r.enabled_tax_rates===0&&(t!=null&&t.tax_name1||t!=null&&t.tax_name2||t!=null&&t.tax_name3)||r.enabled_item_tax_rates===0&&(t!=null&&t.line_items.some(({tax_name1:l,tax_name2:j,tax_name3:T})=>l||j||T))),_=l=>l==="$tax1"||l==="$tax2"||l==="$tax3",x=l=>l==="$custom_surcharge1"||l==="$custom_surcharge2"||l==="$custom_surcharge3"||l==="$custom_surcharge4";return s.jsxs(K,{className:"col-span-12 xl:col-span-4 shadow-sm pb-6",withoutBodyPadding:!0,height:"full",style:{borderColor:u.$24,height:"100%"},innerRef:n,children:[g()&&s.jsxs("div",{className:"flex items-center space-x-3 px-6 pt-4",children:[s.jsx("div",{children:s.jsx(Q,{element:X,size:20,color:"orange"})}),s.jsx("div",{className:"text-sm font-medium",children:Y(i("hidden_taxes_warning"),":link",()=>s.jsx(B,{to:"/settings/tax_settings",children:i("settings")}))})]}),s.jsx("div",{className:"px-6",children:s.jsx("div",{className:Z("divide-y divide-dashed",{"divide-[#09090B1A]":!h.dark_mode,"divide-[#1f2e41]":h.dark_mode}),children:d.map((l,j)=>{var T,w,I,L;return s.jsxs(f.Fragment,{children:[_(l)&&s.jsxs(s.Fragment,{children:[!!(r&&r.enabled_tax_rates>0&&l==="$tax1")&&s.jsx(m,{leftSide:i("tax"),noExternalPadding:!0,children:s.jsx(P,{defaultValue:b(t,"tax_name1"),onChange:c=>{var $,p;a("tax_name1",($=c.resource)==null?void 0:$.name),a("tax_rate1",(p=c.resource)==null?void 0:p.rate)},onClearButtonClick:()=>{a("tax_name1",""),a("tax_rate1",0)},onTaxCreated:c=>{a("tax_name1",c.name),a("tax_rate1",c.rate)},resourceTaxName:t.tax_name1,resourceTaxRate:t.tax_rate1})}),!!(r&&r.enabled_tax_rates>1&&l==="$tax2")&&s.jsx(m,{leftSide:i("tax"),noExternalPadding:!0,children:s.jsx(P,{defaultValue:b(t,"tax_name2"),onChange:c=>{var $,p;a("tax_name2",($=c.resource)==null?void 0:$.name),a("tax_rate2",(p=c.resource)==null?void 0:p.rate)},onClearButtonClick:()=>{a("tax_name2",""),a("tax_rate2",0)},onTaxCreated:c=>{a("tax_name2",c.name),a("tax_rate2",c.rate)},resourceTaxName:t.tax_name2,resourceTaxRate:t.tax_rate2})}),!!(r&&r.enabled_tax_rates>2&&l==="$tax3")&&s.jsx(m,{leftSide:i("tax"),noExternalPadding:!0,children:s.jsx(P,{defaultValue:b(t,"tax_name3"),onChange:c=>{var $,p;a("tax_name3",($=c.resource)==null?void 0:$.name),a("tax_rate3",(p=c.resource)==null?void 0:p.rate)},onClearButtonClick:()=>{a("tax_name3",""),a("tax_rate3",0)},onTaxCreated:c=>{a("tax_name3",c.name),a("tax_rate3",c.rate)},resourceTaxName:t.tax_name3,resourceTaxRate:t.tax_rate3})})]}),x(l)&&s.jsxs(s.Fragment,{children:[!!(r&&((T=r==null?void 0:r.custom_fields)!=null&&T.surcharge1)&&l==="$custom_surcharge1")&&s.jsx(N,{field:"surcharge1",type:"number",defaultValue:t==null?void 0:t.custom_surcharge1,value:t==null?void 0:t.custom_surcharge1,onValueChange:c=>a("custom_surcharge1",parseFloat(c)),elementNoExternalPadding:!0,elementClassName:"py-5",elementWithoutWrappingLeftSide:!0}),!!(r&&((w=r==null?void 0:r.custom_fields)!=null&&w.surcharge2)&&l==="$custom_surcharge2")&&s.jsx(N,{field:"surcharge2",type:"number",defaultValue:t==null?void 0:t.custom_surcharge2,value:t==null?void 0:t.custom_surcharge2,onValueChange:c=>a("custom_surcharge2",parseFloat(c)),elementNoExternalPadding:!0,elementClassName:"py-5",elementWithoutWrappingLeftSide:!0}),!!(r&&((I=r==null?void 0:r.custom_fields)!=null&&I.surcharge3)&&l==="$custom_surcharge3")&&s.jsx(N,{field:"surcharge3",type:"number",defaultValue:t==null?void 0:t.custom_surcharge3,value:t==null?void 0:t.custom_surcharge3,onValueChange:c=>a("custom_surcharge3",parseFloat(c)),elementNoExternalPadding:!0,elementClassName:"py-5",elementWithoutWrappingLeftSide:!0}),!!(r&&((L=r==null?void 0:r.custom_fields)!=null&&L.surcharge4)&&l==="$custom_surcharge4")&&s.jsx(N,{field:"surcharge4",type:"number",defaultValue:t==null?void 0:t.custom_surcharge4,value:t==null?void 0:t.custom_surcharge4,onValueChange:c=>a("custom_surcharge4",parseFloat(c)),elementNoExternalPadding:!0,elementClassName:"py-5",elementWithoutWrappingLeftSide:!0})]}),!_(l)&&!x(l)&&s.jsx(s.Fragment,{children:o(l)})]},j)})})})]})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const se=(e,t,i)=>{const n=t.findIndex(r=>r===e);return n>-1?n:i.length},v=(e,t,i)=>{const n=i.slice(0,e),u=i.slice(e);return n.concat(t,u)};function oe(){const e=C(),[t,i]=f.useState([]);return f.useEffect(()=>{let n=R.clone(e==null?void 0:e.settings.pdf_variables.product_columns)||[],u=R.clone(e==null?void 0:e.settings.pdf_variables.product_columns)||[];const r=u.length;n.includes("$product.item")||(n=["$product.item",...n],u=["$product.item",...u]),r||n.push("$product.description"),n.includes("$product.unit_cost")||(n.push("$product.unit_cost"),u.push("$product.unit_cost")),n.includes("$product.quantity")||(n.push("$product.quantity"),u.push("$product.quantity"));const d=[],h=(e==null?void 0:e.enabled_item_tax_rates)||0;h>0&&d.push("$product.tax_rate1"),h>1&&d.push("$product.tax_rate2"),h>2&&d.push("$product.tax_rate3");const o=se("$product.tax",u,n);n=v(o,d,n),u=v(o,d,u),n=n.filter(a=>a!=="$product.tax"),u=u.filter(a=>a!=="$product.tax"),e.enable_product_discount||(n=n.filter(a=>a!=="$product.discount"),u=u.filter(a=>a!=="$product.discount")),e.enable_product_discount&&!n.includes("$product.discount")&&(n.push("$product.discount"),u.push("$product.discount")),["product1","product2","product3","product4"].forEach(a=>{e!=null&&e.custom_fields[a]&&!u.includes(`$product.${a}`)&&(n=v(n.length,[`$product.${a}`],n)),!(e!=null&&e.custom_fields[a])&&u.includes(`$product.${a}`)&&(n=n.filter(g=>g!==`$product.${a}`),u=u.filter(g=>g!==`$product.${a}`))}),e!=null&&e.enable_product_quantity||(n=n.filter(a=>a!=="$product.quantity")),n.includes("$product.tax_amount")&&(n=n.filter(a=>a!=="$product.tax_amount"),n.push("$product.tax_amount")),n.includes("$product.gross_line_total")&&(n=n.filter(a=>a!=="$product.gross_line_total"),n.push("$product.gross_line_total")),n.includes("$product.line_total")&&(n=n.filter(a=>a!=="$product.line_total"),n.push("$product.line_total")),i(n)},[e]),t}export{ie as I,ue as a,se as g,v as i,oe as u};
