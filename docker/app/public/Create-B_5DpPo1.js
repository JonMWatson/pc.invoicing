import{L as k,u as w,t as P,bK as L,bQ as K,ad as O,Z as U,et as W,p as i,cl as Z,ew as z,ev as G,bc as b,j as c,Q as H,bR as J,bS as M,S as V}from"./bundle.D3-hVUGj.js";import{b as X}from"./blank-invitation-DyrJ7EfP.js";import{a as Y}from"./queries-B9zpGE70.js";function se(){const{documentTitle:j}=k("new_quote"),[f]=w(),C=[{name:f("quotes"),href:"/quotes"},{name:f("new_quote"),href:"/quotes/create"}],$=[{name:f("create"),href:"/quotes/create"},{name:f("documents"),href:"/quotes/create/documents"},{name:f("settings"),href:"/quotes/create/settings"}],a=P(),[r]=L(),[n,_]=K(O),[q]=U(W),[d,D]=i.useState(),[E,Q]=i.useState(),[g,T]=i.useState(!1),[x,y]=i.useState(!1),[v,I]=i.useState(!1),R=Z(),{data:l,isLoading:A}=Y({enabled:typeof n>"u"}),B=z({setErrors:Q,isDefaultFooter:v,isDefaultTerms:x,isFormBusy:g,setIsFormBusy:T}),{handleChange:u,calculateInvoiceSum:F}=G({client:d}),m=(e,s)=>{var o,t,p,h,S;return(o=e==null?void 0:e.settings)!=null&&o[`tax_name${s}`]?{name:e.settings[`tax_name${s}`],rate:e.settings[`tax_rate${s}`]}:(p=(t=e==null?void 0:e.group_settings)==null?void 0:t.settings)!=null&&p[`tax_name${s}`]?{name:(h=e==null?void 0:e.group_settings)==null?void 0:h.settings[`tax_name${s}`],rate:(S=e==null?void 0:e.group_settings)==null?void 0:S.settings[`tax_rate${s}`]}:{name:a==null?void 0:a.settings[`tax_name${s}`],rate:a==null?void 0:a.settings[`tax_rate${s}`]}};return i.useEffect(()=>(_(e=>{var o;let s=e;if(r.get("action")!=="clone"&&(s=void 0),typeof l<"u"&&typeof s>"u"&&r.get("action")!=="clone"){const t=b.cloneDeep(l);return typeof t.line_items=="string"&&(t.line_items=[]),r.get("client")&&(t.client_id=r.get("client")),t.uses_inclusive_taxes=((o=a==null?void 0:a.settings)==null?void 0:o.inclusive_taxes)??!1,s=t}return s}),()=>{_(void 0)}),[l]),i.useEffect(()=>{n&&n.client_id.length>1&&R.find(n.client_id).then(e=>{D(e);const s=[];if(e.contacts.map(o=>{if(o.send_email){const t=b.cloneDeep(X);t.client_contact_id=o.id,s.push(t)}}),u("invitations",s),!e.is_tax_exempt){if(a&&a.enabled_tax_rates>0&&r.get("action")!=="clone"){const{name:o,rate:t}=m(e,"1");u("tax_name1",o),u("tax_rate1",t)}if(a&&a.enabled_tax_rates>1&&r.get("action")!=="clone"){const{name:o,rate:t}=m(e,"2");u("tax_name2",o),u("tax_rate2",t)}if(a&&a.enabled_tax_rates>2&&r.get("action")!=="clone"){const{name:o,rate:t}=m(e,"3");u("tax_name3",o),u("tax_rate3",t)}}})},[n==null?void 0:n.client_id]),i.useEffect(()=>{n&&F(n)},[n]),c.jsx(H,{title:j,breadcrumbs:C,onSaveClick:()=>B(n),disableSaveButton:(n==null?void 0:n.client_id.length)===0||g,children:A?c.jsx("div",{className:"flex justify-center items-center",children:c.jsx(V,{})}):c.jsxs("div",{className:"space-y-4",children:[c.jsx(J,{tabs:$}),c.jsx(M,{context:{quote:n,setQuote:_,errors:E,isDefaultTerms:x,setIsDefaultTerms:y,isDefaultFooter:v,setIsDefaultFooter:I,client:d,invoiceSum:q}})]})})}export{se as default};
