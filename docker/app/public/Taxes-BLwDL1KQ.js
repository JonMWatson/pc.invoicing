import{u as N,a as E,t as w,fv as H,d as Y,j as a,C as M,bu as c,dy as z,fw as O,ct as m,cP as W,bg as I,i as R,em as L,cq as q,fx as G,cO as Q,ax as U,cC as X,bB as Z,bm as J,cD as F,cE as A,cu as j,G as D,cv as k,w as K,bZ as ee,p,by as S,h as ae,ao as ne,D as te,fy as se}from"./bundle.D3-hVUGj.js";import{P as re}from"./ProjectSelector-DIb_VaTZ.js";import{C as le}from"./ClientActionButtons-YTWpr-RA.js";import{P as oe}from"./PaymentTypeSelector-B5RlAkj_.js";import{u as ie}from"./useResolveCurrencySeparator-ygcSKMxa.js";const ce=["tax_name1","tax_name2","tax_name3"];function he(h){var g,V,T,i,C,B;const[s]=N(),{expense:e,handleChange:t,taxInputType:o,pageType:d,errors:r}=h,u=E(),l=w(),{data:x}=H({status:["active"]}),f=Y(),v=z(),_=()=>!!(l.enabled_expense_tax_rates===0&&(e!=null&&e.tax_name1||e!=null&&e.tax_name2||e!=null&&e.tax_name3)),y=()=>x&&e?ce.map(n=>{const P=n.replace("name","rate"),$=n.replace("name","amount");if(e[n]&&!x.data.data.some(b=>(b.rate===e[P]||b.rate===e[$])&&b.name===e[n])){const b=e[P]||e[$];return`${e[n]}||${b}%`}return""}).filter(n=>n):[];return a.jsxs("div",{className:"flex flex-col space-y-4",children:[e&&a.jsx(M,{className:"shadow-sm",style:{borderColor:u.$24},children:a.jsx(c,{leftSide:s("expense_total"),withoutWrappingLeftSide:!0,children:f(v(e),(g=e.client)==null?void 0:g.country_id,e.currency_id||((V=e.client)==null?void 0:V.settings.currency_id))})}),a.jsxs(M,{title:s("details"),className:"shadow-sm",style:{borderColor:u.$24},headerStyle:{borderColor:u.$20},isLoading:!e,children:[e&&d==="edit"&&a.jsxs(a.Fragment,{children:[a.jsx(c,{leftSide:s("status"),children:a.jsx(O,{entity:e})}),a.jsx(c,{leftSide:s("number"),children:a.jsx(m,{id:"number",value:e.number,onValueChange:n=>t("number",n),errorMessage:r==null?void 0:r.errors.number})})]}),e&&a.jsx(c,{leftSide:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{children:s("vendor")}),e.vendor_id&&a.jsx(I,{to:R("/vendors/:id",{id:e.vendor_id}),target:"_blank",children:a.jsx("div",{children:a.jsx(L,{color:"#0062FF",size:"1.1rem"})})})]}),children:a.jsx(W,{value:e.vendor_id,onChange:n=>t("vendor_id",n.id),onClearButtonClick:()=>t("vendor_id",""),errorMessage:r==null?void 0:r.errors.vendor_id})}),e&&a.jsx(c,{leftSide:s("client"),children:a.jsxs("div",{className:"flex flex-col space-y-2",children:[a.jsx(q,{value:e.client_id,clearButton:!!e.client_id,onClearButtonClick:()=>t("client_id",""),onChange:n=>t("client_id",n.id),errorMessage:r==null?void 0:r.errors.client_id}),e.client_id&&a.jsx(le,{clientId:e.client_id})]})}),e&&a.jsx(c,{leftSide:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{children:s("project")}),e.project_id&&a.jsx(I,{to:R("/projects/:id",{id:e.project_id}),target:"_blank",children:a.jsx("div",{children:a.jsx(L,{color:"#0062FF",size:"1.1rem"})})})]}),children:a.jsx(re,{value:e.project_id,clearButton:!!e.project_id,onClearButtonClick:()=>t("project_id",""),onChange:n=>t("project_id",n.id),errorMessage:r==null?void 0:r.errors.project_id})}),e&&a.jsx(c,{leftSide:s("category"),children:a.jsx(G,{value:e.category_id,onClearButtonClick:()=>t("category_id",""),onChange:n=>t("category_id",n.id),errorMessage:r==null?void 0:r.errors.category_id})}),e&&a.jsx(c,{leftSide:s("user"),children:a.jsx(Q,{value:e.assigned_user_id,clearButton:!!e.assigned_user_id,onClearButtonClick:()=>t("assigned_user_id",""),onChange:n=>t("assigned_user_id",n.id),errorMessage:r==null?void 0:r.errors.assigned_user_id})}),_()&&a.jsxs("div",{className:"flex items-center space-x-3 px-6",children:[a.jsx("div",{children:a.jsx(U,{element:X,size:20,color:"orange"})}),a.jsx("div",{className:"text-sm font-medium",children:Z(s("hidden_taxes_warning"),":link",()=>a.jsx(J,{to:"/settings/tax_settings",children:s("settings")}))})]}),!!y().length&&a.jsx(c,{leftSide:s("taxes"),children:y().map(n=>a.jsxs("div",{className:"flex items-center space-x-2",children:[n.split("||")[0]&&a.jsx("span",{children:n.split("||")[0]}),a.jsx("span",{children:n.split("||")[1]})]},n))}),e&&(l==null?void 0:l.enabled_expense_tax_rates)>0&&o==="by_rate"&&a.jsx(c,{leftSide:s("tax"),children:a.jsx(F,{defaultValue:A(e,"tax_name1"),onClearButtonClick:()=>{t("tax_name1",""),t("tax_rate1",0)},onChange:n=>{n.resource&&t("tax_rate1",n.resource.rate),n.resource&&t("tax_name1",n.resource.name)},onTaxCreated:n=>{t("tax_rate1",n.rate),t("tax_name1",n.name)}})}),e&&(l==null?void 0:l.enabled_expense_tax_rates)>0&&o==="by_amount"&&a.jsx(c,{leftSide:s("tax"),children:a.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[a.jsx(m,{label:s("tax_name"),value:e.tax_name1,onValueChange:n=>t("tax_name1",n),errorMessage:r==null?void 0:r.errors.tax_name1,cypressRef:"taxNameByAmount1"}),a.jsx(j,{label:s("tax_amount"),value:e.tax_amount1||"",onValueChange:n=>t("tax_amount1",parseFloat(n)),errorMessage:r==null?void 0:r.errors.tax_amount1,cypressRef:"taxRateByAmount1"})]})}),e&&(l==null?void 0:l.enabled_expense_tax_rates)>1&&o==="by_rate"&&a.jsx(c,{leftSide:s("tax"),children:a.jsx(F,{defaultValue:A(e,"tax_name2"),onClearButtonClick:()=>{t("tax_name2",""),t("tax_rate2",0)},onChange:n=>{n.resource&&t("tax_rate2",n.resource.rate),n.resource&&t("tax_name2",n.resource.name)},onTaxCreated:n=>{t("tax_rate2",n.rate),t("tax_name2",n.name)}})}),e&&(l==null?void 0:l.enabled_expense_tax_rates)>1&&o==="by_amount"&&a.jsx(c,{leftSide:s("tax"),children:a.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[a.jsx(m,{label:s("tax_name"),value:e.tax_name2,onValueChange:n=>t("tax_name2",n),errorMessage:r==null?void 0:r.errors.tax_name2,cypressRef:"taxNameByAmount2"}),a.jsx(j,{label:s("tax_amount"),value:e.tax_amount2||"",onValueChange:n=>t("tax_amount2",parseFloat(n)),errorMessage:r==null?void 0:r.errors.tax_amount2,cypressRef:"taxRateByAmount2"})]})}),e&&(l==null?void 0:l.enabled_expense_tax_rates)>2&&o==="by_rate"&&a.jsx(c,{leftSide:s("tax"),children:a.jsx(F,{defaultValue:A(e,"tax_name3"),onClearButtonClick:()=>{t("tax_name3",""),t("tax_rate3",0)},onChange:n=>{n.resource&&t("tax_rate3",n.resource.rate),n.resource&&t("tax_name3",n.resource.name)},onTaxCreated:n=>{t("tax_rate3",n.rate),t("tax_name3",n.name)}})}),e&&(l==null?void 0:l.enabled_expense_tax_rates)>2&&o==="by_amount"&&a.jsx(c,{leftSide:s("tax"),children:a.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[a.jsx(m,{label:s("tax_name"),value:e.tax_name3,onValueChange:n=>t("tax_name3",n),errorMessage:r==null?void 0:r.errors.tax_name3}),a.jsx(j,{label:s("tax_amount"),value:e.tax_amount3||"",onValueChange:n=>t("tax_amount3",parseFloat(n)),errorMessage:r==null?void 0:r.errors.tax_amount3})]})}),e&&a.jsx(c,{leftSide:s("amount"),children:a.jsx(j,{value:e.amount||"",onValueChange:n=>t("amount",parseFloat(n)||0),errorMessage:r==null?void 0:r.errors.amount})}),e&&a.jsx(c,{leftSide:s("currency"),children:a.jsx(D,{value:e.currency_id,onChange:n=>t("currency_id",n),errorMessage:r==null?void 0:r.errors.currency_id,dismissable:!0})}),e&&a.jsx(c,{leftSide:s("date"),children:a.jsx(m,{type:"date",onValueChange:n=>t("date",n),errorMessage:r==null?void 0:r.errors.date,value:e.date})}),e&&((T=l==null?void 0:l.custom_fields)==null?void 0:T.expense1)&&a.jsx(k,{field:"expense1",defaultValue:e.custom_value1||"",value:l.custom_fields.expense1,onValueChange:n=>t("custom_value1",String(n))}),e&&((i=l==null?void 0:l.custom_fields)==null?void 0:i.expense2)&&a.jsx(k,{field:"expense2",defaultValue:e.custom_value2||"",value:l.custom_fields.expense2,onValueChange:n=>t("custom_value2",String(n))}),e&&((C=l==null?void 0:l.custom_fields)==null?void 0:C.expense3)&&a.jsx(k,{field:"expense3",defaultValue:e.custom_value3||"",value:l.custom_fields.expense3,onValueChange:n=>t("custom_value3",String(n))}),e&&((B=l==null?void 0:l.custom_fields)==null?void 0:B.expense4)&&a.jsx(k,{field:"expense4",defaultValue:e.custom_value4||"",value:l.custom_fields.expense4,onValueChange:n=>t("custom_value4",String(n))})]})]})}function fe(h){const[s]=N(),{expense:e,handleChange:t,errors:o}=h,d=E();return a.jsxs(M,{title:s("notes"),className:"shadow-sm",style:{borderColor:d.$24},headerStyle:{borderColor:d.$20},isLoading:!e,withContainer:!0,children:[e&&a.jsx(m,{value:e.public_notes,label:s("public_notes"),element:"textarea",onValueChange:r=>t("public_notes",r),errorMessage:o==null?void 0:o.errors.public_notes}),e&&a.jsx(m,{value:e.private_notes,label:s("private_notes"),element:"textarea",onValueChange:r=>t("private_notes",r),errorMessage:o==null?void 0:o.errors.private_notes})]})}function ge(h){const[s]=N(),{expense:e,handleChange:t,errors:o}=h,d=E(),r=w(),u=K(),l=ee(),x=ie(),[f,v]=p.useState({decimalSeparator:",",precision:2,thousandSeparator:"."}),[_,y]=p.useState(),g=()=>!!(e!=null&&e.payment_type_id)||!!(e!=null&&e.payment_date)||!!(e!=null&&e.transaction_reference),V=i=>{if(!i){t("payment_date",""),t("payment_type_id",""),t("transaction_reference","");return}t("payment_date",ae().format("YYYY-MM-DD"))},T=i=>{e&&i?(t("foreign_amount",i),e.amount&&t("exchange_rate",i/e.amount)):t("foreign_amount",0)};return p.useEffect(()=>{e&&e.exchange_rate&&e.invoice_currency_id?t("foreign_amount",e.amount*e.exchange_rate):t("foreign_amount",0)},[e==null?void 0:e.amount]),p.useEffect(()=>{if(e)if(t("invoice_currency_id",e.invoice_currency_id),e.invoice_currency_id&&e.currency_id){const i=l(e.invoice_currency_id),C=l(e.currency_id);if(i&&C){const B=i.exchange_rate/C.exchange_rate;t("exchange_rate",B)}}else t("foreign_amount",0),t("exchange_rate",1);else t("foreign_amount",0),t("exchange_rate",1);if(e!=null&&e.invoice_currency_id){const i=x(e.invoice_currency_id);i&&v(i)}},[e==null?void 0:e.invoice_currency_id,e==null?void 0:e.currency_id]),p.useEffect(()=>{e&&e.exchange_rate?e.amount&&e.invoice_currency_id&&t("foreign_amount",e.amount*e.exchange_rate):(t("exchange_rate",1),t("foreign_amount",0))},[e==null?void 0:e.exchange_rate]),p.useEffect(()=>{e&&typeof _>"u"&&y(!!(r!=null&&r.convert_expense_currency)||!!(e!=null&&e.foreign_amount))},[e]),a.jsxs(M,{title:s("additional_info"),className:"shadow-sm",style:{borderColor:d.$24},headerStyle:{borderColor:d.$20},isLoading:!e,children:[e&&a.jsx(c,{leftSide:s("should_be_invoiced"),leftSideHelp:s("mark_invoiceable_help"),children:a.jsx(S,{checked:e.should_be_invoiced,onChange:i=>t("should_be_invoiced",i),cypressRef:"shouldBeInvoicedToggle"})}),e&&a.jsx(c,{leftSide:s("mark_paid"),leftSideHelp:s("mark_paid_help"),children:a.jsx(S,{checked:g(),onChange:V,cypressRef:"markPaidToggle"})}),e&&g()&&a.jsx(c,{leftSide:s("payment_type"),children:a.jsx(oe,{value:e.payment_type_id,onChange:i=>t("payment_type_id",i),errorMessage:o==null?void 0:o.errors.payment_type_id})}),e&&g()&&a.jsx(c,{leftSide:s("date"),children:a.jsx(m,{type:"date",value:e.payment_date,onValueChange:i=>t("payment_date",i),errorMessage:o==null?void 0:o.errors.payment_date})}),e&&g()&&a.jsx(c,{leftSide:s("transaction_reference"),children:a.jsx(m,{value:e.transaction_reference,onValueChange:i=>t("transaction_reference",i),errorMessage:o==null?void 0:o.errors.transaction_reference})}),e&&a.jsx(c,{leftSide:s("convert_currency"),leftSideHelp:s("convert_expense_currency_help"),children:a.jsx(S,{checked:_||!1,onChange:i=>y(i),cypressRef:"convertCurrencyToggle"})}),e&&_&&a.jsxs(a.Fragment,{children:[a.jsx(c,{leftSide:s("currency"),children:a.jsx(D,{value:e.invoice_currency_id,onChange:i=>t("invoice_currency_id",i),dismissable:!0,errorMessage:o==null?void 0:o.errors.invoice_currency_id})}),a.jsx(c,{leftSide:s("exchange_rate"),children:a.jsx(j,{value:e.exchange_rate||"",onValueChange:i=>t("exchange_rate",parseFloat(i)),errorMessage:o==null?void 0:o.errors.exchange_rate,disablePrecision:!0})}),a.jsx(c,{leftSide:s("converted_amount"),children:a.jsx(j,{border:!0,precision:u!=null&&u.number_precision&&(u==null?void 0:u.number_precision)>0&&(u==null?void 0:u.number_precision)<=100?u.number_precision:(f==null?void 0:f.precision)||2,className:"auto",value:(e.foreign_amount||0).toString(),onValueChange:i=>T(parseFloat(i)),errorMessage:o==null?void 0:o.errors.foreign_amount,disablePrecision:!0})})]}),e&&a.jsx(c,{leftSide:s("add_documents_to_invoice"),leftSideHelp:s("add_documents_to_invoice_help"),children:a.jsx(S,{checked:e.invoice_documents,onChange:i=>t("invoice_documents",i),cypressRef:"addDocumentsToInvoiceToggle"})})]})}function pe(h){const[s]=N(),{isAdmin:e,isOwner:t}=ne(),{expense:o,handleChange:d,taxInputType:r,setTaxInputType:u}=h,l=E(),x=w(),f=_=>{_==="by_amount"?(d("tax_rate1",0),d("tax_rate2",0),d("tax_rate3",0)):(d("tax_amount1",0),d("tax_amount2",0),d("tax_amount3",0)),d("tax_name1",""),d("tax_name2",""),d("tax_name3","")},v=_=>{u(_),f(_),d("calculate_tax_by_amount",_==="by_amount")};return a.jsxs(M,{title:s("taxes"),className:"shadow-sm",style:{borderColor:l.$24},headerStyle:{borderColor:l.$20},isLoading:!o,children:[(x==null?void 0:x.enabled_expense_tax_rates)===0&&a.jsx(c,{leftSide:s("expense_tax_help"),children:a.jsx(te,{to:"/settings/tax_settings",renderSpan:!e&&!t,children:s("settings")})}),(x==null?void 0:x.enabled_expense_tax_rates)>0&&o&&a.jsx(c,{leftSide:s("enter_taxes"),children:a.jsx(se,{name:"enter_taxes",options:[{id:"by_rate",title:s("by_rate"),value:"by_rate"},{id:"by_amount",title:s("by_amount"),value:"by_amount"}],defaultSelected:r,onValueChange:_=>v(_)})}),(x==null?void 0:x.enabled_expense_tax_rates)>0&&o&&a.jsx(c,{leftSide:s("inclusive_taxes"),leftSideHelp:a.jsxs("span",{className:"flex flex-col",children:[a.jsxs("span",{children:[s("exclusive"),": 100 + 10% = 100 + 10"]}),a.jsxs("span",{children:[s("inclusive"),": 100 + 10% = 90.91 + 9.09"]})]}),children:a.jsx(S,{onChange:_=>d("uses_inclusive_taxes",_),checked:o.uses_inclusive_taxes,cypressRef:"inclusiveTaxesToggle"})})]})}export{ge as A,he as D,fe as N,pe as T};
