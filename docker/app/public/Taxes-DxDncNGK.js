import{u as T,a as B,t as I,bK as q,d as O,j as e,C as S,bu as i,dy as z,ct as x,cP as W,bg as D,i as P,ax as w,d6 as R,cq as G,fx as K,cO as U,cC as Z,bB as J,bm as Q,cD as A,cE as F,cu as p,G as Y,E as $,h as H,cv as k,w as X,bZ as E,p as j,by as b,ao as ee,D as ae,fy as te}from"./bundle.D3-hVUGj.js";import{P as ne}from"./ProjectSelector-DIb_VaTZ.js";import{i as se,j as L}from"./hooks-CvK-xUg4.js";import{C as le}from"./ClientActionButtons-YTWpr-RA.js";import{P as re}from"./PaymentTypeSelector-B5RlAkj_.js";import{u as oe}from"./useResolveCurrencySeparator-ygcSKMxa.js";function me(m){var v,f,M,V,c,C;const[l]=T(),t=B(),s=I(),[d]=q(),{recurringExpense:a,handleChange:r,taxInputType:_,pageType:g,errors:o}=m,h=O(),y=z(),u=()=>!!(s.enabled_expense_tax_rates===0&&(a!=null&&a.tax_name1||a!=null&&a.tax_name2||a!=null&&a.tax_name3));return e.jsxs("div",{className:"flex flex-col space-y-4",children:[a&&e.jsx(S,{className:"shadow-sm",style:{borderColor:t.$24},children:e.jsx(i,{leftSide:l("expense_total"),withoutWrappingLeftSide:!0,children:h(y(a),(v=a.client)==null?void 0:v.country_id,a.currency_id||((f=a.client)==null?void 0:f.settings.currency_id))})}),e.jsxs(S,{title:l("details"),isLoading:!a,className:"shadow-sm",style:{borderColor:t.$24},headerStyle:{borderColor:t.$20},children:[a&&g==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{leftSide:l("status"),children:e.jsx(se,{recurringExpense:a})}),e.jsx(i,{leftSide:l("number"),children:e.jsx(x,{id:"number",value:a.number,onValueChange:n=>r("number",n),errorMessage:o==null?void 0:o.errors.number})})]}),a&&e.jsx(i,{leftSide:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:l("vendor")}),a.vendor_id&&e.jsx(D,{to:P("/vendors/:id",{id:a.vendor_id}),target:"_blank",children:e.jsx(w,{element:R,size:18})})]}),children:e.jsx(W,{value:a.vendor_id,onChange:n=>r("vendor_id",n.id),onClearButtonClick:()=>r("vendor_id",""),errorMessage:o==null?void 0:o.errors.vendor_id})}),a&&e.jsx(i,{leftSide:l("client"),children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(G,{value:a.client_id,clearButton:!!a.client_id,onClearButtonClick:()=>r("client_id",""),onChange:n=>r("client_id",n.id),errorMessage:o==null?void 0:o.errors.client_id,disableWithSpinner:d.get("action")==="create"}),a.client_id&&e.jsx(le,{clientId:a.client_id})]})}),a&&e.jsx(i,{leftSide:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:l("project")}),a.project_id&&e.jsx(D,{to:P("/projects/:id",{id:a.project_id}),target:"_blank",children:e.jsx(w,{element:R,size:18})})]}),children:e.jsx(ne,{value:a.project_id,clearButton:!!a.project_id,onClearButtonClick:()=>r("project_id",""),onChange:n=>r("project_id",n.id),errorMessage:o==null?void 0:o.errors.project_id})}),a&&e.jsx(i,{leftSide:l("category"),children:e.jsx(K,{value:a.category_id,onClearButtonClick:()=>r("category_id",""),onChange:n=>r("category_id",n.id),errorMessage:o==null?void 0:o.errors.category_id})}),a&&e.jsx(i,{leftSide:l("user"),children:e.jsx(U,{value:a.assigned_user_id,clearButton:!!a.assigned_user_id,onClearButtonClick:()=>r("assigned_user_id",""),onChange:n=>r("assigned_user_id",n.id),errorMessage:o==null?void 0:o.errors.assigned_user_id})}),u()&&e.jsxs("div",{className:"flex items-center space-x-3 px-6",children:[e.jsx("div",{children:e.jsx(w,{element:Z,size:20,color:"orange"})}),e.jsx("div",{className:"text-sm font-medium",children:J(l("hidden_taxes_warning"),":link",()=>e.jsx(Q,{to:"/settings/tax_settings",children:l("settings")}))})]}),a&&(s==null?void 0:s.enabled_expense_tax_rates)>0&&_==="by_rate"&&e.jsx(i,{leftSide:l("tax"),children:e.jsx(A,{defaultValue:F(a,"tax_name1"),onClearButtonClick:()=>{r("tax_name1",""),r("tax_rate1",0)},onChange:n=>{n.resource&&r("tax_rate1",n.resource.rate),n.resource&&r("tax_name1",n.resource.name)},onTaxCreated:n=>{r("tax_rate1",n.rate),r("tax_name1",n.name)}})}),a&&(s==null?void 0:s.enabled_expense_tax_rates)>0&&_==="by_amount"&&e.jsx(i,{leftSide:l("tax"),children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[e.jsx(x,{label:l("tax_name"),value:a.tax_name1,onValueChange:n=>r("tax_name1",n),errorMessage:o==null?void 0:o.errors.tax_name1,cypressRef:"taxNameByAmount1"}),e.jsx(p,{label:l("tax_amount"),value:a.tax_amount1||"",onValueChange:n=>r("tax_amount1",parseFloat(n)),errorMessage:o==null?void 0:o.errors.tax_amount1,cypressRef:"taxRateByAmount1"})]})}),a&&(s==null?void 0:s.enabled_expense_tax_rates)>1&&_==="by_rate"&&e.jsx(i,{leftSide:l("tax"),children:e.jsx(A,{defaultValue:F(a,"tax_name2"),onClearButtonClick:()=>{r("tax_name2",""),r("tax_rate2",0)},onChange:n=>{n.resource&&r("tax_rate2",n.resource.rate),n.resource&&r("tax_name2",n.resource.name)},onTaxCreated:n=>{r("tax_rate2",n.rate),r("tax_name2",n.name)}})}),a&&(s==null?void 0:s.enabled_expense_tax_rates)>1&&_==="by_amount"&&e.jsx(i,{leftSide:l("tax"),children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[e.jsx(x,{label:l("tax_name"),value:a.tax_name2,onValueChange:n=>r("tax_name2",n),errorMessage:o==null?void 0:o.errors.tax_name2,cypressRef:"taxNameByAmount2"}),e.jsx(p,{label:l("tax_amount"),value:a.tax_amount2||"",onValueChange:n=>r("tax_amount2",parseFloat(n)),errorMessage:o==null?void 0:o.errors.tax_amount2,cypressRef:"taxRateByAmount2"})]})}),a&&(s==null?void 0:s.enabled_expense_tax_rates)>2&&_==="by_rate"&&e.jsx(i,{leftSide:l("tax"),children:e.jsx(A,{defaultValue:F(a,"tax_name3"),onClearButtonClick:()=>{r("tax_name3",""),r("tax_rate3",0)},onChange:n=>{n.resource&&r("tax_rate3",n.resource.rate),n.resource&&r("tax_name3",n.resource.name)},onTaxCreated:n=>{r("tax_rate3",n.rate),r("tax_name3",n.name)}})}),a&&(s==null?void 0:s.enabled_expense_tax_rates)>2&&_==="by_amount"&&e.jsx(i,{leftSide:l("tax"),children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-center space-y-4 xl:space-y-0 xl:space-x-4",children:[e.jsx(x,{label:l("tax_name"),value:a.tax_name3,onValueChange:n=>r("tax_name3",n),errorMessage:o==null?void 0:o.errors.tax_name3}),e.jsx(p,{label:l("tax_amount"),value:a.tax_amount3||"",onValueChange:n=>r("tax_amount3",parseFloat(n)),errorMessage:o==null?void 0:o.errors.tax_amount3})]})}),a&&e.jsx(i,{leftSide:l("amount"),children:e.jsx(p,{value:a.amount||"",onValueChange:n=>r("amount",parseFloat(n)||0),errorMessage:o==null?void 0:o.errors.amount})}),a&&e.jsx(i,{leftSide:l("currency"),children:e.jsx(Y,{value:a.currency_id,onChange:n=>r("currency_id",n),errorMessage:o==null?void 0:o.errors.currency_id,dismissable:!0})}),a&&e.jsx(i,{leftSide:l("date"),children:e.jsx(x,{type:"date",onValueChange:n=>r("date",n),value:a.date,errorMessage:o==null?void 0:o.errors.date})}),e.jsx(i,{leftSide:l("frequency"),children:e.jsx($,{value:a==null?void 0:a.frequency_id,onValueChange:n=>r("frequency_id",n),errorMessage:o==null?void 0:o.errors.frequency_id,children:Object.keys(L).map((n,N)=>e.jsx("option",{value:n,children:l(L[n])},N))})}),e.jsx(i,{leftSide:l("start_date"),children:e.jsx(x,{type:"date",onValueChange:n=>r("next_send_date",n),value:a!=null&&a.next_send_date?H(a==null?void 0:a.next_send_date).format("YYYY-MM-DD"):new Date().toISOString().split("T")[0],min:new Date().toISOString().split("T")[0],errorMessage:o==null?void 0:o.errors.next_send_date})}),e.jsx(i,{leftSide:l("remaining_cycles"),children:e.jsxs($,{value:a==null?void 0:a.remaining_cycles,onValueChange:n=>r("remaining_cycles",parseInt(n)),errorMessage:o==null?void 0:o.errors.remaining_cycles,children:[e.jsx("option",{value:"-1",children:l("endless")}),[...Array(37).keys()].map((n,N)=>e.jsx("option",{value:n,children:n},N))]})}),a&&((M=s==null?void 0:s.custom_fields)==null?void 0:M.expense1)&&e.jsx(k,{field:"recurringExpense1",defaultValue:a.custom_value1||"",value:s.custom_fields.expense1,onValueChange:n=>r("custom_value1",String(n))}),a&&((V=s==null?void 0:s.custom_fields)==null?void 0:V.expense2)&&e.jsx(k,{field:"recurringExpense2",defaultValue:a.custom_value2||"",value:s.custom_fields.expense2,onValueChange:n=>r("custom_value2",String(n))}),a&&((c=s==null?void 0:s.custom_fields)==null?void 0:c.expense3)&&e.jsx(k,{field:"recurringExpense3",defaultValue:a.custom_value3||"",value:s.custom_fields.expense3,onValueChange:n=>r("custom_value3",String(n))}),a&&((C=s==null?void 0:s.custom_fields)==null?void 0:C.expense4)&&e.jsx(k,{field:"recurringExpense4",defaultValue:a.custom_value4||"",value:s.custom_fields.expense4,onValueChange:n=>r("custom_value4",String(n))})]})]})}function he(m){const[l]=T(),{recurringExpense:t,handleChange:s,errors:d}=m,a=B();return e.jsxs(S,{title:l("notes"),isLoading:!t,withContainer:!0,className:"shadow-sm",style:{borderColor:a.$24},headerStyle:{borderColor:a.$20},children:[t&&e.jsx(x,{element:"textarea",label:l("public_notes"),value:t.public_notes,onValueChange:r=>s("public_notes",r),errorMessage:d==null?void 0:d.errors.public_notes}),t&&e.jsx(x,{element:"textarea",label:l("private_notes"),value:t.private_notes,onValueChange:r=>s("private_notes",r),errorMessage:d==null?void 0:d.errors.private_notes})]})}function fe(m){const[l]=T(),{recurringExpense:t,handleChange:s,errors:d}=m,a=B(),r=I(),_=X(),g=E(),o=oe(),[h,y]=j.useState({decimalSeparator:",",precision:2,thousandSeparator:"."}),[u,v]=j.useState(),f=()=>!!(t!=null&&t.payment_type_id)||!!(t!=null&&t.payment_date)||!!(t!=null&&t.transaction_reference),M=c=>{if(!c){s("payment_date",""),s("payment_type_id",""),s("transaction_reference","");return}s("payment_date",H().format("YYYY-MM-DD"))},V=c=>{t&&c?(s("foreign_amount",c),t.amount&&s("exchange_rate",c/t.amount)):s("foreign_amount",0)};return j.useEffect(()=>{t&&t.exchange_rate&&t.invoice_currency_id?s("foreign_amount",t.amount*t.exchange_rate):s("foreign_amount",0)},[t==null?void 0:t.amount]),j.useEffect(()=>{if(t)if(s("invoice_currency_id",t.invoice_currency_id),t.invoice_currency_id&&(t!=null&&t.currency_id)){const c=g(t.invoice_currency_id),C=g(t.currency_id);if(c&&C){const n=c.exchange_rate/C.exchange_rate;s("exchange_rate",n)}}else s("foreign_amount",0),s("exchange_rate",1);else s("foreign_amount",0),s("exchange_rate",1);if(t!=null&&t.invoice_currency_id){const c=o(t.invoice_currency_id);c&&y(c)}},[t==null?void 0:t.invoice_currency_id,t==null?void 0:t.currency_id]),j.useEffect(()=>{t&&t.exchange_rate?t.amount&&t.invoice_currency_id&&s("foreign_amount",t.amount*t.exchange_rate):(s("exchange_rate",1),s("foreign_amount",0))},[t==null?void 0:t.exchange_rate]),j.useEffect(()=>{t&&typeof u>"u"&&v(!!(r!=null&&r.convert_expense_currency)||!!(t!=null&&t.foreign_amount))},[t]),e.jsxs(S,{title:l("additional_info"),isLoading:!t,className:"shadow-sm",style:{borderColor:a.$24},headerStyle:{borderColor:a.$20},children:[t&&e.jsx(i,{leftSide:l("should_be_invoiced"),leftSideHelp:l("mark_invoiceable_help"),children:e.jsx(b,{checked:t.should_be_invoiced,onChange:c=>s("should_be_invoiced",c),cypressRef:"shouldBeInvoicedToggle"})}),t&&e.jsx(i,{leftSide:l("mark_paid"),leftSideHelp:l("mark_paid_help"),children:e.jsx(b,{checked:f(),onChange:M,cypressRef:"markPaidToggle"})}),t&&f()&&e.jsx(i,{leftSide:l("payment_type"),children:e.jsx(re,{value:t.payment_type_id,onChange:c=>s("payment_type_id",c),errorMessage:d==null?void 0:d.errors.payment_type_id})}),t&&f()&&e.jsx(i,{leftSide:l("date"),children:e.jsx(x,{type:"date",value:t.payment_date,onValueChange:c=>s("payment_date",c),errorMessage:d==null?void 0:d.errors.payment_date})}),t&&f()&&e.jsx(i,{leftSide:l("transaction_reference"),children:e.jsx(x,{value:t.transaction_reference,onValueChange:c=>s("transaction_reference",c),errorMessage:d==null?void 0:d.errors.transaction_reference})}),t&&e.jsx(i,{leftSide:l("convert_currency"),leftSideHelp:l("convert_expense_currency_help"),children:e.jsx(b,{checked:u||!1,onChange:c=>v(c),cypressRef:"convertCurrencyToggle"})}),t&&u&&e.jsxs(e.Fragment,{children:[e.jsx(i,{leftSide:l("currency"),children:e.jsx(Y,{value:t.invoice_currency_id,onChange:c=>s("invoice_currency_id",c),dismissable:!0,errorMessage:d==null?void 0:d.errors.invoice_currency_id})}),e.jsx(i,{leftSide:l("exchange_rate"),children:e.jsx(p,{value:t.exchange_rate||"",onValueChange:c=>s("exchange_rate",parseFloat(c)),errorMessage:d==null?void 0:d.errors.exchange_rate,disablePrecision:!0})}),e.jsx(i,{leftSide:l("converted_amount"),children:e.jsx(p,{border:!0,precision:_!=null&&_.number_precision&&(_==null?void 0:_.number_precision)>0&&(_==null?void 0:_.number_precision)<=100?_.number_precision:(h==null?void 0:h.precision)||2,className:"auto",value:(t.foreign_amount||0).toString(),onValueChange:c=>V(parseFloat(c)),errorMessage:d==null?void 0:d.errors.foreign_amount,disablePrecision:!0})})]}),t&&e.jsx(i,{leftSide:l("add_documents_to_invoice"),leftSideHelp:l("add_documents_to_invoice_help"),children:e.jsx(b,{checked:t.invoice_documents,onChange:c=>s("invoice_documents",c),cypressRef:"addDocumentsToInvoiceToggle"})})]})}function ge(m){const[l]=T(),t=B(),s=I(),{isAdmin:d,isOwner:a}=ee(),{recurringExpense:r,handleChange:_,taxInputType:g,setTaxInputType:o}=m,h=u=>{u==="by_amount"?(_("tax_rate1",0),_("tax_rate2",0),_("tax_rate3",0)):(_("tax_amount1",0),_("tax_amount2",0),_("tax_amount3",0)),_("tax_name1",""),_("tax_name2",""),_("tax_name3","")},y=u=>{o(u),h(u),_("calculate_tax_by_amount",u==="by_amount")};return e.jsxs(S,{title:l("taxes"),isLoading:!r,className:"shadow-sm",style:{borderColor:t.$24},headerStyle:{borderColor:t.$20},children:[!(s!=null&&s.enabled_expense_tax_rates)&&e.jsx(i,{leftSide:l("expense_tax_help"),children:e.jsx(ae,{to:"/settings/tax_settings",renderSpan:!d&&!a,children:l("settings")})}),(s==null?void 0:s.enabled_expense_tax_rates)>0&&r&&e.jsx(i,{leftSide:l("enter_taxes"),children:e.jsx(te,{name:"enter_taxes",options:[{id:"by_rate",title:l("by_rate"),value:"by_rate"},{id:"by_amount",title:l("by_amount"),value:"by_amount"}],defaultSelected:g,onValueChange:u=>y(u)})}),(s==null?void 0:s.enabled_expense_tax_rates)>0&&r&&e.jsx(i,{leftSide:l("inclusive_taxes"),leftSideHelp:e.jsxs("span",{className:"flex flex-col",children:[e.jsxs("span",{children:[l("exclusive"),": 100 + 10% = 100 + 10"]}),e.jsxs("span",{children:[l("inclusive"),": 100 + 10% = 90.91 + 9.09"]})]}),children:e.jsx(b,{checked:r.uses_inclusive_taxes,onChange:u=>_("uses_inclusive_taxes",u),cypressRef:"inclusiveTaxesToggle"})})]})}export{fe as A,me as D,he as N,ge as T};
