import{o as U,a7 as Q,ac as $,dD as z,dE as B,L as H,u as G,bO as J,ao as K,y as W,d9 as X,p as m,i as E,h as a,r as R,e as k,j as e,Q as Z,C as j,E as T,ct as P,bu as w,by as v,S as tt,d7 as et,aw as O,ax as S,a9 as at,aF as st,aE as nt,bd as g}from"./bundle.D3-hVUGj.js";var b={exports:{}},rt=b.exports,I;function it(){return I||(I=1,function(_,n){(function(r,f){_.exports=f()})(rt,function(){var r="month",f="quarter";return function(C,p){var d=p.prototype;d.quarter=function(i){return this.$utils().u(i)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(i-1))};var y=d.add;d.add=function(i,c){return i=Number(i),this.$utils().p(c)===f?this.add(3*i,r):y.bind(this)(i,c)};var D=d.startOf;d.startOf=function(i,c){var x=this.$utils(),u=!!x.u(c)||c;if(x.p(i)===f){var Y=this.quarter()-1;return u?this.month(3*Y).startOf(r).startOf("day"):this.month(3*Y+2).endOf(r).endOf("day")}return D.bind(this)(i,c)}}})}(b)),b.exports}var ot=it();const dt=U(ot);/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function lt(){const _=Q(),n=$(z);return r=>{n({...B,clients:[r.client_id],show_aging_table:r.show_aging_table,show_credits_table:r.show_credits_table,show_payments_table:r.show_payments_table,only_clients_with_invoices:r.only_clients_with_invoices,status:r.status,date_range:r.dateRangeId==="custom"?"last7_days":r.dateRangeId,entity:"invoice"}),_("/settings/schedules/create?template=email_statement")}}a.extend(dt);function ut(){var q;const{documentTitle:_}=H("statement"),{t:n}=G(),{id:r}=J(),{isAdmin:f,isOwner:C}=K(),p=W(),{data:d}=X({id:r,enabled:!0}),y=lt(),[D,i]=m.useState(!1),c=[{name:n("clients"),href:"/clients"},{name:n("client"),href:E("/clients/:id",{id:r})},{name:n("statement"),href:E("/clients/:id/statement",{id:r})}],x=[{id:"last7_days",start:a().subtract(7,"days").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")},{id:"last30_days",start:a().subtract(1,"month").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")},{id:"last365_days",start:a().subtract(365,"days").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")},{id:"this_month",start:a().startOf("month").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")},{id:"last_month",start:a().startOf("month").subtract(1,"month").format("YYYY-MM-DD"),end:a().subtract(1,"month").endOf("month").format("YYYY-MM-DD")},{id:"this_quarter",start:a().startOf("quarter").format("YYYY-MM-DD"),end:a().endOf("quarter").format("YYYY-MM-DD")},{id:"last_quarter",start:a().subtract(1,"quarter").startOf("quarter").format("YYYY-MM-DD"),end:a().subtract(1,"quarter").endOf("quarter").format("YYYY-MM-DD")},{id:"this_year",start:a().startOf("year").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")},{id:"last_year",start:a().subtract(1,"year").startOf("year").format("YYYY-MM-DD"),end:a().subtract(1,"year").endOf("year").format("YYYY-MM-DD")},{id:"custom",start:a().subtract(7,"days").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")}],u=m.useRef(null),[Y,N]=m.useState("last7_days"),[M,A]=m.useState(),[o,h]=m.useState({client_id:r,start_date:a().subtract(7,"days").format("YYYY-MM-DD"),end_date:a().format("YYYY-MM-DD"),show_aging_table:!0,show_payments_table:!0,show_credits_table:!0,only_clients_with_invoices:!1,status:"all",dateRangeId:"last7_days"}),L=t=>{const s=x.find(l=>l.id===t);s&&(N(t),h(l=>({...l,start_date:s.start,end_date:s.end,dateRangeId:t})))},V=()=>{if(!u.current)return;g.processing();const t=document.createElement("a");t.download="statement.pdf",t.href=u.current.src,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),g.dismiss()},F=()=>{var s;if(!((s=M==null?void 0:M.contacts)==null?void 0:s.some(l=>l.email)))return g.error("client_email_not_set");g.processing(),R("POST",k("/api/v1/client_statement?send_email=true"),o).then(l=>{g.success(l.data.message)})};return m.useEffect(()=>{d&&A(d)},[d]),m.useEffect(()=>{i(!0),R("POST",k("/api/v1/client_statement"),o,{responseType:"arraybuffer"}).then(t=>{const s=new Blob([t.data],{type:"application/pdf"}),l=URL.createObjectURL(s);u.current&&(u.current.src=l)}).finally(()=>i(!1))},[o]),e.jsxs(Z,{title:_,breadcrumbs:c,navigationTopRight:e.jsxs(et,{label:n("more_actions"),children:[((q=p==null?void 0:p.company_user)==null?void 0:q.is_admin)&&e.jsx(O,{onClick:F,icon:e.jsx(S,{element:at}),children:n("email")}),e.jsx(O,{onClick:V,icon:e.jsx(S,{element:st}),children:n("download")}),(f||C)&&e.jsx(O,{onClick:()=>y(o),icon:e.jsx(S,{element:nt}),children:n("schedule")})]}),children:[e.jsxs("div",{className:"grid grid-cols-12 space-y-4 xl:space-y-0 xl:gap-4",children:[e.jsxs(j,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:[e.jsx(T,{label:n("date_range"),value:Y,onValueChange:L,children:x.map((t,s)=>e.jsx("option",{value:t.id,children:n(t.id)},s))}),Y==="custom"&&e.jsx(P,{label:n("start_date"),type:"date",value:o.start_date,onValueChange:t=>t.length>1&&h(s=>({...s,start_date:t}))}),Y==="custom"&&e.jsx(P,{label:n("end_date"),type:"date",value:o.end_date,onValueChange:t=>t.length>1&&h(s=>({...s,end_date:t}))})]}),e.jsx(j,{className:"col-span-12 xl:col-span-4 h-max",withContainer:!0,children:e.jsxs(T,{label:n("status"),value:o.status,onValueChange:t=>h(s=>({...s,status:t})),children:[e.jsx("option",{value:"all",children:n("all")}),e.jsx("option",{value:"paid",children:n("paid")}),e.jsx("option",{value:"unpaid",children:n("unpaid")})]})}),e.jsxs(j,{className:"col-span-12 xl:col-span-4 h-max",children:[e.jsx(w,{leftSide:n("credits"),children:e.jsx(v,{checked:o.show_credits_table,onValueChange:t=>h(s=>({...s,show_credits_table:t}))})}),e.jsx(w,{leftSide:n("payments"),children:e.jsx(v,{checked:o.show_payments_table,onValueChange:t=>h(s=>({...s,show_payments_table:t}))})}),e.jsx(w,{leftSide:n("aging"),children:e.jsx(v,{checked:o.show_aging_table,onValueChange:t=>h(s=>({...s,show_aging_table:t}))})})]})]}),e.jsx("iframe",{className:"my-6",ref:u,width:"100%",height:1500,style:{display:D?"none":"block"},tabIndex:-1,loading:"lazy"}),D&&e.jsx("div",{className:"flex justify-center items-center mt-6",style:{height:1500},children:e.jsx(tt,{})})]})}export{ut as default};
