import{u as v,aq as g,j as n,aa as P,bh as T,t as O,a7 as w,p as x,aw as _,ax as b,a9 as N,ab as V,i as F,ac as q,bi as R,Y as z,at as H,a1 as J,aD as K,aF as C,aK as L,aI as Q,aL as W,aJ as X,bd as k,aS as Y,aO as G,z as U,bj as Z,w as $}from"./bundle.D3-hVUGj.js";import{u as ee}from"./useDownloadPdfs-C_Q3GnYI.js";import{u as te}from"./payments-w44xId2A.js";import{p as se}from"./atoms-6F-ixHOP.js";import{I as p}from"./invoice-status-We6cAxTk.js";import{i as ne}from"./Actions-OZ_Df7fS.js";import{a as ae}from"./useInvoiceColumns-YKQxY9Gc.js";import{u as oe}from"./useSumTableColumn-CIYkE3cT.js";function ie(){const t=O(),a=[{label:"initial_email",value:"invoice"},{label:"first_reminder",value:"reminder1"},{label:"second_reminder",value:"reminder2"},{label:"third_reminder",value:"reminder3"},{label:"endless_reminder",value:"reminder_endless"}];return t!=null&&t.settings.email_subject_custom1&&a.push({label:t==null?void 0:t.settings.email_subject_custom1,value:"custom1"}),t!=null&&t.settings.email_subject_custom2&&a.push({label:t==null?void 0:t.settings.email_subject_custom2,value:"custom2"}),t!=null&&t.settings.email_subject_custom3&&a.push({label:t==null?void 0:t.settings.email_subject_custom3,value:"custom3"}),a}function le(t){const{visible:a,setVisible:o,invoiceIds:u}=t,[m]=v(),r=g({onSuccess:()=>o(!1)}),l=ie();return n.jsx(P,{title:T("email_count_invoices",{count:u.length}),visible:a,onClose:()=>o(!1),closeButtonCypressRef:"sendEmailModalXButton",children:n.jsx("div",{children:l.map((d,f)=>n.jsx("div",{className:"flex justify-between py-2 cursor-pointer hover:bg-gray-100 pl-2",onClick:()=>{r(u,"email",d.value),t.setSelected([])},children:m(d.label)},f))})})}function ce(t){const{invoices:a}=t,[o]=v(),u=w(),[m,r]=x.useState(!1),[l,d]=x.useState(!1),f=()=>a.every(({client:c})=>c==null?void 0:c.contacts.some(({email:h})=>h)),j=()=>a.find(({client:c})=>!(c!=null&&c.contacts.some(({email:h})=>h)));return n.jsxs(n.Fragment,{children:[n.jsx(le,{visible:m,setVisible:r,invoiceIds:a.map(({id:c})=>c),setSelected:t.setSelected}),n.jsx(_,{onClick:()=>f()?r(!0):d(!0),icon:n.jsx(b,{element:N}),children:o("send_email")}),n.jsx(P,{title:o("contact_email"),visible:l,onClose:()=>d(!1),children:n.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[n.jsxs("span",{className:"text-base font-medium",children:[o("client_email_not_set"),"."]}),n.jsx(V,{className:"self-end",onClick:()=>{var c;u(F("/clients/:id/edit",{id:(c=j())==null?void 0:c.client_id})),d(!1)},children:o("edit_client")})]})})]})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function re(){const t=w(),a=q(se),{data:o}=te();return u=>{o&&(a({...o.data.data,invoices:[],credits:[],client_id:u[0].client_id}),u.forEach(m=>{a(r=>r&&{...r,invoices:[...r.invoices,{_id:R(),invoice_id:m.id,amount:m.balance>0?m.balance:m.amount}]})}),t("/payments/create?action=enter"))}}const je=()=>{const[t]=v(),a=Z(),o=z(),u=H({entity:"invoice"}),m=ee({entity:"invoice"}),r=re(),l=g(),d=e=>e.flatMap(({documents:s})=>s.map(({id:i})=>i)),f=e=>e.every(({is_deleted:s})=>!s),j=e=>!e.some(s=>!ne(s)),c=e=>{if(e.length){if(U(e).pluck("client_id").unique().toArray().length>1)return k.error("multiple_client_error");r(e)}},h=e=>!e.some(s=>parseInt(s.status_id)>parseInt(p.Partial)),I=e=>e.some(({documents:s})=>s.length),y=e=>!e.some(({status_id:s})=>s!==p.Sent),M=e=>!e.some(({status_id:s,is_deleted:i})=>s!==p.Draft||i),B=e=>!e.some(({status_id:s,is_deleted:i})=>parseInt(s)>parseInt(p.Partial)||i),E=(e,s)=>{const i=d(e);a(i,"download"),s==null||s([])},{setChangeTemplateVisible:D,setChangeTemplateResources:S,setChangeTemplateEntityContext:A}=J();return[({selectedResources:e,setSelected:s})=>n.jsx(ce,{invoices:e,setSelected:s}),({selectedIds:e,setSelected:s})=>n.jsx(_,{onClick:()=>{u(e),s([])},icon:n.jsx(b,{element:K}),children:t("print_pdf")}),({selectedIds:e,setSelected:s})=>n.jsx(_,{onClick:()=>{m(e),s([])},icon:n.jsx(b,{element:C}),children:t("download_pdf")}),({selectedIds:e,selectedResources:s,setSelected:i})=>j(s)&&n.jsx(_,{onClick:()=>{l(e,"auto_bill"),i([])},icon:n.jsx(b,{element:L}),children:t("auto_bill")}),({selectedIds:e,selectedResources:s,setSelected:i})=>M(s)&&n.jsx(_,{onClick:()=>{l(e,"mark_sent"),i([])},icon:n.jsx(b,{element:Q}),children:t("mark_sent")}),({selectedResources:e,setSelected:s})=>h(e)&&o("create_payment")&&n.jsx(_,{onClick:()=>{c(e),s([])},icon:n.jsx(b,{element:W}),children:t("enter_payment")}),({selectedIds:e,selectedResources:s,setSelected:i})=>B(s)&&n.jsx(_,{onClick:()=>{l(e,"mark_paid"),i([])},icon:n.jsx(b,{element:X}),children:t("mark_paid")}),({selectedResources:e,setSelected:s})=>f(e)&&n.jsx(_,{onClick:()=>I(e)?E(e,s):k.error("no_documents_to_download"),icon:n.jsx(b,{element:C}),children:t("documents")}),({selectedIds:e,selectedResources:s,setSelected:i})=>y(s)&&n.jsx(_,{onClick:()=>{l(e,"cancel"),i([])},icon:n.jsx(b,{element:Y}),children:t("cancel_invoice")}),({selectedResources:e})=>n.jsx(_,{onClick:()=>{D(!0),S(e),A({endpoint:"/api/v1/invoices/bulk",entity:"invoice"})},icon:n.jsx(b,{element:G}),children:t("run_template")})]};/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function xe(){var r;const[t]=v(),a=$(),o=oe();ae();const u=[{column:"amount",id:"amount",label:t("amount"),format:(l,d)=>o(l,d)},{column:"balance",id:"balance",label:t("balance"),format:(l,d)=>o(l,d)}],m=((r=a==null?void 0:a.table_footer_columns)==null?void 0:r.invoice)||[];return{footerColumns:u.filter(({id:l})=>m.includes(l)),allFooterColumns:u}}export{xe as a,je as u};
