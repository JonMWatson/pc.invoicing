import{L as k,u as B,bK as O,t as Q,cG as w,bQ as A,af as L,fI as N,p as n,fJ as G,bc as h,bi as J,j as r,Q as K,bR as V,bS as W,S as q}from"./bundle.D3-hVUGj.js";import{b as z}from"./blank-invitation-DyrJ7EfP.js";import{u as H}from"./useCalculateInvoiceSum-C_K56SBB.js";function Y(){const{documentTitle:v}=k("new_purchase_order"),[o]=B(),[c]=O(),l=Q(),x=w(),S=[{name:o("purchase_orders"),href:"/purchase_orders"},{name:o("new_purchase_order"),href:"/purchase_orders/create"}],b=[{name:o("create"),href:"/purchase_orders/create"},{name:o("documents"),href:"/purchase_orders/create/documents"},{name:o("settings"),href:"/purchase_orders/create/settings"}],[e,u]=A(L),{data:f,isLoading:g}=N({enabled:typeof e>"u"}),[j,m]=n.useState(),[y,E]=n.useState(),[I,C]=n.useState(!1),[p,D]=n.useState(!1),[_,T]=n.useState(!1),P=(i,t)=>{u(a=>a&&{...a,[i]:t})},F=H(m),R=G({setErrors:E,isDefaultTerms:p,isDefaultFooter:_,isFormBusy:I,setIsFormBusy:C});return n.useEffect(()=>(u(i=>{var a;let t=i;if(c.get("action")!=="clone"&&c.get("action")!=="purchase_order_product"&&(t=void 0),typeof f<"u"&&typeof t>"u"&&c.get("action")!=="clone"){const s=h.cloneDeep(f);typeof s.line_items=="string"&&(s.line_items=[]),c.get("vendor")&&(s.vendor_id=c.get("vendor")),s.line_items.forEach(d=>d._id=J()),s.invitations.forEach(d=>d.client_contact_id=d.client_contact_id||""),s.uses_inclusive_taxes=((a=l==null?void 0:l.settings)==null?void 0:a.inclusive_taxes)??!1,t=s}return t}),()=>{u(void 0)}),[f]),n.useEffect(()=>{e&&e.vendor_id&&x.find(e.vendor_id).then(i=>{const t=[];i.contacts.map(a=>{if(a.send_email){const s=h.cloneDeep(z);s.vendor_contact_id=a.id,t.push(s)}}),P("invitations",t)})},[e==null?void 0:e.vendor_id]),n.useEffect(()=>{e&&F(e)},[e]),r.jsx(K,{title:v,breadcrumbs:S,onSaveClick:()=>e&&R(e),children:g?r.jsx("div",{className:"flex justify-center items-center",children:r.jsx(q,{})}):r.jsxs("div",{className:"space-y-4",children:[r.jsx(V,{tabs:b}),r.jsx(W,{context:{purchaseOrder:e,setPurchaseOrder:u,errors:y,isDefaultTerms:p,setIsDefaultTerms:D,isDefaultFooter:_,setIsDefaultFooter:T,invoiceSum:j,setInvoiceSum:m}})]})})}export{Y as default};
