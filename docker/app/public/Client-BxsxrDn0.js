import{u as _,a as N,j as e,aZ as R,ce as V,bm as B,i as d,cs as J,t as K,I as ee,d as O,c$ as se,aU as H,aV as te,aY as ae,ao as le,d0 as ne,p as j,ac as oe,d1 as re,d2 as ce,b0 as T,d3 as ie,d4 as de,d5 as me,ax as D,d6 as ue,d7 as G,aw as U,aR as z,bG as W,bd as A,r as E,e as M,$ as k,H as q,M as xe,Y as Q,bp as X,bO as Y,bP as he,d8 as pe,w as L,a$ as Z,y as fe,b2 as ye,bc as S,bX as be,aa as je,E as _e,b9 as ge,ab as ve,be as Ne,bf as Ce,L as we,d9 as $e,cR as ke,a7 as Se,a1 as Ae,O as F,Q as Be,S as Te,bR as Pe,bS as De,a5 as Fe,a6 as Ie,bA as Ee}from"./bundle.D3-hVUGj.js";import{I as C}from"./InfoCard-DhU0axAB.js";import{P as Me}from"./PreviousNextNavigation-BpWEW6Fs.js";function Le(i){const[t]=_(),s=N(),{client:l}=i;return e.jsx(e.Fragment,{children:l&&e.jsx(C,{title:t("contacts"),className:"col-span-12 lg:col-span-6 xl:col-span-4 2xl:col-span-3 shadow-sm h-full 2xl:h-max p-4",style:{borderColor:s.$24},withoutPadding:!0,children:e.jsx("div",{className:"flex flex-col h-44 w-full overflow-y-auto",children:l.contacts.map((a,o)=>{var n,x;return!!(a.first_name||a.last_name||a.phone||a.email)&&e.jsxs("div",{className:"flex justify-between items-center first:pt-1 py-4 border-b border-dashed",style:{borderColor:s.$21},children:[e.jsxs("div",{className:"flex flex-col space-y-1 text-sm",children:[!!(a.first_name||a.last_name)&&e.jsxs("span",{className:"font-medium",style:{color:s.$3},children:[a.first_name," ",a.last_name]}),!!a.phone&&e.jsx("span",{className:"font-medium",style:{color:s.$22},children:a.phone}),!!a.email&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("span",{className:"font-medium",style:{color:s.$22},children:a.email}),e.jsx(R,{message:t("copy"),placement:"top",width:"auto",centerVertically:!0,children:e.jsx(V,{text:a.email})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{className:"cursor-pointer",to:d(`${(n=l.contacts[o])==null?void 0:n.link}?silent=true&client_hash=:clientHash`,{clientHash:l.client_hash}),external:!0,withoutExternalIcon:!0,children:t("client_portal")}),e.jsx(R,{message:t("copy_link"),placement:"top",width:"auto",centerVertically:!0,children:e.jsx(V,{text:d(`${(x=l.contacts[o])==null?void 0:x.link}?silent=true`)})})]})]}),a.is_locked&&e.jsx(J,{})]},o)})})})})}function Re(i){var u;const[t]=_(),{client:s}=i,l=N(),a=K();ee();const o=O(),n=se();H();const x=te(),m=()=>["client1","client2","client3","client4"].some(f=>{const y=n(f).label(),b=s[`custom_value${f.slice(-1)}`];return!!(y&&b)});return e.jsx(e.Fragment,{children:s&&e.jsx(C,{title:t("details"),className:"h-full 2xl:h-max col-span-12 lg:col-span-6 xl:col-span-4 2xl:col-span-3 shadow-sm p-4",style:{borderColor:l.$24},withoutPadding:!0,children:e.jsxs("div",{className:"flex flex-col pt-1 space-y-3 h-44 overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("status")}),e.jsx("div",{children:e.jsx(ae,{entity:s})})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("number")}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.$3},children:s.number})]}),s.group_settings_id&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("group")}),e.jsx(B,{className:"font-medium",to:d("/settings/group_settings/:id/edit",{id:s.group_settings_id}),children:(u=s.group_settings)==null?void 0:u.name})]}),s.website&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("website")}),e.jsx(B,{className:"font-medium",to:s.website,external:!0,style:{textAlign:"left"},children:s.website})]}),s.vat_number.length>1&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("vat_number")}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.$3},children:s.vat_number})]}),s.phone.length>1&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("phone")}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.$3},children:s.phone})]}),parseFloat(s.settings.default_task_rate)>0&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:t("task_rate")}),e.jsx("span",{className:"text-sm font-medium font-mono",style:{color:l.$3},children:s.settings.default_task_rate?o(s.settings.default_task_rate,s.country_id,s.settings.currency_id):o(a.settings.default_task_rate,s.country_id,a.settings.currency_id)})]}),!1,m()&&e.jsx("div",{className:"flex flex-col space-y-1",children:["client1","client2","client3","client4"].map(p=>{const f=n(p).label(),y=s[`custom_value${p.slice(-1)}`];return!!(f&&y)&&e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$22},children:f}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.$3},children:x(p,y)})]},p)})})]})})})}function Ve(i){const{client:t}=i,[s]=_(),l=N(),a=O();return e.jsx(e.Fragment,{children:t&&e.jsx(C,{title:s("standing"),className:"col-span-12 lg:col-span-6 xl:col-span-4 2xl:col-span-3 shadow-sm h-full 2xl:h-max p-4",style:{borderColor:l.$24},withoutPadding:!0,children:e.jsxs("div",{className:"flex flex-col h-44 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between border-b border-dashed pt-1.5 pb-3",style:{borderColor:l.$24},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$17},children:s("paid_to_date")}),e.jsx("span",{className:"text-sm font-mono",children:a(t.paid_to_date,t.country_id,t.settings.currency_id)})]}),e.jsxs("div",{className:"flex justify-between border-b border-dashed py-3",style:{borderColor:l.$24},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$17},children:s("outstanding")}),e.jsx("span",{className:"text-sm font-mono",children:a(t.balance,t.country_id,t.settings.currency_id)})]}),e.jsxs("div",{className:"flex justify-between border-b border-dashed py-3",style:{borderColor:l.$24},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$17},children:s("credit_balance")}),e.jsx("span",{className:"text-sm font-mono",children:a(t.credit_balance,t.country_id,t.settings.currency_id)})]}),e.jsxs("div",{className:"flex justify-between border-b border-dashed py-3",style:{borderColor:l.$24},children:[e.jsx("span",{className:"text-sm font-medium",style:{color:l.$17},children:s("payment_balance")}),e.jsx("span",{className:"text-sm font-mono",children:a(t.payment_balance,t.country_id,t.settings.currency_id)})]})]})})})}const I=q.div`
  &:hover {
    background-color: ${i=>i.theme.hoverBgColor};
  }
`;function Ge(i){const[t]=_(),{client:s}=i,{isAdmin:l}=le(),a=N(),{data:o}=ne(),[n,x]=j.useState(),[m,u]=j.useState(!1),[p,f]=j.useState(""),y=oe(re),b=c=>n==null?void 0:n.find(({id:w})=>w===c),v=c=>!!(c&&(c==="d14dd26a37cecc30fdd65700bfb55b23"||c==="d14dd26a47cecc30fdd65700bfb67b34")),r=()=>{p&&!m&&(A.processing(),u(!0),E("DELETE",M("/api/v1/client_gateway_tokens/:id",{id:p})).then(()=>{A.success("success"),k(["clients"]),f(""),y(!1)}).finally(()=>u(!1)))},h=c=>{E("POST",M("/api/v1/client_gateway_tokens/:id/setAsDefault",{id:c})).then(()=>{A.success("success"),k(["clients"])})};return j.useEffect(()=>{o&&x(o.data.data)},[o]),j.useEffect(()=>{p&&y(!0)},[p]),e.jsxs(e.Fragment,{children:[e.jsx(ce,{onClick:()=>r(),onClose:()=>f(""),disabledButton:m}),e.jsx(C,{title:t("payment_methods"),className:"h-full 2xl:h-max col-span-12 lg:col-span-6 xl:col-span-5 2xl:col-span-4 shadow-sm p-4",style:{borderColor:a.$24},withoutPadding:!0,children:e.jsx("div",{className:"flex flex-col h-44 overflow-y-auto text-sm",children:s.gateway_tokens.map(c=>{var w,g,$,P;return e.jsxs("div",{className:T("flex flex-col space-y-1.5 border-b border-dashed py-4",{"h-22":!c.is_default,"h-20":c.is_default}),style:{borderColor:a.$24},children:[e.jsxs("div",{className:"flex items-center justify-between h-12",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsxs("div",{className:"inline-flex items-center space-x-1",children:[e.jsx("div",{children:e.jsx(ie,{fontSize:22})}),e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx("span",{children:t("gateway")}),e.jsx(de,{size:20}),e.jsx(B,{to:d("/settings/gateways/:id/edit",{id:c.company_gateway_id}),children:(w=b(c.company_gateway_id))==null?void 0:w.label})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{name:c.meta.brand}),e.jsxs("div",{className:"flex items-center",style:{color:a.$17},children:[e.jsx("span",{className:"mt-1",children:"****"}),e.jsx("span",{className:"ml-1",children:c.meta.last4})]}),e.jsxs("span",{style:{color:a.$17},children:[c.meta.exp_month,"/",c.meta.exp_year]})]})]}),e.jsxs("div",{className:T("flex flex-col items-end h-full",{"justify-center":!v((g=b(c.company_gateway_id))==null?void 0:g.gateway_key)&&c.is_default,"justify-between":v(($=b(c.company_gateway_id))==null?void 0:$.gateway_key)&&c.is_default}),children:[v((P=b(c.company_gateway_id))==null?void 0:P.gateway_key)&&e.jsx(B,{external:!0,to:d("https://dashboard.stripe.com/customers/:customerReference",{customerReference:c.gateway_customer_reference}),children:e.jsx(D,{element:ue,size:18})}),c.is_default&&e.jsxs("div",{className:"inline-flex items-center text-xs",style:{height:"1.5rem"},children:[e.jsx("div",{className:"flex items-center border pr-2 pl-3 rounded-l-full h-full",style:{borderColor:a.$5,backgroundColor:a.$5},children:t("default")}),l&&e.jsx(G,{className:"rounded-bl-none rounded-tl-none h-full px-1 border-gray-200 border-l-1 border-y-0 border-r-0",customLabel:e.jsx(I,{className:"cursor-pointer pl-1 pr-2 border border-l-0 rounded-r-full h-full",style:{borderColor:a.$5,paddingTop:"0.24rem",paddingBottom:"0.24rem"},theme:{hoverBgColor:a.$4},children:e.jsx(W,{size:"0.9rem",color:a.$3})}),minWidth:"9rem",maxWidth:"11rem",children:e.jsx(U,{icon:e.jsx(D,{element:z}),onClick:()=>f(c.id),children:t("delete")})})]})]})]}),!c.is_default&&e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("div",{className:"inline-flex items-center text-xs cursor-pointer self-start",style:{height:"1.5rem"},children:[e.jsx(I,{className:"flex items-center border pr-2 pl-3 rounded-l-full h-full",onClick:()=>h(c.id),style:{borderColor:a.$5},theme:{hoverBgColor:a.$5},children:t("save_as_default")}),l&&e.jsx(G,{className:"rounded-bl-none rounded-tl-none h-full px-1 border-l-1 border-y-0 border-r-0",customLabel:e.jsx(I,{className:"cursor-pointer pl-1 pr-2 border border-l-0 rounded-r-full h-full",style:{borderColor:a.$5,paddingTop:"0.21rem",paddingBottom:"0.21rem"},theme:{hoverBgColor:a.$4},children:e.jsx(W,{size:"0.9rem",color:a.$3})}),minWidth:"10rem",maxWidth:"12rem",style:{borderColor:a.$5},children:e.jsx(U,{icon:e.jsx(D,{element:z}),onClick:()=>f(c.id),children:t("delete")})})]})})]},c.id)})})})]})}function Ue(i){const[t]=_(),s=xe(),l=Q(),a=X(),{id:o}=Y(),{client:n}=i;let x=[{name:t("invoices"),href:d("/clients/:id",{id:o})},{name:t("quotes"),href:d("/clients/:id/quotes",{id:o})},{name:t("payments"),href:d("/clients/:id/payments",{id:o})},{name:t("recurring_invoices"),href:d("/clients/:id/recurring_invoices",{id:o})},{name:t("credits"),href:d("/clients/:id/credits",{id:o})},{name:t("projects"),href:d("/clients/:id/projects",{id:o})},{name:t("tasks"),href:d("/clients/:id/tasks",{id:o})},{name:t("expenses"),href:d("/clients/:id/expenses",{id:o})},{name:t("recurring_expenses"),href:d("/clients/:id/recurring_expenses",{id:o})},{name:`${t("history")} / ${t("activity")}`,href:d("/clients/:id/history_and_activities",{id:o})},{name:t("documents"),href:d("/clients/:id/documents_overview",{id:o}),enabled:l("view_client")||l("edit_client")||a(n),formatName:()=>{var m;return e.jsx(he,{numberOfDocuments:(m=n==null?void 0:n.documents)==null?void 0:m.length})}},{name:t("settings"),href:d("/clients/:id/settings_configuration",{id:o})}];return pe.forEach(m=>{s(m.bitmask)||(x=x.filter(u=>u.name!==t(m.label)))}),x}function ze(i){const[t]=_(),{client:s}=i,l=N(),a=L();return e.jsx(e.Fragment,{children:!!(s&&s.public_notes)&&e.jsx(C,{title:t("public_notes"),className:"h-full 2xl:h-max col-span-12 lg:col-span-6 xl:col-span-4 2xl:col-span-3 shadow-sm p-4",style:{borderColor:l.$24},withoutPadding:!0,children:e.jsx("div",{className:"whitespace-normal h-44 overflow-y-auto pt-1",children:e.jsx("article",{className:T("prose prose-sm",{"prose-invert":a==null?void 0:a.dark_mode}),dangerouslySetInnerHTML:{__html:Z(s.public_notes)}})})})})}function We(i){const[t]=_(),{client:s}=i,l=N(),a=L();return e.jsx(e.Fragment,{children:!!(s&&s.private_notes)&&e.jsx(C,{title:t("private_notes"),className:"h-full 2xl:h-max col-span-12 lg:col-span-6 xl:col-span-4 2xl:col-span-3 shadow-sm p-4",style:{borderColor:l.$24},withoutPadding:!0,children:e.jsx("div",{className:"whitespace-normal h-44 overflow-y-auto pt-1",children:e.jsx("article",{className:T("prose prose-sm",{"prose-invert":a==null?void 0:a.dark_mode}),dangerouslySetInnerHTML:{__html:Z(s.private_notes)}})})})})}function Oe(i){var o,n;const{t}=_(),{client:s}=i,l=N(),a=H();return e.jsx(e.Fragment,{children:s&&e.jsx(C,{title:t("address"),withoutTruncate:!0,className:"shadow-sm h-full 2xl:h-max col-span-12 lg:col-span-6 xl:col-span-4 2xl:col-span-3 p-4",style:{borderColor:l.$24},withoutPadding:!0,children:e.jsxs("div",{className:"flex flex-col pt-1 h-44 overflow-y-auto",children:[(s.address1||s.address2)&&e.jsxs("span",{className:"break-all text-sm font-medium",style:{color:l.$3},children:[s.address1.length>0&&s.address1,s.address1.length>0&&e.jsx("br",{}),s.address2]}),(s.city||s.state||s.postal_code)&&e.jsxs("span",{className:"break-all text-sm font-medium",style:{color:l.$3},children:[s.city.length>0&&s.city,"  ",s.state,"  ",s.postal_code.length>0&&s.postal_code]}),((o=a(s.country_id))==null?void 0:o.name)&&e.jsx("span",{className:"break-all text-sm font-medium",style:{color:l.$3},children:(n=a(s.country_id))==null?void 0:n.name})]})})})}const He=q.div`
  background-color: ${i=>i.theme.backgroundColor};
  border-color: ${i=>i.theme.borderColor};

  &:hover {
    background-color: ${i=>i.theme.hoverColor};
  }
`,qe=["details","address","contacts","standing","gateways","public_notes","private_notes"];function Qe(){var b,v;const[i]=_(),t=fe(),s=N(),l=ye(),[a,o]=j.useState(!1),[n,x]=j.useState(!1),[m,u]=j.useState([]),p=r=>{u(h=>h.filter(c=>c!==r))},f=()=>{var r,h;(h=(r=t==null?void 0:t.company_user)==null?void 0:r.react_settings)!=null&&h.client_show_cards?u(S.cloneDeep(t.company_user.react_settings.client_show_cards)):u(["details","address","contacts","standing"]),o(!1)},y=()=>{if(!n){A.processing(),x(!0);const r=S.cloneDeep(t);S.set(r,"company_user.react_settings.client_show_cards",m),E("PUT",M("/api/v1/company_users/:id",{id:r.id}),r).then(h=>{S.set(r,"company_user",h.data.data),k(["company_users"]),l(Ne(r)),l(Ce()),A.success(),o(!1)}).finally(()=>{x(!1)})}};return j.useEffect(()=>{var r,h;(h=(r=t==null?void 0:t.company_user)==null?void 0:r.react_settings)!=null&&h.client_show_cards?u(S.cloneDeep(t.company_user.react_settings.client_show_cards.filter(c=>c!=="email_history"))):u(["details","address","contacts","standing"])},[(v=(b=t==null?void 0:t.company_user)==null?void 0:b.react_settings)==null?void 0:v.client_show_cards]),e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"p-1.5 sm:p-[0.6rem] border rounded-md shadow-sm cursor-pointer",theme:{hoverColor:s.$4,backgroundColor:s.$1,borderColor:s.$24},onClick:()=>o(!0),children:e.jsx(be,{size:"1.2rem",color:s.$3})}),e.jsx(je,{title:i("customize_cards"),visible:a,onClose:f,overflowVisible:!0,children:e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsx(_e,{label:i("cards"),value:"",onValueChange:r=>u(h=>[...h,r]),clearAfterSelection:!0,customSelector:!0,children:qe.filter(r=>!m.includes(r)).map(r=>e.jsx("option",{value:r,children:i(r)},r))}),m.length?e.jsx("div",{className:"flex flex-col space-y-3",children:m.map(r=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:s.$3},children:i(r)}),e.jsx("div",{className:"cursor-pointer",onClick:()=>p(r),children:e.jsx(ge,{color:s.$16,hoverColor:s.$3,borderColor:s.$5,hoverBorderColor:s.$17,size:"1.6rem"})})]},r))}):e.jsxs("span",{className:"text-sm font-medium",style:{color:s.$3},children:[i("no_cards_selected"),"."]}),e.jsx(ve,{behavior:"button",disableWithoutIcon:!0,disabled:n,onClick:y,children:i("save")})]})})]})}function Je(){const{documentTitle:i,setDocumentTitle:t}=we("view_client"),[s]=_(),[l,a]=j.useState(!1),{id:o}=Y(),{data:n,isLoading:x}=$e({id:o,enabled:!!o&&!l}),m=L(),u=[{name:s("clients"),href:"/clients"},{name:i,href:d("/clients/:id",{id:o})}],p=Ue({client:n}),f=ke({setIsPurgeOrMergeActionCalled:a}),y=Se(),b=Q(),v=X(),r=$=>(m.client_show_cards||["details","address","contacts","standing"]).includes($);j.useEffect(()=>(t((n==null?void 0:n.display_name)||"view_client"),()=>{a(!1)}),[n]);const{changeTemplateVisible:h,setChangeTemplateVisible:c,changeTemplateResources:w,changeTemplateEntityContext:g}=Ae();return F({on:"App\\Events\\Invoice\\InvoiceWasPaid",callback:()=>k(["invoices"])}),F({on:"App\\Events\\Payment\\PaymentWasUpdated",callback:()=>k(["payments"])}),F({on:["App\\Events\\Credit\\CreditWasCreated","App\\Events\\Credit\\CreditWasUpdated"],callback:()=>k(["credits"])}),e.jsxs(Be,{title:i,breadcrumbs:u,navigationTopRight:n&&(b("edit_client")||v(n))&&e.jsx(Ee,{resource:n,actions:f,saveButtonLabel:s("edit"),onSaveClick:()=>y(d("/clients/:id/edit",{id:o})),cypressRef:"clientActionDropdown"}),afterBreadcrumbs:e.jsxs("div",{className:"flex flex-1 justify-end items-center gap-2",children:[e.jsx(Me,{entity:"client"}),e.jsx(Qe,{})]}),children:[x&&e.jsx(Te,{}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 lg:space-y-0 gap-4",children:[r("details")&&e.jsx(Re,{client:n}),r("address")&&e.jsx(Oe,{client:n}),r("contacts")&&e.jsx(Le,{client:n}),r("standing")&&e.jsx(Ve,{client:n}),r("gateways")&&e.jsx(Ge,{client:n}),r("public_notes")&&e.jsx(ze,{client:n}),r("private_notes")&&e.jsx(We,{client:n})]}),e.jsx(Pe,{tabs:p,className:"mt-6"}),e.jsx("div",{className:"my-4",children:e.jsx(De,{context:{isPurgeOrMergeActionCalled:l,displayName:n.display_name}})}),e.jsx(Fe,{entity:(g==null?void 0:g.entity)??"client",entities:w,visible:h,setVisible:c,labelFn:$=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(Ie,{children:s("number")}),e.jsx("span",{children:$.number})]}),bulkUrl:(g==null?void 0:g.endpoint)??"/api/v1/clients/bulk"})]})]})}export{Je as default};
