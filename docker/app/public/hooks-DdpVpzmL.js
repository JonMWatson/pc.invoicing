import{bq as E,bI as F,bJ as Y,bd as b,r as S,e as P,$ as w,u as K,a7 as R,Y as H,ac as j,av as ie,ad as ne,ag as ae,af as oe,ah as se,p as ce,j as c,a8 as f,ai as Z,aa as re,aj as A,am as le,al as de,ak as ue,an as _e,h as N,t as z,ao as me,ap as pe,ae as J,at as ye,ar as fe,au as ve,as as he,a1 as be,aA as Ce,i as T,aB as xe,aC as ge,aD as ke,aF as L,aE as je,aG as Te,aH as Se,a9 as Pe,aM as we,aN as Ie,cd as Ae,aI as Me,aJ as De,aO as Ne,az as q,aP as Ee,aQ as Fe,aR as Ye,f as Ke,aT as Re,g as Le,d as qe,w as Oe,aU as Qe,aV as Ve,aW as X,l as k,D as O,ce as Be,aX as $e,aY as Ue,aZ as Q,a_ as V,a$ as M,b0 as B,bZ as He,Z as $,cf as Ze,bL as G,bM as W,bN as ee,b$ as ze,c0 as Je,c9 as Xe,b_ as Ge}from"./bundle.D3-hVUGj.js";import{C as D,a as We}from"./CreditStatus-DFPZx7rF.js";import{r as U}from"./useInvoiceColumns-YKQxY9Gc.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function et(){const o=E(),i=F(Y);return d=>{b.processing(),S("PUT",P("/api/v1/credits/:id?mark_sent=true",{id:d.id}),d).then(()=>{i&&o.invalidateQueries([i]),w(["credits"]),b.success("updated_credit")})}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function tt(){const o=E(),i=F(Y);return d=>{b.processing(),S("PUT",P("/api/v1/credits/:id?mark_paid=true",{id:d.id}),d).then(()=>{i&&o.invalidateQueries([i]),w(["credits"]),b.success("updated_credit")})}}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const it={email:"emailed_credits",mark_sent:"marked_credit_as_sent"},nt=()=>{const o=E(),i=F(Y);return(d,r)=>{b.processing(),S("POST",P("/api/v1/credits/bulk"),{action:r,ids:d}).then(()=>{const n=it[r]||`${r}d_credit`;b.success(n),w(["credits"]),i&&o.invalidateQueries([i])})}};function at(o){const[i]=K(),d=R(),{credit:r,dropdown:n}=o,u=H(),C=j(ie),h=j(ne),p=j(ae),x=j(oe),y=se(),[v,g]=ce.useState(!1),l=()=>{C({...r,id:"",number:"",documents:[],due_date:"",partial_due_date:"",date:N().format("YYYY-MM-DD"),total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",paid_to_date:0,po_number:"",design_id:y.settings.invoice_design_id}),d("/invoices/create?action=clone")},_=()=>{h({...r,id:"",number:"",documents:[],date:N().format("YYYY-MM-DD"),due_date:"",partial_due_date:"",total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",paid_to_date:0,po_number:"",design_id:y.settings.quote_design_id}),d("/quotes/create?action=clone")},e=()=>{p({...r,id:"",number:"",documents:[],frequency_id:"5",paid_to_date:0,total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",po_number:"",due_date:"",partial_due_date:"",design_id:y.settings.invoice_design_id}),d("/recurring_invoices/create?action=clone")},t=()=>{x({...r,id:"",number:"",documents:[],date:N().format("YYYY-MM-DD"),total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"1",vendor_id:"",po_number:"",due_date:"",partial_due_date:"",design_id:y.settings.purchase_order_design_id}),d("/purchase_orders/create?action=clone")};return c.jsxs(c.Fragment,{children:[(u("create_invoice")||u("create_quote")||u("create_recurring_invoice")||u("create_purchase_order"))&&c.jsx(f,{entity:"credit",actionKey:"clone_to_other",isCommonActionSection:!n,tooltipText:i("clone_to_other"),onClick:()=>g(!0),icon:Z,children:i("clone_to_other")}),c.jsx(re,{title:i("clone_to"),visible:v,onClose:()=>g(!1),closeButtonCypressRef:"cloneOptionsModalXButton",children:c.jsx("div",{className:"flex justify-center",children:c.jsxs("div",{className:"flex flex-1 flex-col items-center space-y-3",children:[u("create_invoice")&&c.jsx(A,{label:i("invoice"),icon:le,onClick:l}),u("create_quote")&&c.jsx(A,{label:i("quote"),icon:de,onClick:_}),u("create_recurring_invoice")&&c.jsx(A,{label:i("recurring_invoice"),icon:ue,onClick:e}),u("create_purchase_order")&&c.jsx(A,{label:i("purchase_order"),icon:_e,onClick:t})]})})})]})}function ut(o){const i=He(),d=z(),[r,n]=$(J),[,u]=$(Ze),C=(l,_)=>{n(e=>e&&{...e,[l]:_})};return{handleChange:C,handleInvitationChange:(l,_)=>{let e=[...r.invitations];const t=(e==null?void 0:e.find(s=>s.client_contact_id===l))||-1;if(t!==-1&&_===!1&&(e=e.filter(s=>s.client_contact_id!==l)),t===-1){const s={client_contact_id:l};e.push(s)}C("invitations",e)},handleLineItemChange:(l,_)=>{const e=(r==null?void 0:r.line_items)||[];e[l]=_,n(t=>t&&{...t,line_items:e})},handleLineItemPropertyChange:(l,_,e)=>{const t=(r==null?void 0:r.line_items)||[];t[e][l]!==_&&(t[e][l]=_,n(s=>s&&{...s,line_items:t}))},handleCreateLineItem:()=>{n(l=>l&&{...l,line_items:[...l.line_items,{...Ge(),type_id:Xe.Product,quantity:1}]})},handleDeleteLineItem:l=>{const _=(r==null?void 0:r.line_items)||[];_.splice(l,1),n(e=>e&&{...e,line_items:_})},calculateInvoiceSum:l=>{var e;const _=i(((e=o.client)==null?void 0:e.settings.currency_id)||(d==null?void 0:d.settings.currency_id));if(_&&l){const t=l.uses_inclusive_taxes?new ze(l,_).build():new Je(l,_).build();u(t)}}}}function _t(o){const{setErrors:i,isDefaultFooter:d,isDefaultTerms:r,isFormBusy:n,setIsFormBusy:u}=o,C=R(),h=G(),p=W(),x=j(ee);return async y=>{if(n)return;b.processing(),u(!0),i(void 0),await h({excludeToasters:!0});let v="/api/v1/credits?";r?(v+="save_default_terms=true",d&&(v+="&save_default_footer=true")):d&&(v+="save_default_footer=true"),S("POST",P(v),y).then(async g=>{(r||d)&&await p(),b.success("created_credit"),w(["credits"]),C(T("/credits/:id/edit",{id:g.data.data.id}))}).catch(g=>{var l;if(((l=g.response)==null?void 0:l.status)===422){const _=g.response.data;_.errors.amount||_.errors.invoice_id?b.error(_.errors.amount[0]||_.errors.invoice_id[0]):b.dismiss(),i(_)}}).finally(()=>{x(void 0),u(!1)})}}function mt(o){const{setErrors:i,isDefaultFooter:d,isDefaultTerms:r}=o,n=j(ee),u=W(),C=G();return async h=>{b.processing(),i(void 0),await C({excludeToasters:!0});let p="/api/v1/credits/:id?";r?(p+="save_default_terms=true",d&&(p+="&save_default_footer=true")):d&&(p+="save_default_footer=true"),S("PUT",P(p,{id:h.id}),h).then(async()=>{(r||d)&&await u(),b.success("updated_credit"),w(["credits"])}).catch(x=>{var y;if(((y=x.response)==null?void 0:y.status)===422){const v=x.response.data;v.errors.amount?b.error(v.errors.amount[0]):b.dismiss(),i(v)}}).finally(()=>n(void 0))}}function pt(o){const[i]=K(),d=R(),r=H(),{dropdown:n=!0}=o||{},u=z(),{isAdmin:C,isOwner:h}=me(),{isEditPage:p}=pe({entity:"credit",editPageTabs:["documents","settings","activity","history"]}),x=j(J),y=nt(),v=et(),g=tt(),l=ye({entity:"credit"}),_=fe({resource:"credit"}),e=ve({entity:"credit"}),t=he({resource:"credit",downloadType:"download_e_credit"}),{setChangeTemplateResources:s,setChangeTemplateVisible:m,setChangeTemplateEntityContext:I}=be(),te=a=>{x({...a,id:"",number:"",documents:[],date:N().format("YYYY-MM-DD"),due_date:"",total_taxes:0,exchange_rate:1,last_sent_date:"",project_id:"",subscription_id:"",status_id:"",vendor_id:"",paid_to_date:0,po_number:""}),d("/credits/create?action=clone")};return[a=>c.jsx(f,{...!n&&{key:"view_pdf"},entity:"credit",actionKey:"view_pdf",isCommonActionSection:!n,tooltipText:i("view_pdf"),to:T("/credits/:id/pdf",{id:a.id}),icon:Ce,children:i("view_pdf")}),a=>xe(a)!==ge.Deleted&&c.jsx(f,{...!n&&{key:"print_pdf"},entity:"credit",actionKey:"print_pdf",isCommonActionSection:!n,tooltipText:i("print_pdf"),onClick:()=>l([a.id]),icon:ke,disablePreventNavigation:!0,children:i("print_pdf")}),a=>c.jsx(f,{...!n&&{key:"download_pdf"},entity:"credit",actionKey:"download_pdf",isCommonActionSection:!n,tooltipText:i("download_pdf"),onClick:()=>_(a),icon:L,disablePreventNavigation:!0,children:i("download_pdf")}),a=>!!(u!=null&&u.settings.enable_e_invoice)&&c.jsx(f,{...!n&&{key:"download_e_credit"},entity:"credit",actionKey:"download_e_credit",isCommonActionSection:!n,tooltipText:i("download_e_credit"),onClick:()=>t(a),icon:L,disablePreventNavigation:!0,children:i("download_e_credit")}),a=>(C||h)&&c.jsx(f,{...!n&&{key:"schedule"},entity:"credit",actionKey:"schedule",isCommonActionSection:!n,tooltipText:i("schedule"),onClick:()=>e(a.id),icon:je,children:i("schedule")}),a=>c.jsx(Te,{...!n&&{key:"add_comment"},entity:"credit",entityId:a.id,label:a.number,labelElement:c.jsx(f,{entity:"credit",actionKey:"add_comment",isCommonActionSection:!n,tooltipText:i("add_comment"),icon:Se,disablePreventNavigation:!0,children:i("add_comment")})}),a=>c.jsx(f,{...!n&&{key:"email_credit"},entity:"credit",actionKey:"email_credit",isCommonActionSection:!n,tooltipText:i("email_credit"),to:T("/credits/:id/email",{id:a.id}),icon:Pe,children:i("email_credit")}),a=>c.jsx(f,{...!n&&{key:"client_portal"},entity:"credit",actionKey:"client_portal",isCommonActionSection:!n,tooltipText:i("client_portal"),onClick:()=>a&&Ie(a),icon:we,disablePreventNavigation:!0,children:i("client_portal")}),a=>a.client_id&&a.amount>0&&r("create_payment")&&c.jsx(f,{...!n&&{key:"apply_credit"},entity:"credit",actionKey:"apply_credit",isCommonActionSection:!n,tooltipText:i("apply_credit"),to:T("/payments/create?client=:clientId&credit=:creditId&type=1",{clientId:a.client_id,creditId:a.id}),icon:Ae,children:i("apply_credit")}),a=>a.status_id===D.Draft&&c.jsx(f,{...!n&&{key:"mark_sent"},entity:"credit",actionKey:"mark_sent",isCommonActionSection:!n,tooltipText:i("mark_sent"),onClick:()=>v(a),icon:Me,disablePreventNavigation:!0,children:i("mark_sent")}),a=>(a.status_id===D.Draft||a.status_id===D.Sent||a.status_id===D.Partial)&&a.amount<0&&c.jsx(f,{...!n&&{key:"mark_paid"},entity:"credit",actionKey:"mark_paid",isCommonActionSection:!n,tooltipText:i("mark_paid"),onClick:()=>g(a),icon:De,disablePreventNavigation:!0,children:i("mark_paid")}),a=>c.jsx(f,{...!n&&{key:"run_template"},entity:"credit",actionKey:"run_template",isCommonActionSection:!n,tooltipText:i("run_template"),onClick:()=>{m(!0),s([a]),I({endpoint:"/api/v1/credits/bulk",entity:"credit"})},icon:Ne,children:i("run_template")}),()=>c.jsx(q,{withoutPadding:!0}),a=>r("create_credit")&&c.jsx(f,{...!n&&{key:"clone_to_credit"},entity:"credit",actionKey:"clone_to_credit",isCommonActionSection:!n,tooltipText:i("clone_to_credit"),onClick:()=>te(a),icon:Z,children:i("clone_to_credit")}),a=>c.jsx(at,{...!n&&{key:"clone_to_other"},dropdown:n,credit:a}),()=>!!(p&&n)&&c.jsx(q,{withoutPadding:!0}),a=>p&&a.archived_at===0&&c.jsx(f,{...!n&&{key:"archive"},entity:"credit",actionKey:"archive",isCommonActionSection:!n,tooltipText:i("archive"),onClick:()=>y([a.id],"archive"),icon:Ee,excludePreferences:!0,disablePreventNavigation:!0,children:i("archive")}),a=>p&&a.archived_at>0&&c.jsx(f,{...!n&&{key:"restore"},entity:"credit",actionKey:"restore",isCommonActionSection:!n,tooltipText:i("restore"),onClick:()=>y([a.id],"restore"),icon:Fe,excludePreferences:!0,disablePreventNavigation:!0,children:i("restore")}),a=>p&&!(a!=null&&a.is_deleted)&&c.jsx(f,{...!n&&{key:"delete"},entity:"credit",actionKey:"delete",isCommonActionSection:!n,tooltipText:i("delete"),onClick:()=>y([a.id],"delete"),icon:Ye,excludePreferences:!0,disablePreventNavigation:!0,children:i("delete")})]}const ot=["status","number","client","amount","date","remaining"];function st(){const[o,i,d,r]=X({entity:"invoice"});return["status","number","client","amount","date","remaining","archived_at","client_city","client_country","client_postal_code","client_state","contact_email","contact_name","created_at",o,i,d,r,"discount","documents","entity_state","exchange_rate","is_deleted","is_viewed","last_sent_date","partial","partial_due_date","po_number","private_notes","public_notes","tax_amount","updated_at","valid_until"]}function yt(){var _;const{t:o}=K(),{dateFormat:i}=Ke(),d=Re(),r=Le();st();const n=qe(),u=Oe(),C=Qe(),h=Ve(),[p,x,y,v]=X({entity:"invoice"}),g=[{column:"status",id:"status_id",label:o("status"),format:(e,t)=>c.jsx(We,{entity:t})},{column:"number",id:"number",label:o("number"),format:(e,t)=>c.jsxs("div",{className:"flex space-x-2",children:[c.jsx(O,{to:T("/credits/:id/edit",{id:t.id}),renderSpan:r("credit",t),children:e}),c.jsx(Be,{text:t.number})]})},{column:"client",id:"client_id",label:o("client"),format:(e,t)=>{var s;return c.jsx(O,{to:T("/clients/:id",{id:t.client_id}),renderSpan:r("client",t.client),children:(s=t.client)==null?void 0:s.display_name})}},{column:"amount",id:"amount",label:o("amount"),format:(e,t)=>{var s,m;return n(e,(s=t.client)==null?void 0:s.country_id,(m=t.client)==null?void 0:m.settings.currency_id)}},{column:"date",id:"date",label:o("date"),format:e=>k(e,i)},{column:"remaining",id:"balance",label:o("remaining"),format:(e,t)=>{var s,m;return n(t.balance,(s=t.client)==null?void 0:s.country_id,(m=t.client)==null?void 0:m.settings.currency_id)}},{column:"archived_at",id:"archived_at",label:o("archived_at"),format:e=>k(e,i)},{column:"client_city",id:"client_id",label:o("client_city"),format:(e,t)=>{var s;return(s=t.client)==null?void 0:s.city}},{column:"client_country",id:"client_id",label:o("client_country"),format:(e,t)=>{var s,m,I;return((s=t.client)==null?void 0:s.country_id)&&((I=C((m=t.client)==null?void 0:m.country_id))==null?void 0:I.name)}},{column:"client_postal_code",id:"client_id",label:o("client_postal_code"),format:(e,t)=>{var s;return(s=t.client)==null?void 0:s.postal_code}},{column:"client_state",id:"client_id",label:o("client_state"),format:(e,t)=>{var s;return(s=t.client)==null?void 0:s.state}},{column:"contact_email",id:"client_id",label:o("contact_email"),format:(e,t)=>{var s;return t.client&&t.client.contacts.length>0&&c.jsx($e,{text:(s=t.client)==null?void 0:s.contacts[0].email})}},{column:"contact_name",id:"client_id",label:o("contact_name"),format:(e,t)=>{var s,m;return t.client&&t.client.contacts.length>0&&`${(s=t.client)==null?void 0:s.contacts[0].first_name} ${(m=t.client)==null?void 0:m.contacts[0].last_name}`}},{column:"created_at",id:"created_at",label:o("created_at"),format:e=>k(e,i)},{column:p,id:"custom_value1",label:p,format:e=>h("invoice1",e==null?void 0:e.toString())},{column:x,id:"custom_value2",label:x,format:e=>h("invoice2",e==null?void 0:e.toString())},{column:y,id:"custom_value3",label:y,format:e=>h("invoice3",e==null?void 0:e.toString())},{column:v,id:"custom_value4",label:v,format:e=>h("invoice4",e==null?void 0:e.toString())},{column:"discount",id:"discount",label:o("discount"),format:(e,t)=>{var s,m;return t.is_amount_discount?n(e,(s=t.client)==null?void 0:s.country_id,(m=t.client)==null?void 0:m.settings.currency_id):`${d(e)} %`}},{column:"documents",id:"documents",label:o("documents"),format:(e,t)=>t.documents.length},{column:"entity_state",id:"id",label:o("entity_state"),format:(e,t)=>c.jsx(Ue,{entity:t})},{column:"exchange_rate",id:"exchange_rate",label:o("exchange_rate"),format:e=>d(e)},{column:"is_deleted",id:"is_deleted",label:o("is_deleted"),format:(e,t)=>t.is_deleted?o("yes"):o("no")},{column:"is_viewed",id:"id",label:o("is_viewed"),format:(e,t)=>U(t).length>0?k(U(t),i):o("no")},{column:"last_sent_date",id:"last_sent_date",label:o("last_sent_date"),format:e=>k(e,i)},{column:"partial",id:"partial",label:o("partial"),format:(e,t)=>{var s,m;return n(e,(s=t.client)==null?void 0:s.country_id,(m=t.client)==null?void 0:m.settings.currency_id)}},{column:"partial_due_date",id:"partial_due_date",label:o("partial_due_date"),format:e=>k(e,i)},{column:"po_number",id:"po_number",label:o("po_number")},{column:"private_notes",id:"private_notes",label:o("private_notes"),format:e=>c.jsx(Q,{width:"auto",tooltipElement:c.jsx("div",{className:"w-full max-h-48 overflow-auto whitespace-normal break-all",children:c.jsx("article",{className:B("prose prose-sm",{"prose-invert":!(u!=null&&u.dark_mode)}),dangerouslySetInnerHTML:{__html:M(e)}})}),children:c.jsx("span",{children:V(M(e)).slice(0,50)})})},{column:"public_notes",id:"public_notes",label:o("public_notes"),format:e=>c.jsx(Q,{width:"auto",tooltipElement:c.jsx("div",{className:"w-full max-h-48 overflow-auto whitespace-normal break-all",children:c.jsx("article",{className:B("prose prose-sm",{"prose-invert":!(u!=null&&u.dark_mode)}),dangerouslySetInnerHTML:{__html:M(e)}})}),children:c.jsx("span",{children:V(M(e)).slice(0,50)})})},{column:"tax_amount",id:"total_taxes",label:o("total_taxes"),format:(e,t)=>{var s,m;return n(e,(s=t.client)==null?void 0:s.country_id,(m=t.client)==null?void 0:m.settings.currency_id)}},{column:"updated_at",id:"updated_at",label:o("updated_at"),format:e=>k(e,i)},{column:"valid_until",id:"due_date",label:o("valid_until"),format:e=>k(e,i)}],l=((_=u==null?void 0:u.react_table_columns)==null?void 0:_.credit)||ot;return g.filter(e=>l.includes(e.column)).sort((e,t)=>l.indexOf(e.column)-l.indexOf(t.column))}export{yt as a,nt as b,st as c,ot as d,ut as e,_t as f,mt as g,pt as u};
