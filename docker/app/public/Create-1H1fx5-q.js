import{a7 as H,bK as k,bM as M,bL as O,ac as q,bN as K,bd as h,r as W,e as Y,$ as E,i as Z,u as z,L as G,bQ as J,ck as V,cl as X,t as N,Z as ee,bY as te,p as c,bc as F,j as r,Q as se,bR as ae,bS as ne,S as ie,av as oe}from"./bundle.D3-hVUGj.js";import{b as re}from"./blank-invitation-DyrJ7EfP.js";import{u as ce}from"./useInvoiceUtilities-CJ61_NPN.js";import{A as ue}from"./AddUninvoicedItemsButton-PnVaLqYv.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function fe(u){const b=H(),[s]=k(),{setErrors:f,isDefaultTerms:m,isDefaultFooter:g,setIsFormBusy:p,isFormBusy:a}=u,S=M(),y=O(),t=q(K);return async j=>{if(a)return;h.processing(),p(!0),f(void 0),await y({excludeToasters:!0});let v="/api/v1/invoices?";m?(v+="save_default_terms=true",g&&(v+="&save_default_footer=true")):g&&(v+="save_default_footer=true"),W("POST",Y(v),j).then(async d=>{(m||g)&&await S(),h.success("created_invoice"),E(["products","tasks"]),s.get("action")==="invoice_expense"&&E(["expenses"]),b(Z("/invoices/:id/edit?table=:table",{id:d.data.data.id,table:s.get("table")??"products"}))}).catch(d=>{var x;if(((x=d.response)==null?void 0:x.status)===422){const _=d.response.data;_.errors.amount?h.error(_.errors.amount[0]):h.dismiss(),f(_)}}).finally(()=>{t(void 0),p(!1)})}}function _e(){const{t:u}=z(),{documentTitle:b}=G("new_invoice"),[s,f]=J(oe),{data:m,isLoading:g}=V({enabled:typeof s>"u"}),p=X(),a=N(),[S,y]=ee(te),[t]=k(),[j,v]=c.useState(),[d,x]=c.useState(),[_,B]=c.useState(!1),[I,R]=c.useState(!1),[D,P]=c.useState(!1),w=[{name:u("invoices"),href:"/invoices"},{name:u("new_invoice"),href:"/invoices/create"}],U=[{name:u("create"),href:"/invoices/create"},{name:u("documents"),href:"/invoices/create/documents"},{name:u("settings"),href:"/invoices/create/settings"}],{handleChange:l,calculateInvoiceSum:L}=ce({client:d}),Q=fe({setErrors:v,isDefaultTerms:I,isDefaultFooter:D,isFormBusy:_,setIsFormBusy:B});c.useEffect(()=>(y(void 0),f(e=>{var o;let i=e;if(t.get("action")!=="clone"&&t.get("action")!=="invoice_project"&&t.get("action")!=="invoice_task"&&t.get("action")!=="invoice_expense"&&t.get("action")!=="invoice_product"&&t.get("action")!=="invoice_transaction"&&(i=void 0),typeof m<"u"&&typeof i>"u"&&t.get("action")!=="clone"){const n=F.cloneDeep(m);typeof n.line_items=="string"&&(n.line_items=[]),t.get("client")&&(n.client_id=t.get("client")),n.uses_inclusive_taxes=((o=a==null?void 0:a.settings)==null?void 0:o.inclusive_taxes)??!1,i=n}return i}),()=>{t.get("action")!=="clone"&&t.get("action")!=="invoice_project"&&t.get("action")!=="invoice_task"&&t.get("action")!=="invoice_expense"&&t.get("action")!=="invoice_product"&&t.get("action")!=="invoice_transaction"&&f(void 0)}),[m]);const C=(e,i)=>{var o,n,T,A,$;return(o=e==null?void 0:e.settings)!=null&&o[`tax_name${i}`]?{name:e.settings[`tax_name${i}`],rate:e.settings[`tax_rate${i}`]}:(T=(n=e==null?void 0:e.group_settings)==null?void 0:n.settings)!=null&&T[`tax_name${i}`]?{name:(A=e==null?void 0:e.group_settings)==null?void 0:A.settings[`tax_name${i}`],rate:($=e==null?void 0:e.group_settings)==null?void 0:$.settings[`tax_rate${i}`]}:{name:a==null?void 0:a.settings[`tax_name${i}`],rate:a==null?void 0:a.settings[`tax_rate${i}`]}};return c.useEffect(()=>{s&&s.client_id.length>1&&p.find(s.client_id).then(e=>{x(e);const i=[];if(e.contacts.map(o=>{if(o.send_email){const n=F.cloneDeep(re);n.client_contact_id=o.id,i.push(n)}}),l("invitations",i),!e.is_tax_exempt){if(a&&a.enabled_tax_rates>0&&t.get("action")!=="clone"){const{name:o,rate:n}=C(e,"1");l("tax_name1",o),l("tax_rate1",n)}if(a&&a.enabled_tax_rates>1&&t.get("action")!=="clone"){const{name:o,rate:n}=C(e,"2");l("tax_name2",o),l("tax_rate2",n)}if(a&&a.enabled_tax_rates>2&&t.get("action")!=="clone"){const{name:o,rate:n}=C(e,"3");l("tax_name3",o),l("tax_rate3",n)}}})},[s==null?void 0:s.client_id]),c.useEffect(()=>{s&&L(s)},[s]),r.jsxs(r.Fragment,{children:[r.jsx(se,{title:b,breadcrumbs:w,onSaveClick:()=>Q(s),disableSaveButton:(s==null?void 0:s.client_id.length)===0||_,children:g?r.jsx("div",{className:"flex justify-center items-center",children:r.jsx(ie,{})}):r.jsxs("div",{className:"space-y-4",children:[r.jsx(ae,{tabs:U}),r.jsx(ne,{context:{invoice:s,setInvoice:f,errors:j,isDefaultTerms:I,setIsDefaultTerms:R,isDefaultFooter:D,setIsDefaultFooter:P,client:d,invoiceSum:S}})]})}),r.jsx(ue,{invoice:s,setInvoice:f})]})}export{_e as default};
