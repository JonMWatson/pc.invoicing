import{bo as R,u as v,a as D,dt as I,br as H,eC as M,f as O,d as G,Y as z,bp as q,Z as y,b as K,j as e,bs as Q,bt as U,bu as w,eD as J,eE as W,eF as Y,eG as Z,az as X,l as A,eH as ee,eI as se,bz as te,bA as ae,bh as ne,bm as T,i as S,bB as oe,H as re,h as le,bC as ie,r as ce,e as de,p as k,ax as B,eJ as ue,eK as me,L as he,g as xe,ds as pe,dr as be,ez as fe,du as je,bn as ke,a1 as ge,Q as Ce,k as we,a2 as E,ba as Te,eL as ye,eA as ve,a3 as Ne,a4 as $e,a5 as _e,a6 as F}from"./bundle.D3-hVUGj.js";import{D as Se}from"./DataTableColumnsPicker-nvfGKatE.js";import{u as Ee}from"./useShowEditOption-CWKf-fnf.js";import{I as Ae}from"./ImportButton-DQq538as.js";import{u as Be}from"./hooks-Cob0CTb5.js";import{T as Fe}from"./TaskClock-Dvc0XWHQ.js";import{B as Pe}from"./Banner-C9ETM0xV.js";import"./Import-4Hd9h9R0.js";const L=R(null),V=R(!1);le.extend(ie);const P=re.div`
  background-color: ${({theme:a})=>a.backgroundColor};

  &:hover {
    background-color: ${({theme:a})=>a.hoverBackgroundColor};
  }
`;function Re(){const[a]=v();return s=>{var i,c,u,m,h,x,p;let n=ne(`activity_${s.activity_type_id}`,{});const r={client:e.jsx(T,{to:S("/clients/:id",{id:(i=s.client)==null?void 0:i.hashed_id}),children:(c=s.client)==null?void 0:c.label}),user:((u=s.user)==null?void 0:u.label)??a("system"),task:e.jsx(T,{to:S("/tasks/:id/edit",{id:(m=s.task)==null?void 0:m.hashed_id}),children:(h=s==null?void 0:s.task)==null?void 0:h.label}),contact:e.jsx(T,{to:S("/clients/:id/edit",{id:(x=s==null?void 0:s.contact)==null?void 0:x.hashed_id}),children:(p=s==null?void 0:s.contact)==null?void 0:p.label})};for(const[t,j]of Object.entries(r))n=oe(n,`:${t}`,()=>j);return n}}function De(){var f,C;const[a]=v(),s=D(),n=I({showCommonBulkAction:!0,showEditAction:!0}),{timeFormat:r}=H(),i=M(),{dateFormat:c}=O(),u=G(),m=Be(),h=z(),x=q(),p=Re(),[t,j]=y(L),[g,N]=y(V),d=t&&m(t.time_log),{data:b}=K({queryKey:["/api/v1/activities",t==null?void 0:t.id,"task"],queryFn:()=>ce("POST",de("/api/v1/activities/entity"),{entity:"task",entity_id:t==null?void 0:t.id}).then(o=>o.data.data),enabled:t!==null&&g,staleTime:1/0});return e.jsx(Q,{size:"regular",visible:g,onClose:()=>{N(!1),j(null)},title:`${a("task")} ${t==null?void 0:t.number}`,topRight:t&&(h("edit_task")||x(t))?e.jsx(ae,{label:a("actions"),resource:t,actions:n}):null,withoutActionContainer:!0,withoutHeaderBorder:!0,children:e.jsxs(U,{tabs:[a("overview"),a("activity")],width:"full",withHorizontalPadding:!0,horizontalPaddingWidth:"1.5rem",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-6",children:[e.jsx(w,{className:"border-b border-dashed",leftSide:a("amount"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:s.$20},children:t?u(t.rate*J(t.time_log,i),(f=t.client)==null?void 0:f.country_id,(C=t.client)==null?void 0:C.settings.currency_id):null}),e.jsx(w,{className:"border-b border-dashed",leftSide:a("entity_state"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:s.$20},children:t?a(W(t)):null}),e.jsx(w,{className:"border-b border-dashed",leftSide:a("duration"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:s.$20},children:t?Y(t.time_log.toString(),!0):null}),e.jsx(w,{leftSide:a("status"),pushContentToRight:!0,noExternalPadding:!0,children:t?e.jsx(Z,{entity:t,withoutDropdown:!0}):null})]}),e.jsx(X,{withoutPadding:!0,borderColor:s.$20}),e.jsx("div",{className:"flex flex-col space-y-4 px-6 py-5",children:t&&(d==null?void 0:d.map(([o,$,l],_)=>e.jsxs(P,{className:"flex items-center justify-between p-4 w-full shadow-sm border rounded-md",style:{borderColor:s.$20},theme:{backgroundColor:s.$1,hoverBackgroundColor:s.$4},children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:s.$3},children:A(o,c)}),e.jsxs("span",{className:"text-xs",style:{color:s.$17},children:[$," - ",l]})]}),e.jsx("div",{className:"text-sm font-medium",style:{color:s.$3},children:se(t)&&_===d.length-1?e.jsx(Fe,{task:t,calculateLastTimeLog:!0}):ee(t.time_log,_)})]},_)))})]}),e.jsx("div",{children:e.jsx("div",{className:"flex flex-col pt-3 px-3",children:b==null?void 0:b.map(o=>e.jsxs(P,{className:"flex space-x-3 p-4 rounded-md flex-1 min-w-0",theme:{backgroundColor:s.$1,hoverBackgroundColor:s.$25},children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:s.$20},children:e.jsx(te,{size:"1.3rem",color:s.$16,filledColor:s.$16})})}),e.jsxs("div",{className:"flex flex-col space-y-0.5 flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm",style:{color:s.$3},children:p(o)}),e.jsxs("div",{className:"flex w-full items-center space-x-1 text-xs truncate",style:{color:s.$17},children:[e.jsx("span",{className:"whitespace-nowrap",children:A(o.created_at,`${c} ${r}`)}),e.jsx("span",{children:"-"}),e.jsx("span",{children:o.ip})]})]})]},o.id))})})]})})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function Ie(){return{isChrome:/Chrome/.test(navigator.userAgent)}}function ze(){const[a]=v(),s=D(),{isChrome:n}=Ie(),[r,i]=k.useState(localStorage.getItem("displayChromeExtensionBanner"));return k.useEffect(()=>{r==="false"&&localStorage.setItem("displayChromeExtensionBanner","false")},[r]),r==="false"||!n?e.jsx(e.Fragment,{}):e.jsx(Pe,{variant:"orange",children:e.jsxs("div",{className:"flex items-center w-full justify-between py-1.5",children:[e.jsxs("div",{className:"flex justify-start items-center w-full space-x-3",children:[e.jsx(B,{element:ue,color:s.$1,size:25}),e.jsxs("span",{style:{color:s.$1},children:[a("task_extension_banner"),"."]})]}),e.jsxs("div",{className:"flex items-center space-x-5 whitespace-nowrap",children:[e.jsx("span",{className:"cursor-pointer",onClick:()=>window.open("https://www.youtube.com/watch?v=UL0OklMJTEA"),style:{color:s.$1},children:a("watch_video")}),e.jsx("span",{className:"cursor-pointer",onClick:()=>window.open("https://chromewebstore.google.com/detail/invoice-ninja-tasks/dlfcbfdpemfnjbjlladogijcchfmmaaf?pli=1"),style:{color:s.$1},children:a("view_extension")}),e.jsx(B,{className:"cursor-pointer",element:me,onClick:()=>i("false"),size:25,color:s.$1})]})]})})}function Qe(){const{documentTitle:a}=he("tasks"),[s]=v(),n=z(),r=Ee(),i=xe(),c=[{name:s("tasks"),href:"/tasks"}],u=I(),m=pe(),h=be(),x=fe(),p=je(),[t,j]=k.useState(""),[g,N]=y(L),[d,b]=y(V),{data:f}=ke({id:t});k.useEffect(()=>{f&&d&&N(f)},[f,d]),k.useEffect(()=>()=>b(!1),[]);const{changeTemplateVisible:C,setChangeTemplateVisible:o,changeTemplateResources:$}=ge();return e.jsxs(Ce,{title:a,breadcrumbs:c,aboveMainContainer:e.jsx(ze,{}),children:[e.jsx(we,{resource:"task",columns:h,customActions:u,endpoint:"/api/v1/tasks?include=status,client,project,user,assigned_user&without_deleted_clients=true&sort=id|desc",bulkRoute:"/api/v1/tasks/bulk",linkToCreate:"/tasks/create",linkToEdit:"/tasks/:id/edit",showEdit:l=>r(l),customFilters:m,customBulkActions:p,customFilterPlaceholder:"status",withResourcefulActions:!0,rightSide:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{columns:x,defaultColumns:ve,table:"task"}),e.jsx(Ne,{type:"component",component:e.jsx(Ae,{route:"/tasks/import"}),guards:[$e(E("create_task"),E("edit_task"))]})]}),beforeFilter:(n("view_task")||n("edit_task"))&&e.jsx(T,{to:"/tasks/kanban",children:e.jsxs(Te,{children:[e.jsx(ye,{size:20}),e.jsx("span",{children:"Kanban"})]})}),linkToCreateGuards:[E("create_task")],hideEditableOptions:!n("edit_task"),onTableRowClick:l=>{j(l.id),b(!0)},enableSavingFilterPreference:!0}),!i("task",g)&&e.jsx(De,{}),e.jsx(_e,{entity:"task",entities:$,visible:C,setVisible:o,labelFn:l=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(F,{children:s("number")}),e.jsx("span",{children:l.number})]}),bulkLabelFn:l=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(F,{children:[s("number"),":"]}),e.jsx("span",{children:l.number})]}),bulkUrl:"/api/v1/tasks/bulk"})]})}export{Qe as default};
