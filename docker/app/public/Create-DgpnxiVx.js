import{L as Y,u as O,bK as F,Z as x,eh as L,ag as P,ei as Q,p as d,t as K,ej as U,cl as V,eg as Z,bc as j,h as q,d1 as z,j as r,ax as b,a9 as G,dB as H,Q as J,bR as W,bS as X,S as N,d2 as ee}from"./bundle.D3-hVUGj.js";import{b as te}from"./blank-invitation-DyrJ7EfP.js";function ae(){const{documentTitle:C}=Y("new_recurring_invoice"),[c]=O(),[u]=F(),[R]=x(L),[s,l]=x(P),{data:f,isLoading:$}=Q({enabled:typeof s>"u"}),E=[{name:c("recurring_invoices"),href:"/recurring_invoices"},{name:c("new_recurring_invoice"),href:"/recurring_invoices/create"}],I=[{name:c("create"),href:"/recurring_invoices/create"},{name:c("documents"),href:"/recurring_invoices/create/documents"},{name:c("settings"),href:"/recurring_invoices/create/settings"}],[v,k]=d.useState(),[A,M]=d.useState(),[h,B]=d.useState(!1),t=K(),g=U({setErrors:M,setIsFormBusy:B,isFormBusy:h}),D=V(),{handleChange:_,calculateInvoiceSum:w}=Z({client:v}),m=(e,n)=>{var a,i,o,p,S;return(a=e==null?void 0:e.settings)!=null&&a[`tax_name${n}`]?{name:e.settings[`tax_name${n}`],rate:e.settings[`tax_rate${n}`]}:(o=(i=e==null?void 0:e.group_settings)==null?void 0:i.settings)!=null&&o[`tax_name${n}`]?{name:(p=e==null?void 0:e.group_settings)==null?void 0:p.settings[`tax_name${n}`],rate:(S=e==null?void 0:e.group_settings)==null?void 0:S.settings[`tax_rate${n}`]}:{name:t==null?void 0:t.settings[`tax_name${n}`],rate:t==null?void 0:t.settings[`tax_rate${n}`]}};d.useEffect(()=>(l(e=>{var a,i;let n=e;if(u.get("action")!=="clone"&&(n=void 0),typeof f<"u"&&typeof n>"u"&&u.get("action")!=="clone"){const o=j.cloneDeep(f);typeof o.line_items=="string"&&(o.line_items=[]),u.get("client")&&(o.client_id=u.get("client")),o.next_send_date===""&&(o.next_send_date=q().format("YYYY-MM-DD")),o.uses_inclusive_taxes=((a=t==null?void 0:t.settings)==null?void 0:a.inclusive_taxes)??!1,o.auto_bill=((i=t==null?void 0:t.settings)==null?void 0:i.auto_bill)??"off",n=o}return n}),()=>{l(void 0)}),[f]),d.useEffect(()=>{s&&w(s)},[s]),d.useEffect(()=>{s&&s.client_id.length>1&&D.find(s.client_id).then(e=>{k(e);const n=[];if(e.contacts.map(a=>{if(a.send_email){const i=j.cloneDeep(te);i.client_contact_id=a.id,n.push(i)}}),_("invitations",n),!e.is_tax_exempt){if(t&&t.enabled_tax_rates>0&&u.get("action")!=="clone"){const{name:a,rate:i}=m(e,"1");_("tax_name1",a),_("tax_rate1",i)}if(t&&t.enabled_tax_rates>1&&u.get("action")!=="clone"){const{name:a,rate:i}=m(e,"2");_("tax_name2",a),_("tax_rate2",i)}if(t&&t.enabled_tax_rates>2&&u.get("action")!=="clone"){const{name:a,rate:i}=m(e,"3");_("tax_name3",a),_("tax_rate3",i)}}})},[s==null?void 0:s.client_id]);const[,y]=x(z),T=[{onClick:()=>y(!0),label:c("send_now"),icon:r.jsx(b,{element:G})},{onClick:()=>g(s,"start"),label:c("start"),icon:r.jsx(b,{element:H})}];return r.jsxs(J,{title:C,breadcrumbs:E,disableSaveButton:!(s!=null&&s.client_id)||h,onSaveClick:()=>g(s),additionalSaveOptions:T,children:[$?r.jsx("div",{className:"flex justify-center items-center",children:r.jsx(N,{})}):r.jsxs("div",{className:"space-y-4",children:[r.jsx(W,{tabs:I}),r.jsx(X,{context:{recurringInvoice:s,setRecurringInvoice:l,errors:A,client:v,invoiceSum:R}})]}),r.jsx(ee,{onClick:()=>g(s,"send_now")})]})}export{ae as default};
