import{b as ve,r as z,e as q,u as M,t as le,w as ge,f as Y,d as Z,g as pe,fK as ce,j as t,l as P,D as Se,i as E,aZ as ke,a_ as Te,a$ as he,b0 as ae,bm as V,a as H,ct as W,p as h,fx as ye,cP as be,bh as $e,c7 as Ie,cr as _e,di as xe,fw as we,fL as Ne,fM as De,fN as Pe,z as Ke,bq as Ee,bI as Me,bJ as Fe,bt as Be,ab as se,fO as Ae,fP as Oe,bd as D,$ as G,fQ as Qe,fR as Ve,f8 as Re,fS as Le,bu as w,bE as ze,fT as qe,aa as He,aw as ne,ax as ie,fU as Ue,fV as We,fW as Ge,L as Je,Y as Ye,bs as Ze,Q as Xe,k as et,a2 as te,a3 as tt,a4 as at}from"./bundle.D3-hVUGj.js";import{E as st,A as X,T as J,u as nt,a as fe,b as it}from"./transactions-09IVy-b-.js";import{u as lt,a as ct}from"./useActions-zsVNxYHb.js";import{I as ot}from"./ImportButton-DQq538as.js";import{c as rt,b as dt}from"./payments-w44xId2A.js";import{I as O}from"./invoice-status-We6cAxTk.js";import{P as Q}from"./payment-status-DaLbqgbM.js";import{D as ut}from"./DataTableColumnsPicker-nvfGKatE.js";import"./Import-4Hd9h9R0.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function oe(e){return ve(["/api/v1/invoices",e],()=>z("GET",q("/api/v1/invoices?client_status=:client_status&filter=:filter&client_id=:client_id&is_deleted=:is_deleted&filter_deleted_clients=:without_deleted_clients&per_page=:per_page&page=:page&include=:include",{per_page:e.perPage??"100",page:e.currentPage??"1",client_status:e.clientStatus??"all",client_id:e.clientId??"",filter:e.filter??"",without_deleted_clients:e.withoutDeletedClients||!0,include:e.include||"",is_deleted:e.is_deleted??"false"})).then(n=>n.data.data),{enabled:e.enabled??!0,staleTime:1/0})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const Ce=["status","deposit","withdrawal","date","description","invoices","expense"];function mt(){return["status","deposit","withdrawal","date","description","invoices","expense","participant_name","archived_at","is_deleted","created_at","updated_at"]}function ht(){var g;const{t:e}=M(),n=le(),a=ge(),{dateFormat:r}=Y(),c=Z(),s=pe(),o=lt(),{data:y}=oe({perPage:1e3}),{data:_}=ce({perPage:1e3}),v=l=>{var i;return((i=y==null?void 0:y.find(f=>f.id===l))==null?void 0:i.number)||""},b=l=>{var i;return((i=_==null?void 0:_.find(f=>f.id===l))==null?void 0:i.number)||""},C=[{column:"status",id:"status_id",label:e("status"),format:(l,i)=>t.jsx(Se,{to:E("/transactions/:id/edit",{id:i.id}),renderSpan:s("bank_transaction",i),children:t.jsx(st,{transaction:i})})},{column:"deposit",id:"deposit",label:e("deposit"),format:(l,i)=>{var f;if(i.base_type===X.Credit)return c(i.amount,(f=n==null?void 0:n.settings)==null?void 0:f.country_id,i.currency_id)}},{column:"withdrawal",id:"withdrawal",label:e("withdrawal"),format:(l,i)=>{var f;if(i.base_type===X.Debit)return c(i.amount,(f=n==null?void 0:n.settings)==null?void 0:f.country_id,i.currency_id)}},{column:"date",id:"date",label:e("date"),format:l=>P(l,r)},{column:"created_at",id:"created_at",label:e("created_at"),format:l=>P(l,r)},{column:"updated_at",id:"updated_at",label:e("updated_at"),format:l=>P(l,r)},{column:"archived_at",id:"archived_at",label:e("archived_at"),format:l=>P(l,r)},{column:"is_deleted",id:"is_deleted",label:e("is_deleted"),format:(l,i)=>i.is_deleted?e("yes"):e("no")},{column:"participant_name",id:"participant_name",label:e("participant_name")},{column:"description",id:"description",label:e("description"),format:l=>t.jsx(ke,{width:"auto",tooltipElement:t.jsx("div",{className:"w-full max-h-48 overflow-auto whitespace-normal break-all",children:t.jsx("article",{className:ae("prose prose-sm",{"prose-invert":!(a!=null&&a.dark_mode)}),dangerouslySetInnerHTML:{__html:he(o(l))}})}),children:t.jsx("span",{children:Te(he(o(l))).slice(0,50)})})},{column:"invoices",id:"invoice_ids",label:e("invoices"),format:l=>l&&t.jsx("div",{className:"flex space-x-2",children:l.toString().split(",").map(i=>t.jsx(V,{to:E("/invoices/:id/edit",{id:i}),children:v(i)},i))})},{column:"expense",id:"expense_id",label:e("expense"),format:l=>l&&t.jsx("div",{className:"flex space-x-2",children:l.toString().split(",").map(i=>t.jsx(V,{to:E("/expenses/:id/edit",{id:i}),children:b(i)},i))})}],x=((g=a==null?void 0:a.react_table_columns)==null?void 0:g.transaction)||Ce;return C.filter(l=>x.includes(l.column)).sort((l,i)=>x.indexOf(l.column)-x.indexOf(i.column))}function xt(e){const[n]=M(),a=H(),r=(c,s)=>{e.setSearchParams(o=>({...o,[c]:s}))};return t.jsx("div",{className:"absolute w-full top-full left-0 mt-1 text-center z-10",style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},children:t.jsxs("div",{className:"flex flex-col items-center pt-3 pb-6 space-y-3",style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderBottom:`1px solid ${a.$5}`},children:[t.jsxs("div",{className:"flex justify-evenly w-full",style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},children:[t.jsx(W,{changeOverride:!0,style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},width:"12rem",label:`${n("min")} ${n("amount")}`,value:e.searchParams.minAmount,onValueChange:c=>r("minAmount",isNaN(Number(c))?0:Number(c))}),t.jsx(W,{changeOverride:!0,style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},width:"12rem",label:`${n("max")} ${n("amount")}`,value:e.searchParams.maxAmount,onValueChange:c=>r("maxAmount",isNaN(Number(c))?0:Number(c))})]}),t.jsxs("div",{className:"flex justify-evenly w-full",children:[t.jsx(W,{style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},className:"w-full",width:"12rem",label:n("start"),type:"date",value:e.searchParams.startDate,onValueChange:c=>r("startDate",c||"")}),t.jsx(W,{changeOverride:!0,style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},className:"w-full",width:"12rem",label:n("end"),type:"date",value:e.searchParams.endDate,onValueChange:c=>r("endDate",c||"")})]})]})})}function ft(e){const n=e.dataKey==="invoices",a=e.dataKey==="payments",r=e.dataKey==="expenses",[c,s]=h.useState(!1),[o,y]=h.useState(!1),_=(b,C)=>{e.setSearchParams(x=>({...x,[b]:C}))},v=H();return t.jsxs(t.Fragment,{children:[t.jsx(ye,{initiallyVisible:c,setVisible:s,setSelectedIds:e.setSelectedIds,onChange:()=>{}}),t.jsx(be,{initiallyVisibleModal:o,setVisible:y,setSelectedIds:e.setSelectedIds,onChange:()=>{}}),t.jsxs("div",{className:"flex items-center pr-3",children:[t.jsx(W,{value:e.searchParams.searchTerm,onValueChange:b=>_("searchTerm",b),placeholder:$e(`search_${e.dataKey}`,{count:""}),changeOverride:!0}),n||a||r?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx("div",{className:"ml-3 cursor-pointer hover:opacity-75",onClick:()=>e.dataKey==="vendors"?y(!0):s(!0),children:t.jsx(Ie,{color:v.$3,size:"1.3rem"})})}),e.isFilterModalOpened&&t.jsx(xt,{searchParams:e.searchParams,setSearchParams:e.setSearchParams})]})]})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const yt={[O.Cancelled]:"cancelled",[O.Unpaid]:"unpaid",[O.PastDue]:"past_due",[O.Draft]:"draft",[O.Sent]:"sent",[O.Partial]:"partial",[O.Paid]:"paid",[O.Reversed]:"reversed"};/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */const bt={[Q.PartiallyUnapplied]:"partially_unapplied",[Q.Unapplied]:"unapplied",[Q.Pending]:"pending",[Q.Cancelled]:"cancelled",[Q.Failed]:"failed",[Q.Completed]:"completed",[Q.PartiallyRefunded]:"partially_refunded",[Q.Refunded]:"refunded"};function _t(e){const n=Z(),{dateFormat:a}=Y(),r=H();return t.jsxs("li",{style:{color:r.$3,backgroundColor:e.isItemChecked?r.$7:r.$1,borderColor:r.$24},className:"flex justify-between w-full cursor-pointer p-4 border-b last:border-b-0",onClick:()=>e.selectItem(e.resourceItem.id,e.resourceItem.clientId),children:[t.jsxs("div",{className:"flex space-x-2 items-center",children:[t.jsx(_e,{checked:e.isItemChecked,onClick:()=>e.selectItem(e.resourceItem.id)}),t.jsxs("div",{className:"flex flex-col items-start",style:{color:r.$3},children:[t.jsx("span",{className:"text-sm",children:e.resourceItem.name}),t.jsx("span",{className:"text-sm",children:e.resourceItem.number})]})]}),t.jsxs("div",{className:"flex items-center flex-grow pr-3",children:[t.jsxs("div",{className:"flex flex-col flex-grow pl-8 pr-3",children:[t.jsx("span",{className:"text-sm",style:{color:r.$3},children:e.resourceItem.clientName}),t.jsxs("span",{className:"text-sm",style:{color:r.$3},children:[P(e.resourceItem.date||"",a),P(e.resourceItem.date||"",a)]})]}),typeof e.resourceItem.amount=="number"&&t.jsx("span",{className:"text-sm",style:{color:r.$3},children:n(e.resourceItem.amount||0,e.resourceItem.country_id,e.resourceItem.currency_id)})]}),t.jsx("div",{className:"flex items-center",style:{color:r.$3},children:e.resourceItem.statusId?t.jsxs(t.Fragment,{children:[e.dataKey==="invoices"&&t.jsx(xe,{for:yt,code:e.resourceItem.statusId}),e.dataKey==="payments"&&t.jsx(xe,{for:bt,code:e.resourceItem.statusId})]}):t.jsx(t.Fragment,{children:e.dataKey==="expenses"&&t.jsx(we,{entity:e.resourceItem})})})]},e.resourceItem.id)}function U(e){var re,de;const[n]=M(),a=H(),r=Z(),[c,s]=h.useState({searchTerm:"",minAmount:0,maxAmount:0,startDate:"",endDate:""}),o=e.dataKey==="vendors",y=e.dataKey==="expenses",_=e.dataKey==="payments",v=e.dataKey==="invoices",b=e.dataKey==="categories",[C,x]=h.useState(),{data:g}=Ne({enabled:v}),{data:l}=oe({include:"client",clientStatus:"unpaid",filter:c.searchTerm,clientId:C,enabled:v}),{data:i}=De({filter:c.searchTerm,enabled:o}),{data:f}=Pe({filter:c.searchTerm,enabled:b}),{data:S}=rt({include:"client",filter:c.searchTerm,enabled:_,matchTransactions:!0}),{data:p}=ce({include:"client",filter:c.searchTerm,enabled:y,matchTransactions:!0}),[d,$]=h.useState(),[F,N]=h.useState(),[B,A]=h.useState(!1),j=m=>{var u,k;return!!((k=(u=e.selectedIds)==null?void 0:u.find(K=>K===m))!=null&&k.length)},T=(m,u)=>{var ue,me;x(u);const k=(ue=e.selectedIds)==null?void 0:ue.find(ee=>m===ee);let K;k!=null&&k.length?(K=(me=e.selectedIds)==null?void 0:me.filter(ee=>ee!==m),e.setSelectedIds(K)):(K=[...e.selectedIds||[],m],e.setSelectedIds(K))},R=m=>{var u;return(u=F==null?void 0:F.find(({id:k})=>k===m))==null?void 0:u.display_name},I=m=>m==null?void 0:m.map(u=>{var k,K;return{id:u.id,number:u.number,name:u.name,clientName:R(u.client_id),statusId:u.status_id,amount:u.amount,date:u.date,clientId:u.client_id,should_be_invoiced:u.should_be_invoiced,invoice_id:u.invoice_id,payment_date:u.payment_date,transaction_reference:u.transaction_reference,payment_type_id:u.payment_type_id,country_id:u.country_id||((k=u.client)==null?void 0:k.country_id),currency_id:u.currency_id||((K=u.client)==null?void 0:K.settings.currency_id)}}),L=m=>((d==null?void 0:d.filter(u=>j(u.id)&&u.currency_id===m))||[]).reduce((u,k)=>u+k.amount,0)??0,je=()=>Ke((d==null?void 0:d.filter(m=>j(m.id)))||[]).pluck("currency_id").unique().toArray();return h.useEffect(()=>{N(g),$(I(v?l:o?i:b?f:_?S:p))},[e.dataKey,l,i,f,g,S,p]),h.useEffect(()=>{var m;v&&!((m=e.selectedIds)!=null&&m.length)&&x("")},[e.selectedIds]),t.jsxs("div",{className:ae("flex flex-col flex-1 w-full relative",{"pb-7":e.calculateTotal}),style:{color:a.$3,backgroundColor:a.$1,borderColor:a.$24},children:[t.jsxs("div",{className:ae("flex justify-center px-5 py-3 relative border-b",e.className,{relative:e.addSelectAllButton,"border-t":!o&&!y}),style:{color:a.$3,backgroundColor:a.$1,borderColor:a.$24},children:[e.addSelectAllButton&&t.jsx("div",{className:"absolute top-5 left-4",children:t.jsx(_e,{checked:(re=e.selectedIds)!=null&&re.length?((de=e.selectedIds)==null?void 0:de.length)===(d==null?void 0:d.length):!1,onValueChange:(m,u)=>e.setSelectedIds(u?(d==null?void 0:d.map(k=>k.id))||[]:[])})}),t.jsx(ft,{dataKey:e.dataKey,searchParams:c,setIsFilterModalOpened:A,isFilterModalOpened:B,setSearchParams:s,setSelectedIds:e.setSelectedIds})]}),t.jsx("ul",{style:{height:v?400:200,color:a.$3,backgroundColor:a.$1,borderColor:a.$24},className:"flex flex-col grow justify-start overflow-y-auto",children:d==null?void 0:d.map(m=>{var u;return(j(m.id)||!((u=e.selectedIds)!=null&&u.length)||v||y)&&t.jsx(_t,{isItemChecked:j(m.id),resourceItem:m,selectItem:T,dataKey:e.dataKey},m.id)})}),e.calculateTotal&&!!(d!=null&&d.filter(m=>j(m.id)).length)&&t.jsx("div",{className:"absolute flex w-full bottom-2 text-sm",children:t.jsxs("div",{className:"flex flex-1 justify-center items-center space-x-1",children:[t.jsx("span",{children:d==null?void 0:d.filter(m=>j(m.id)).length}),t.jsx("span",{children:n("selected")}),t.jsx("span",{children:"Â·"}),t.jsx("span",{children:je().map((m,u)=>r(L(m),d==null?void 0:d[u].country_id,m)).join(" | ")})]})})]})}function Ct(e){const[n]=M(),a=H(),r=Ee(),{transactionRule:c}=e,s=Me(Fe),[o,y]=h.useState([]),[_,v]=h.useState([]),[b,C]=h.useState([]),[x,g]=h.useState([]),[l,i]=h.useState(!1),[f,S]=h.useState([]),[p,d]=h.useState(!0),$=[e.isCreditTransactionType?n("create_payment"):n("create_expense"),e.isCreditTransactionType?n("link_payment"):n("link_expense")],F=j=>{j.preventDefault(),!(!_.length||l)&&(i(!0),D.processing(),z("POST",q("/api/v1/bank_transactions/match"),{transactions:[{id:e.transactionDetails.transaction_id,invoice_ids:_.join(",")}]}).then(()=>{r.invalidateQueries([s]),G(["invoices","bank_transactions"]),D.success("converted_transaction")}).finally(()=>i(!1)))},N=j=>{j.preventDefault(),!(!b.length||l)&&(i(!0),D.processing(),z("POST",q("/api/v1/bank_transactions/match"),{transactions:[{id:e.transactionDetails.transaction_id,payment_id:b.join(",")}]}).then(()=>{r.invalidateQueries([s]),G(["invoices","payments","bank_transactions"]),D.success("linked_transaction")}).finally(()=>i(!1)))},B=j=>{j.preventDefault(),!(!o.length&&!f.length||l)&&(i(!0),D.processing(),z("POST",q("/api/v1/bank_transactions/match"),{transactions:[{id:e.transactionDetails.transaction_id,vendor_id:o.join(","),ninja_category_id:f.join(",")}]}).then(()=>{r.invalidateQueries([s]),G(["bank_transactions","expenses"]),D.success("converted_transaction")}).finally(()=>i(!1)))},A=j=>{j.preventDefault(),!(!x.length||l)&&(i(!0),D.processing(),z("POST",q("/api/v1/bank_transactions/match"),{transactions:[{id:e.transactionDetails.transaction_id,expense_id:x.join(",")}]}).then(()=>{r.invalidateQueries([s]),G(["expenses","bank_transactions"]),D.success("linked_transaction")}).finally(()=>i(!1)))};return h.useEffect(()=>{d(e.transactionDetails.status_id===J.Converted)},[e.transactionDetails.status_id,e.isCreditTransactionType,o,_,f,b,x]),h.useEffect(()=>()=>{d(!0)},[]),h.useEffect(()=>{if(c){const{category_id:j,vendor_id:T}=c;j&&S([j]),T&&y([T])}},[c]),t.jsx("div",{className:"flex flex-col flex-1",children:t.jsx("div",{className:"flex flex-col flex-1 border-t",style:{borderColor:a.$24},children:!p&&t.jsxs(Be,{className:"flex flex-col flex-1 mt-2",tabs:$,height:"full",width:"full",withHorizontalPadding:!0,horizontalPaddingWidth:"1rem",children:[t.jsxs("div",{children:[e.isCreditTransactionType?t.jsx(U,{style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},transactionDetails:e.transactionDetails,dataKey:"invoices",setSelectedIds:v,selectedIds:_,calculateTotal:!0}):t.jsxs(t.Fragment,{children:[t.jsx(U,{style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},transactionDetails:e.transactionDetails,dataKey:"vendors",setSelectedIds:y,selectedIds:o}),t.jsx(U,{style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},transactionDetails:e.transactionDetails,dataKey:"categories",setSelectedIds:S,selectedIds:f})]}),t.jsx("div",{className:"px-3 py-3 w-full border-t",style:{borderColor:a.$24},children:t.jsxs(se,{style:{color:a.$3,backgroundColor:a.$1,borderColor:a.$24},className:"w-full",onClick:e.isCreditTransactionType?F:B,disableWithoutIcon:!0,disabled:l||e.isCreditTransactionType&&!_.length&&!b.length||!e.isCreditTransactionType&&!o.length&&!f.length&&!x.length,children:[t.jsx(Ae,{fontSize:22}),t.jsx("span",{children:e.isCreditTransactionType?n("create_payment"):n("create_expense")})]})})]}),t.jsxs("div",{children:[e.isCreditTransactionType?t.jsx(U,{style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},transactionDetails:e.transactionDetails,dataKey:"payments",setSelectedIds:C,selectedIds:b,calculateTotal:!0}):t.jsx(U,{style:{color:a.$3,colorScheme:a.$0,backgroundColor:a.$1,borderColor:a.$4},transactionDetails:e.transactionDetails,dataKey:"expenses",setSelectedIds:g,selectedIds:x,calculateTotal:!0,addSelectAllButton:!0}),t.jsx("div",{className:"px-3 py-3 w-full border-t",style:{borderColor:a.$24},children:t.jsxs(se,{style:{color:a.$3,backgroundColor:a.$1,borderColor:a.$24},className:"w-full",onClick:e.isCreditTransactionType?N:A,disableWithoutIcon:!0,disabled:l||e.isCreditTransactionType&&!_.length&&!b.length||!e.isCreditTransactionType&&!o.length&&!f.length&&!x.length,children:[t.jsx(Oe,{fontSize:22}),t.jsx("span",{children:e.isCreditTransactionType?n("link_payment"):n("link_expense")})]})})]})]})})})}function jt(e){const[n]=M(),a=le(),r=Z(),{dateFormat:c}=Y(),{data:s}=nt({id:e.transactionId,enabled:!!e.transactionId}),{data:o}=Qe({id:(s==null?void 0:s.bank_integration_id)||"",enabled:!!s}),y=J.Matched===(s==null?void 0:s.status_id),{data:_}=Ve({id:(s==null?void 0:s.bank_transaction_rule_id)||"",enabled:!!s&&y}),[v,b]=h.useState(),[C,x]=h.useState(),[g,l]=h.useState(),[i,f]=h.useState(),S=(s==null?void 0:s.base_type)===X.Credit,p=J.Converted!==(s==null?void 0:s.status_id),d=s&&!p&&!!e.transactionId,{data:$}=oe({enabled:S&&d}),{data:F}=dt({id:(s==null?void 0:s.payment_id)||"",enabled:S&&d}),{data:N}=Re({id:(s==null?void 0:s.vendor_id)||"",enabled:!S&&d}),{data:B}=ce({enabled:!S&&d}),{data:A}=Le({id:(s==null?void 0:s.ninja_category_id)||"",enabled:!S&&d});h.useEffect(()=>{if(s){const T=$==null?void 0:$.filter(({id:I})=>{var L;return(L=s.invoice_ids)==null?void 0:L.includes(I)});b(T);const R=B==null?void 0:B.filter(({id:I})=>{var L;return(L=s.expense_id)==null?void 0:L.includes(I)});f(R),l(A==null?void 0:A.data.data),x(F)}},[s,A,F,e.transactionId,B]);const j=H();return t.jsxs("div",{className:"flex flex-col flex-1 border-b",style:{color:j.$3,backgroundColor:j.$1,borderColor:j.$24},children:[t.jsxs("div",{children:[t.jsx(w,{leftSide:n("type"),children:n(S?fe.Deposit:fe.Withdrawal)}),t.jsx(w,{leftSide:n("amount"),children:r((s==null?void 0:s.amount)||0,a==null?void 0:a.settings.country_id,s==null?void 0:s.currency_id)}),t.jsx(w,{leftSide:n("date"),children:P((s==null?void 0:s.date)||"",c)}),t.jsx(w,{leftSide:n("bank_account"),className:"cursor-pointer",children:t.jsx(V,{to:E("/settings/bank_accounts/:id/details",{id:o==null?void 0:o.id}),children:o==null?void 0:o.bank_account_name})}),(s==null?void 0:s.participant)&&t.jsx(w,{leftSide:n("participant"),children:s.participant}),(s==null?void 0:s.participant_name)&&t.jsx(w,{leftSide:n("participant_name"),children:s.participant_name})]}),p?t.jsx(Ct,{transactionDetails:{base_type:(s==null?void 0:s.base_type)||"",transaction_id:(s==null?void 0:s.id)||"",status_id:(s==null?void 0:s.status_id)||""},isCreditTransactionType:S,transactionRule:_}):t.jsxs(t.Fragment,{children:[v==null?void 0:v.map(({id:T,number:R})=>t.jsx(w,{leftSide:n("invoice"),className:"cursor-pointer",children:t.jsx(V,{to:E("/invoices/:id/edit",{id:T}),children:R})},T)),(s==null?void 0:s.payment_id)&&t.jsx(w,{leftSide:n("payment"),className:"cursor-pointer",children:t.jsx(V,{to:E("/payments/:id/edit",{id:C==null?void 0:C.id}),children:C==null?void 0:C.number})}),(s==null?void 0:s.vendor_id)&&t.jsx(w,{leftSide:n("vendor"),className:"cursor-pointer",children:t.jsx(V,{to:E("/vendors/:id",{id:N==null?void 0:N.id}),children:N==null?void 0:N.name})}),(s==null?void 0:s.ninja_category_id)&&t.jsx(w,{leftSide:n("category"),className:"cursor-pointer",children:t.jsx(V,{to:E("/settings/expense_categories/:id/edit",{id:g==null?void 0:g.id}),children:g==null?void 0:g.name})}),i==null?void 0:i.map(({id:T,number:R,date:I})=>t.jsx(w,{leftSide:n("expense"),className:"cursor-pointer",children:t.jsx(V,{to:E("/expenses/:id/edit",{id:T}),children:R||P(I,c)})},T))]})]})}/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2022. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */function vt(){const[e]=M(),n=ze(),{data:a}=qe({perPage:1e3}),r=[{label:e("unmatched"),value:"unmatched",color:"white",backgroundColor:n.$1||"#6B7280",dropdownKey:"0"},{label:e("matched"),value:"matched",color:"white",backgroundColor:n.$2||"#1D4ED8",dropdownKey:"0"},{label:e("converted"),value:"converted",color:"white",backgroundColor:n.$3||"#22C55E",dropdownKey:"0"},{label:e("deposits"),value:"deposits",color:"white",backgroundColor:n.$4||"#e6b05c",dropdownKey:"0"},{label:e("withdrawals"),value:"withdrawals",color:"white",backgroundColor:n.$5||"#93C5FD",dropdownKey:"0"}];return a==null||a.forEach(c=>{r.push({label:c.bank_account_name,value:c.id,color:"white",backgroundColor:"#6B7280",queryKey:"bank_integration_ids",dropdownKey:"1",placeHolder:"bank_account"})}),r}function gt(e){const[n]=M(),{transactions:a,setSelected:r}=e,c=le(),s=Z(),{dateFormat:o}=Y(),[y,_]=h.useState(!1),[v,b]=h.useState(!1),[C,x]=h.useState(""),[g,l]=h.useState(""),i=()=>a.every(({base_type:p,status_id:d})=>p===X.Debit&&d!==J.Converted),f=()=>{x(""),r([]),_(!1),l("")},S=()=>{D.processing(),b(!0);const p=a.map(d=>({id:d.id,vendor_id:C,ninja_category_id:g}));z("POST",q("/api/v1/bank_transactions/match"),{transactions:p}).then(()=>{G(["bank_transactions","expenses"]),D.success("converted_transaction"),f()}).finally(()=>b(!1))};return i()?t.jsxs(t.Fragment,{children:[t.jsxs(He,{title:n("create_expense"),visible:y,onClose:f,overflowVisible:!0,children:[t.jsxs("div",{className:"flex flex-col space-y-3",children:[t.jsxs("span",{className:"text-base font-medium",children:[n("transactions"),":"]}),t.jsx("div",{className:"flex flex-col px-10",children:a.map((p,d)=>t.jsxs("div",{className:"flex justify-evenly",children:[t.jsx("span",{className:"flex-1",children:P(p.date,o)}),t.jsx("span",{className:"ml-16 flex-1",children:s(p.amount,c==null?void 0:c.settings.country_id,p.currency_id)})]},d))})]}),t.jsx(be,{inputLabel:n("vendor"),value:C,onChange:p=>x(p.id),onClearButtonClick:()=>x("")}),t.jsx(ye,{inputLabel:n("expense_category"),value:g,onChange:p=>l(p.id),onClearButtonClick:()=>l("")}),t.jsx(se,{behavior:"button",onClick:S,disableWithoutIcon:!0,disabled:!C&&!g||v,children:n("create_expense")})]}),t.jsx(ne,{onClick:()=>_(!0),icon:t.jsx(ie,{element:Ue}),children:n("create_expense")})]}):null}const pt=()=>{const[e]=M(),n=it(),a=s=>s.every(({status_id:o})=>J.Matched===o),r=s=>s.every(({payment_id:o})=>o);return[({selectedIds:s,selectedResources:o,setSelected:y})=>o&&r(o)&&t.jsx(ne,{onClick:()=>{n(s,"unlink"),y([])},icon:t.jsx(ie,{element:We}),children:e("unlink")}),({selectedResources:s,setSelected:o})=>s&&t.jsx(gt,{setSelected:o,transactions:s}),({selectedIds:s,selectedResources:o,setSelected:y})=>o&&a(o)&&t.jsx(ne,{onClick:()=>{n(s,"convert_matched"),y([])},icon:t.jsx(ie,{element:Ge}),children:e("convert")})]};function Kt(){Je("transactions");const[e]=M(),n=Ye(),a=[{name:e("transactions"),href:"/transactions"}],r=ct(),c=vt(),s=ht(),o=pt(),y=mt(),{dateFormat:_}=Y(),[v,b]=h.useState(),[C,x]=h.useState(""),g=l=>{if(x(l.id),l.description){let i=l.description;l.description.length>35&&(i=i.slice(0,35).concat("...")),b(i)}else b(P(l.date,_))};return t.jsxs(t.Fragment,{children:[t.jsx(Ze,{title:v,visible:!!C,onClose:()=>x(""),size:"large",children:t.jsx(jt,{transactionId:C,setTransactionId:x})}),t.jsx(Xe,{title:e("transactions"),breadcrumbs:a,docsLink:"en/transactions/",children:t.jsx(et,{resource:"transaction",endpoint:"/api/v1/bank_transactions?sort=id|desc&active_banks=true",bulkRoute:"/api/v1/bank_transactions/bulk",columns:s,linkToCreate:"/transactions/create",linkToEdit:"/transactions/:id/edit",onTableRowClick:g,customActions:r,customFilters:c,customBulkActions:o,customFilterPlaceholder:"status",rightSide:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ut,{table:"transaction",columns:y,defaultColumns:Ce}),t.jsx(tt,{type:"component",guards:[at(te("create_bank_transaction"),te("edit_bank_transaction"))],component:t.jsx(ot,{route:"/transactions/import"})})]}),withResourcefulActions:!0,linkToCreateGuards:[te("create_bank_transaction")],hideEditableOptions:!n("edit_bank_transaction"),enableSavingFilterPreference:!0})})]})}export{Kt as default};
