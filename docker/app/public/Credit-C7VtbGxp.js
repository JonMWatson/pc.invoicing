import{u as v,Y as g,bp as j,bO as y,i as o,j as s,bP as U,L as V,bI as L,cf as O,bQ as w,ae as Q,p as n,a1 as M,bc as W,bi as H,O as Y,bT as q,Q as z,bR as G,bS as J,S as K,a5 as X,a6 as Z,bA as $}from"./bundle.D3-hVUGj.js";import{a as ee}from"./queries-Br35MC_k.js";import{u as se,e as te,g as ie}from"./hooks-DdpVpzmL.js";import{B as ae}from"./Banner-C9ETM0xV.js";import{C as ne}from"./CommonActions-DKlnNCPW.js";import{P as re}from"./PreviousNextNavigation-BpWEW6Fs.js";import"./CreditStatus-DFPZx7rF.js";import"./useInvoiceColumns-YKQxY9Gc.js";import"./InvoiceStatus-CQhnxHGD.js";import"./invoice-status-We6cAxTk.js";import"./Actions-OZ_Df7fS.js";function ce(l){const[t]=v(),r=g(),u=j(),{id:a}=y(),{credit:c}=l,d=r("view_credit")||r("edit_credit")||u(c);return[{name:t("edit"),href:o("/credits/:id/edit",{id:a})},{name:t("documents"),href:o("/credits/:id/documents",{id:a}),enabled:d,formatName:()=>{var e;return s.jsx(U,{numberOfDocuments:(e=c==null?void 0:c.documents)==null?void 0:e.length})}},{name:t("settings"),href:o("/credits/:id/settings",{id:a})},{name:t("activity"),href:o("/credits/:id/activity",{id:a})},{name:t("history"),href:o("/credits/:id/history",{id:a})}]}function je(){const{documentTitle:l}=V("edit_credit"),[t]=v(),{id:r}=y(),u=g(),a=j(),c=[{name:t("credits"),href:"/credits"},{name:t("edit_credit"),href:o("/credits/:id/edit",{id:r})}],{data:d}=ee({id:r}),f=L(O),[e,S]=w(Q),[p,T]=n.useState(),[A,C]=n.useState(),[E,oe]=n.useState(!1),[b,_]=n.useState(!1),[h,B]=n.useState(!1),D=se(),I=ce({credit:e}),{calculateInvoiceSum:N}=te({client:p}),{changeTemplateVisible:P,setChangeTemplateVisible:k,changeTemplateResources:R}=M(),F=ie({setErrors:C,isDefaultFooter:h,isDefaultTerms:b});return n.useEffect(()=>{if(d){const i=W.cloneDeep(d);i.line_items.map(m=>m._id=H()),S(i),i&&i.client&&T(i.client)}},[d]),n.useEffect(()=>{e&&N(e)},[e]),Y({on:["App\\Events\\Credit\\CreditWasUpdated"],callback:({data:i})=>{var m,x;((m=q())==null?void 0:m.toString())!==i["x-socket-id"]&&((x=document.getElementById("creditUpdateBanner"))==null||x.classList.remove("hidden"))}}),s.jsxs(z,{title:l,breadcrumbs:c,...(u("edit_credit")||a(e))&&e&&{navigationTopRight:s.jsx($,{resource:e,onSaveClick:()=>F(e),actions:D,cypressRef:"creditActionDropdown",disableSaveButton:!e||E})},aboveMainContainer:s.jsx(ae,{id:"creditUpdateBanner",className:"hidden",variant:"orange",children:t("credit_status_changed")}),afterBreadcrumbs:s.jsx(re,{entity:"credit"}),children:[(e==null?void 0:e.id)===r?s.jsxs("div",{className:"space-y-4",children:[s.jsx(G,{tabs:I,rightSide:e&&s.jsx("div",{className:"flex items-center",children:s.jsx(ne,{resource:e,entity:"credit"})})}),s.jsx(J,{context:{credit:e,errors:A,isDefaultTerms:b,setIsDefaultTerms:_,isDefaultFooter:h,setIsDefaultFooter:B,client:p,invoiceSum:f}})]}):s.jsx("div",{className:"flex justify-center items-center",children:s.jsx(K,{})}),s.jsx(X,{entity:"credit",entities:R,visible:P,setVisible:k,labelFn:i=>s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx(Z,{children:t("number")}),s.jsx("span",{children:i.number})]}),bulkUrl:"/api/v1/credits/bulk"})]})}export{je as default};
