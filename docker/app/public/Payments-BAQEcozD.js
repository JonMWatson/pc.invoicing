import{u as _,a1 as L,j as e,aw as F,ax as I,a9 as W,aO as U,bo as M,a as K,a7 as Y,br as Z,f as J,d as X,Y as q,bp as ee,g as G,Z as $,b as se,bs as te,bt as ae,bu as f,l as P,dj as ne,az as D,i as V,bz as ie,bA as re,H as oe,h as le,bC as ce,r as de,e as ue,L as me,ek as pe,p as T,O as xe,$ as he,Q as ye,k as be,a2 as A,aB as fe,aC as je,a3 as ge,a4 as Ce,a5 as ve,a6 as z}from"./bundle.D3-hVUGj.js";import{u as ke,a as Pe,d as $e}from"./usePaymentColumns-BlyPMMsH.js";import{D as Se}from"./DataTableColumnsPicker-nvfGKatE.js";import{u as H}from"./useActions-DERWog92.js";import{a as Ne,b as we}from"./payments-w44xId2A.js";import{P as Te}from"./PaymentStatus-Ba2_Ejbd.js";import{I as Ae}from"./InvoiceStatus-CQhnxHGD.js";import{a as Ee}from"./CreditStatus-DFPZx7rF.js";import{u as _e}from"./useGenerateActivityElement-DFH_G-7M.js";import{I as Be}from"./ImportButton-DQq538as.js";import"./payment-status-DaLbqgbM.js";import"./invoice-status-We6cAxTk.js";import"./Import-4Hd9h9R0.js";const Re=()=>{const[a]=_(),t=Ne(),m=r=>r.every(({client:o})=>o==null?void 0:o.contacts.some(({email:c})=>c)),{setChangeTemplateVisible:p,setChangeTemplateResources:x,setChangeTemplateEntityContext:l}=L();return[({selectedResources:r,selectedIds:o,setSelected:c})=>m(r)&&e.jsx(F,{onClick:()=>{t(o,"email"),c([])},icon:e.jsx(I,{element:W}),children:a("email_payment")}),({selectedResources:r})=>e.jsx(F,{onClick:()=>{p(!0),x(r),l({endpoint:"/api/v1/payments/bulk",entity:"payment"})},icon:e.jsx(I,{element:U}),children:a("run_template")})]},O=M(null),Q=M(!1);le.extend(ce);const E=oe.div`
  background-color: ${({theme:a})=>a.backgroundColor};

  &:hover {
    background-color: ${({theme:a})=>a.hoverBackgroundColor};
  }
`;function Fe(){var g,C,v,i,k,B,R;const[a]=_(),t=K(),m=Y(),p=H({showCommonBulkAction:!0,showEditAction:!0}),{timeFormat:x}=Z(),{dateFormat:l}=J(),d=X(),r=q(),o=ee(),c=G(),S=_e(),[s,N]=$(O),[h,j]=$(Q),{data:u}=se({queryKey:["/api/v1/activities",s==null?void 0:s.id,"payment"],queryFn:()=>de("POST",ue("/api/v1/activities/entity"),{entity:"payment",entity_id:s==null?void 0:s.id}).then(n=>n.data.data),enabled:s!==null&&h,staleTime:1/0});return e.jsx(te,{size:"regular",visible:h,onClose:()=>{j(!1),N(null)},title:`${a("payment")} ${s==null?void 0:s.number}`,topRight:s&&(r("edit_payment")||o(s))?e.jsx(re,{label:a("actions"),resource:s,actions:p}):null,withoutActionContainer:!0,withoutHeaderBorder:!0,children:e.jsxs(ae,{tabs:[a("overview"),a("activity")],width:"full",withHorizontalPadding:!0,horizontalPaddingWidth:"1.5rem",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-6",children:[e.jsx(f,{className:"border-b border-dashed",leftSide:a("payment_amount"),withoutWrappingLeftSide:!0,pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:t.$20},children:s?d(s==null?void 0:s.amount,(g=s.client)==null?void 0:g.country_id,(C=s.client)==null?void 0:C.settings.currency_id):null}),e.jsx(f,{className:"border-b border-dashed",leftSide:a("applied"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:t.$20},children:s?d(s.applied,(v=s.client)==null?void 0:v.country_id,(i=s.client)==null?void 0:i.settings.currency_id):null}),e.jsx(f,{className:"border-b border-dashed",leftSide:a("date"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:t.$20},children:s?P(s.date,l):null}),e.jsx(f,{className:"border-b border-dashed",leftSide:a("payment_type"),pushContentToRight:!0,noExternalPadding:!0,style:{borderColor:t.$20},children:s?a(ne[s.type_id]):null}),e.jsx(f,{leftSide:a("status"),pushContentToRight:!0,noExternalPadding:!0,children:s?e.jsx(Te,{entity:s}):null})]}),e.jsx(D,{withoutPadding:!0,borderColor:t.$20}),e.jsx("div",{className:"flex flex-col space-y-4 px-6 py-5",children:(k=s==null?void 0:s.invoices)==null?void 0:k.map((n,w)=>{var y,b;return e.jsxs(E,{className:"flex flex-col items-start justify-center space-y-2 shadow-sm text-sm border p-5 w-full cursor-pointer rounded-md",onClick:()=>{!c("invoice",n)&&m(V("/invoices/:id/edit",{id:n.id}))},style:{borderColor:t.$20},theme:{backgroundColor:t.$1,hoverBackgroundColor:t.$4},children:[e.jsxs("span",{className:"font-medium",style:{color:t.$3},children:[a("invoice")," ",n.number]}),e.jsxs("div",{className:"inline-flex items-center space-x-1",style:{color:t.$17},children:[e.jsx("span",{children:d(n.amount,(y=n.client)==null?void 0:y.country_id,(b=n.client)==null?void 0:b.settings.currency_id)}),e.jsx("span",{children:"-"}),e.jsx("span",{children:P(n.date,l)})]}),e.jsx("div",{children:e.jsx(Ae,{entity:n})})]},w)})}),!!((B=s==null?void 0:s.credits)!=null&&B.length)&&e.jsx(D,{withoutPadding:!0,borderColor:t.$20}),e.jsx("div",{className:"flex flex-col space-y-4 px-6 py-5",children:(R=s==null?void 0:s.credits)==null?void 0:R.map((n,w)=>{var y,b;return e.jsxs(E,{className:"flex flex-col items-start justify-center space-y-2 shadow-sm text-sm border p-5 w-full cursor-pointer rounded-md",onClick:()=>{!c("credit",n)&&m(V("/credits/:id/edit",{id:n.id}))},style:{borderColor:t.$20},theme:{backgroundColor:t.$1,hoverBackgroundColor:t.$4},children:[e.jsxs("span",{className:"font-medium",style:{color:t.$3},children:[a("credit")," ",n.number]}),e.jsxs("div",{className:"inline-flex items-center space-x-1",style:{color:t.$17},children:[e.jsx("span",{children:d(n.amount,(y=n.client)==null?void 0:y.country_id,(b=n.client)==null?void 0:b.settings.currency_id)}),e.jsx("span",{children:"-"}),e.jsx("span",{children:P(n.date,l)})]}),e.jsx("div",{children:e.jsx(Ee,{entity:n})})]},w)})})]}),e.jsx("div",{children:e.jsx("div",{className:"flex flex-col pt-3 px-3",children:u==null?void 0:u.map(n=>e.jsxs(E,{className:"flex space-x-3 p-4 rounded-md flex-1 min-w-0",theme:{backgroundColor:t.$1,hoverBackgroundColor:t.$25},children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:t.$20},children:e.jsx(ie,{size:"1.3rem",color:t.$16,filledColor:t.$16})})}),e.jsxs("div",{className:"flex flex-col space-y-0.5 flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm",style:{color:t.$3},children:S(n)}),e.jsxs("div",{className:"flex w-full items-center space-x-1 text-xs truncate",style:{color:t.$17},children:[e.jsx("span",{className:"whitespace-nowrap",children:P(n.created_at,`${l} ${x}`)}),e.jsx("span",{children:"-"}),e.jsx("span",{children:n.ip})]})]})]},n.id))})})]})})}function Ke(){me("payments");const[a]=_(),t=q(),m=G(),p=H(),x=pe(),l=ke(),d=Pe(),r=Re(),o=[{name:a("payments"),href:"/payments"}],[c,S]=T.useState(""),[s,N]=$(O),[h,j]=$(Q),{data:u}=we({id:c,include:"credits"});T.useEffect(()=>{u&&h&&N(u)},[u,h]),T.useEffect(()=>()=>j(!1),[]);const{changeTemplateVisible:g,setChangeTemplateVisible:C,changeTemplateResources:v}=L();return xe({on:"App\\Events\\Payment\\PaymentWasUpdated",callback:()=>he(["payments"])}),e.jsxs(ye,{title:a("payments"),breadcrumbs:o,docsLink:"en/payments/",children:[e.jsx(be,{resource:"payment",columns:l,endpoint:"/api/v1/payments?include=client,invoices&without_deleted_clients=true&sort=id|desc",linkToCreate:"/payments/create",bulkRoute:"/api/v1/payments/bulk",linkToEdit:"/payments/:id/edit",withResourcefulActions:!0,customActions:p,customFilters:x,customBulkActions:r,customFilterPlaceholder:"status",showRestore:i=>!i.is_deleted,rightSide:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{columns:d,defaultColumns:$e,table:"payment"}),e.jsx(ge,{type:"component",component:e.jsx(Be,{route:"/payments/import"}),guards:[Ce(A("create_payment"),A("edit_payment"))]})]}),onTableRowClick:i=>{S(i.id),j(!0)},linkToCreateGuards:[A("create_payment")],hideEditableOptions:!t("edit_payment"),showRestoreBulk:i=>i.every(k=>fe(k)===je.Archived),enableSavingFilterPreference:!0}),!m("payment",s)&&e.jsx(Fe,{}),e.jsx(ve,{entity:"payment",entities:v,visible:g,setVisible:C,labelFn:i=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(z,{children:a("number")}),e.jsx("span",{children:i.number})]}),bulkLabelFn:i=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(z,{children:[a("number"),":"]}),e.jsx("span",{children:i.number})]}),bulkUrl:"/api/v1/payments/bulk"})]})}export{Ke as default};
