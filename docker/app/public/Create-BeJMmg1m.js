import{u as y,L as E,t as I,eS as P,a7 as Q,Z as B,f4 as D,bK as F,p as o,eT as w,eP as A,bc as O,j as l,Q as $,bd as c,eQ as q,r as K,e as L,$ as N,i as R}from"./bundle.D3-hVUGj.js";import{c as Z,e as z}from"./TaskDetails-C0RgHkJr.js";import"./ProjectSelector-DIb_VaTZ.js";import"./TaskClock-Dvc0XWHQ.js";import"./ClientActionButtons-YTWpr-RA.js";import"./react-responsive-0Pkg7MS9.js";function W(){const[p]=y(),{documentTitle:m}=E("new_task"),i=I(),h=P(),_=Q(),[s,d]=B(D),[a]=F(),[S,T]=o.useState(),[v,k]=o.useState(!1),[j,x]=o.useState(!0),{data:u}=w({status:"active"}),{data:f}=A({enabled:typeof s>"u"}),b=[{name:p("tasks"),href:"/tasks"},{name:p("new_task"),href:"/tasks/create"}];o.useEffect(()=>{d(e=>{var r;let t=e;if(a.get("action")!=="clone"&&(t=void 0),typeof f<"u"&&typeof t>"u"&&a.get("action")!=="clone"){const n=O.cloneDeep(f);a.get("client")&&(n.client_id=a.get("client")),a.get("project")&&(n.project_id=a.get("project")),n.rate=((r=i==null?void 0:i.settings)==null?void 0:r.default_task_rate)||0,a.get("rate")&&(n.rate=parseFloat(a.get("rate"))),t=n}return t})},[f]),o.useEffect(()=>{s&&u&&j&&(d(e=>e&&{...e,status_id:u.data.length>0?u.data[0].id:""}),x(!1))},[s,u]);const g=(e,t)=>{d(r=>r&&{...r,[e]:t})},C=e=>{if(!v){if(c.processing(),q(e))return c.error("task_errors");k(!0),K("POST",L("/api/v1/tasks"),e).then(t=>{i!=null&&i.auto_start_tasks&&h(t.data.data),N(["tasks"]),c.success("created_task"),_(R("/tasks/:id/edit",{id:t.data.data.id}))}).catch(t=>{var r;((r=t.response)==null?void 0:r.status)===422&&(c.dismiss(),T(t.response.data))}).finally(()=>{k(!1)})}};return l.jsxs($,{title:m,onSaveClick:()=>s&&C(s),breadcrumbs:b,children:[s&&l.jsx(Z,{task:s,handleChange:g,errors:S}),s&&l.jsx(z,{task:s,handleChange:g})]})}export{W as default};
